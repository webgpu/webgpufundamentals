<!DOCTYPE html><!-- this file is auto-generated from webgpu/lessons/ko/webgpu-compute-shaders-histogram.md. Do not edited directly --><!--
Copyright 2023, GfxFundamentals Contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

* Redistributions of source code must retain the above copyright
  notice, this list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above
  copyright notice, this list of conditions and the following disclaimer
  in the documentation and/or other materials provided with the
  distribution.

* Neither the name of GfxFundamentals nor the names of the
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


--><html lang="ko"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.">
<meta name="keywords" content="webgpu graphics">
<meta name="thumbnail" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ko.jpg">

<meta property="og:title" content="WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ko.jpg">
<meta property="og:description" content="ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.">
<meta property="og:url" content="https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgpufundamentals.org">
<meta name="twitter:title" content="WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨">
<meta name="twitter:url" content="https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html">
<meta name="twitter:description" content="ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.">
<meta name="twitter:image:src" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ko.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgpufundamentals.org/#website",
      "url":"https://webgpufundamentals.org/",
      "name":"webgpufundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html#primaryimage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ko.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html#webpage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html",
      "inLanguage":"ko",
      "name":"WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨",
      "keywords":"webgpu graphics programming",
      "isPartOf":{
        "@id":"https://webgpufundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgpufundamentals.org/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html#primaryimage"
      }
    }
  ]
}
</script>

<title>WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨</title>
<link href="/webgpu/lessons/resources/webgpufundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="apple-touch-icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">
<link rel="icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">

<link rel="stylesheet" href="/webgpu/lessons/lang.css">
<link rel="stylesheet" href="/webgpu/lessons/ko/lang.css">
<link rel="stylesheet" href="/webgpu/lessons/resources/lesson.css">
</head>
<body>
<div class="webgpu_navbar">
  <div>
    <select class="language">
    <option value="/webgpu/lessons/webgpu-compute-shaders-histogram.html">English
    </option><option value="/webgpu/lessons/es/webgpu-compute-shaders-histogram.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">æ—¥æœ¬èª
    </option><option value="/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html" selected="">í•œêµ­ì–´
    </option><option value="/webgpu/lessons/ru/webgpu-compute-shaders-histogram.html">Ğ ÑƒÑÑĞºĞ¸Ğ¹
    </option><option value="/webgpu/lessons/tr/webgpu-compute-shaders-histogram.html">TÃ¼rkÃ§e
    </option><option value="/webgpu/lessons/uk/webgpu-compute-shaders-histogram.html">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°
    </option><option value="/webgpu/lessons/zh_cn/webgpu-compute-shaders-histogram.html">ç®€ä½“ä¸­æ–‡
</option></select>


    <a href="#toc">ëª©ì°¨</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgpu_header">
  <h1><a href="/webgpu/lessons/ko/">webgpufundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(160px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub">
  <div>
    <div><a href="https://github.com/webgpu/webgpufundamentals">Fix, Fork, Contribute <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"></path>
    </g>
</svg>
</a></div>
  </div>
</div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>ì´ ë¬¸ì„œëŠ” <a href="webgpu-compute-shaders.html">ì»´í“¨íŠ¸ ì…°ì´ë” ê¸°ì´ˆ ë¬¸ì„œ</a>ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.</p>
<p>ì´ ê¸€ì€ ê¸´ 2ë¶€ì‘ ë¬¸ì„œì´ë©°, ìµœì í™”ë¥¼ ìœ„í•´ ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì¹  ê²ƒì…ë‹ˆë‹¤. ì´ ìµœì í™”ëŠ” ì†ë„ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“¤ì§€ë§Œ
ì•ˆíƒ€ê¹ê²Œë„ ì¶œë ¥ ê²°ê³¼ëŠ” ë³€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê° ë‹¨ê³„ëŠ” ì´ì „ ë‹¨ê³„ì™€ ë™ì¼í•˜ê²Œ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤.</p>
<p>ë˜í•œ, ì†ë„ì™€ íƒ€ì´ë°ì— ëŒ€í•´ ì–¸ê¸‰í•˜ê² ì§€ë§Œ, íƒ€ì´ë° ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ ë¬¸ì„œì™€ ì˜ˆì œê°€ ë” ê¸¸ì–´ì§€ë¯€ë¡œ
íƒ€ì´ë°ì€ <a href="webgpu-timing.html">ë‹¤ë¥¸ ë¬¸ì„œ</a>ì—ì„œ ë‹¤ë£¨ê³ , ì´ ë¬¸ì„œì—ì„œëŠ” ì œ ì¸¡ì • ê²°ê³¼ë§Œ ì–¸ê¸‰í•˜ê³ 
ì‹¤í–‰ ê°€ëŠ¥í•œ ì˜ˆì œë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤. ì´ ë¬¸ì„œê°€ ì•ìœ¼ë¡œ ì—¬ëŸ¬ë¶„ì´ ì»´í“¨íŠ¸ ì…°ì´ë”ë¥¼ ë§Œë“¤ ë•Œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” í•˜ë‚˜ì˜ ì˜ˆì œê°€ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.</p>
<p>ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì€ ì´ë¯¸ì§€ì˜ ëª¨ë“  í”½ì…€ì„ ê·¸ ê°’ ë˜ëŠ” ê°’ì˜ ì¸¡ì • ê¸°ì¤€ì— ë”°ë¼ í•©ì‚°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<p>ì˜ˆë¥¼ ë“¤ì–´, ì´ 6x7 ì´ë¯¸ì§€ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="image" style="display: inline-block; width: 240px; max-width: 100%;"></div>
    <div style="text-align: center;">6x7</div>
  </div>
</div>
<p>ì´ ì´ë¯¸ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒ‰ìƒë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="colors" style="display: inline-block; width: 240px; max-width: 100%;"></div>
  </div>
</div>
<p>ê° ìƒ‰ìƒì— ëŒ€í•´ íœ˜ë„(ë°ê¸°) ë ˆë²¨ì„ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¨ë¼ì¸ì—ì„œ ì°¾ì€ ê³µì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">// íœ˜ë„ ê°’ì„ 0ì—ì„œ 1 ì‚¬ì´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
// r, g, bëŠ” ê°ê° 0ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì…ë‹ˆë‹¤.
function srgbLuminance(r, g, b) {
  // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
  return r * 0.2126 +
         g * 0.7152 +
         b * 0.0722;
}
</pre>
<p>ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ê°’ì„ íœ˜ë„ ë ˆë²¨ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="luminance" style="display: inline-block; width: 240px; max-width: 100%;"></div>
  </div>
</div>
<p>"ë¹ˆ(bin)"ì˜ ê°œìˆ˜ë¥¼ ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 3ê°œì˜ ë¹ˆìœ¼ë¡œ ì •í•´ë´…ì‹œë‹¤.
ê·¸ëŸ° ë‹¤ìŒ ì´ëŸ¬í•œ íœ˜ë„ ê°’ì„ ì–‘ìí™”í•˜ì—¬ "ë¹ˆ"ì„ ì„ íƒí•˜ê³ 
ê° ë¹ˆì— ë§ëŠ” í”½ì…€ ìˆ˜ë¥¼ í•©ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="imageHistogram" style="display: inline-block; width: 40px; max-width: 100%;"></div>
  </div>
</div>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ëŸ¬í•œ ë¹ˆì˜ ê°’ì„ ê·¸ë˜í”„ë¡œ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="imageHistogramGraph" style="display: inline-block; width: 96px; max-width: 100%;"></div>
  </div>
</div>
<p>ê·¸ë˜í”„ëŠ” ì–´ë‘ìš´ í”½ì…€(ğŸŸ¦ 18)ì´ ì¤‘ê°„ ë°ê¸° í”½ì…€(ğŸŸ¥ 16)ë³´ë‹¤ ë§ê³ ,
ë°ì€ í”½ì…€(ğŸŸ¨ 8)ì€ í›¨ì”¬ ì ë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë‹¨ 3ê°œì˜ ë¹ˆìœ¼ë¡œëŠ” ê·¸ë‹¤ì§€ í¥ë¯¸ë¡­ì§€ ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ° ì‚¬ì§„ì„ ì°ìœ¼ë©´</p>
<div class="webgpu_center">
  <div>
    <div><img src="../../resources/images/pexels-francesco-ungaro-96938-mid.jpg" style="width: 700px;"></div>
    <div style="text-align: center;"><a href="https://www.pexels.com/photo/cute-kitten-hiding-behind-a-pillow-96938/">Photo by Francesco Ungaro</a></div>
  </div>
</div>
<p>í”½ì…€ íœ˜ë„ ê°’ì„ ì„¸ê³ , 256ê°œì˜ ë¹ˆìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ê·¸ë˜í”„ë¡œ ê·¸ë¦¬ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center center">
  <div>
    <div><img src="../resources/histogram-luminosity-photoshop.png" style="width: 237px;" class="nobg"></div>
  </div>
</div>
<p>ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ ê³„ì‚°í•˜ëŠ” ê²ƒì€ ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ë¨¼ì € JavaScriptë¡œ í•´ë´…ì‹œë‹¤.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData"><code class="notranslate" translate="no">ImageData</code></a> ê°ì²´ê°€ ì£¼ì–´ì§€ë©´ íˆìŠ¤í† ê·¸ë¨ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function computeHistogram(numBins, imgData) {
  const {width, height, data} = imgData;
  const bins = new Array(numBins).fill(0);
  for (let y = 0; y &lt; height; ++y) {
    for (let x = 0; x &lt; width; ++x) {
      const offset = (y * width + x) * 4;

      const r = data[offset + 0] / 255;
      const g = data[offset + 1] / 255;
      const b = data[offset + 2] / 255;
      const v = srgbLuminance(r, g, b);

      const bin = Math.min(numBins - 1, v * numBins) | 0;
      ++bins[bin];
    }
  }
  return bins;
}
</pre>
<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ê° í”½ì…€ì„ ìˆœíšŒí•©ë‹ˆë‹¤. ì´ë¯¸ì§€ì—ì„œ r, g, bë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
íœ˜ë„ ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤. ì´ë¥¼ ë¹ˆ ì¸ë±ìŠ¤ë¡œ ë³€í™˜í•˜ê³  í•´ë‹¹ ë¹ˆì˜ ì¹´ìš´íŠ¸ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.</p>
<p>ì´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ë˜í”„ë¡œ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ìš” ê·¸ë˜í”„ í•¨ìˆ˜ëŠ”
ê° ë¹ˆì— ëŒ€í•´ ìŠ¤ì¼€ì¼ê³¼ ìº”ë²„ìŠ¤ ë†’ì´ë¥¼ ê³±í•œ ì„ ì„ ê·¸ë¦½ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  ctx.fillStyle = '#fff';

  for (let x = 0; x &lt; numBins; ++x) {
    const v = histogram[x] * scale * height;
    ctx.fillRect(x, height - v, 1, v);
  }
</pre>
<p>ìŠ¤ì¼€ì¼ì„ ê²°ì •í•˜ëŠ” ê²ƒì€ ê°œì¸ì ì¸ ì„ íƒì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì¢‹ì€ ê³µì‹ì„ ì•Œê³  ê³„ì‹œë‹¤ë©´
ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”. ğŸ˜… ì¸í„°ë„·ì„ ë‘˜ëŸ¬ë³¸ ê²°ê³¼ ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤ì¼€ì¼ ê³µì‹ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const numBins = histogram.length;
  const max = Math.max(...histogram);
  const scale = Math.max(1 / max, 0.2 * numBins / numEntries);
</pre>
<p>ì—¬ê¸°ì„œ <code class="notranslate" translate="no">numEntries</code>ëŠ” ì´ë¯¸ì§€ì˜ ì´ í”½ì…€ ìˆ˜(ì¦‰, width * height)ì´ë©°,
ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì¥ ë§ì€ ê°’ì„ ê°€ì§„ ë¹ˆì´ ê·¸ë˜í”„ì˜ ìƒë‹¨ì— ë‹¿ë„ë¡ ìŠ¤ì¼€ì¼ì„ ì¡°ì •í•˜ì§€ë§Œ,
í•´ë‹¹ ë¹ˆì´ ë„ˆë¬´ í¬ë©´ ë³´ê¸° ì¢‹ì€ ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ëŠ” ë¹„ìœ¨ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>ëª¨ë‘ í•©ì¹˜ë©´ 2D ìº”ë²„ìŠ¤ë¥¼ ë§Œë“¤ê³  ê·¸ë¦½ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function drawHistogram(histogram, numEntries, height = 100) {
  const numBins = histogram.length;
  const max = Math.max(...histogram);
  const scale = Math.max(1 / max, 0.2 * numBins / numEntries);

  const canvas = document.createElement('canvas');
  canvas.width = numBins;
  canvas.height = height;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  ctx.fillStyle = '#fff';

  for (let x = 0; x &lt; numBins; ++x) {
    const v = histogram[x] * scale * height;
    ctx.fillRect(x, height - v, 1, v);
  }
}
</pre>
<p>ì´ì œ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤. <a href="webgpu-importing-textures.html">ì´ë¯¸ì§€ ë¡œë”© ë¬¸ì„œ</a>ì—ì„œ
ì‘ì„±í•œ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
</pre>
<p>ì´ë¯¸ì§€ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì´ë¯¸ì§€ë¥¼
2D ìº”ë²„ìŠ¤ì— ê·¸ë¦° ë‹¤ìŒ <code class="notranslate" translate="no">getImageData</code>ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function getImageData(img) {
  const canvas = document.createElement('canvas');

  // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ì™€ ê°™ì€ í¬ê¸°ë¡œ ë§Œë“­ë‹ˆë‹¤
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;

  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  return ctx.getImageData(0, 0, canvas.width, canvas.height);
}
</pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap"><code class="notranslate" translate="no">ImageBitmap</code></a>ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ë„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function showImageBitmap(imageBitmap) {
  const canvas = document.createElement('canvas');
  canvas.width = imageBitmap.width;
  canvas.height = imageBitmap.height;

  const bm = canvas.getContext('bitmaprenderer');
  bm.transferFromImageBitmap(imageBitmap);
  document.body.appendChild(canvas);
}
</pre>
<p>ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í¬ê²Œ í‘œì‹œë˜ì§€ ì•Šë„ë¡ CSSë¥¼ ì¶”ê°€í•˜ê³ 
ë°°ê²½ìƒ‰ë„ ì§€ì •í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-css" translate="no">canvas {
  display: block;
  max-width: 256px;
  border: 1px solid #888;
  background-color: #333;
}
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ìœ„ì—ì„œ ì‘ì„±í•œ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');

  const imgData = getImageData(imgBitmap);
  const numBins = 256;
  const histogram = computeHistogram(numBins, imgData);

  showImageBitmap(imgBitmap);

  const numEntries = imgData.width * imgData.height;
  drawHistogram(histogram, numEntries);
}
</pre>
<p>ê·¸ë¦¬ê³  ì—¬ê¸° ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì´ ìˆìŠµë‹ˆë‹¤.</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-javascript.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-javascript.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>JavaScript ì½”ë“œê°€ ë¬´ì—‡ì„ í•˜ëŠ”ì§€ ë”°ë¼ê°€ê¸° ì‰¬ì› ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
ì´ì œ WebGPUë¡œ ë³€í™˜í•´ë´…ì‹œë‹¤!</p>
<h1 id="gpuì—ì„œ-íˆìŠ¤í† ê·¸ë¨-ê³„ì‚°í•˜ê¸°"><a id="a-comptuing-a-histogram"></a>GPUì—ì„œ íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°í•˜ê¸°</h1>
<p>ê°€ì¥ ëª…í™•í•œ ì†”ë£¨ì…˜ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤. JavaScript <code class="notranslate" translate="no">computeHistogram</code> í•¨ìˆ˜ë¥¼
WGSLë¡œ ì§ì ‘ ë³€í™˜í•˜ê² ìŠµë‹ˆë‹¤.</p>
<p>íœ˜ë„ í•¨ìˆ˜ëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ë‹¤ì‹œ JavaScriptì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">// íœ˜ë„ ê°’ì„ 0ì—ì„œ 1 ì‚¬ì´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
// r, g, bëŠ” ê°ê° 0ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì…ë‹ˆë‹¤.
function srgbLuminance(r, g, b) {
  // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
  return r * 0.2126 +
         g * 0.7152 +
         b * 0.0722;
}
</pre>
<p>ê·¸ë¦¬ê³  ì—¬ê¸° í•´ë‹¹í•˜ëŠ” WGSLì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}
</pre>
<p>"ë‚´ì (dot product)"ì˜ ì•½ìì¸ <code class="notranslate" translate="no">dot</code> í•¨ìˆ˜ëŠ” í•œ ë²¡í„°ì˜ ëª¨ë“  ìš”ì†Œë¥¼
ë‹¤ë¥¸ ë²¡í„°ì˜ í•´ë‹¹ ìš”ì†Œì™€ ê³±í•œ ë‹¤ìŒ ê²°ê³¼ë¥¼ ë”í•©ë‹ˆë‹¤. ìœ„ì˜ <code class="notranslate" translate="no">vec3f</code>ì˜ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">fn dot(a: vec3f, b: vec3f) -&gt; f32 {
  return a.x * b.x + a.y * b.y + a.z * b.z;
}
</pre>
<p>ì´ê²ƒì´ JavaScriptì— ìˆë˜ ê²ƒì…ë‹ˆë‹¤. ì£¼ìš” ì°¨ì´ì ì€ WGSLì—ì„œëŠ”
ê°œë³„ ì±„ë„ ëŒ€ì‹  ìƒ‰ìƒì„ <code class="notranslate" translate="no">vec3f</code>ë¡œ ì „ë‹¬í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<p>íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°ì˜ ì£¼ìš” ë¶€ë¶„ì— ëŒ€í•´, ë‹¤ì‹œ JavaScriptì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function computeHistogram(numBins, imgData) {
  const {width, height, data} = imgData;
  const bins = new Array(numBins).fill(0);
  for (let y = 0; y &lt; height; ++y) {
    for (let x = 0; x &lt; width; ++x) {
      const offset = (y * width + x) * 4;

      const r = data[offset + 0] / 255;
      const g = data[offset + 1] / 255;
      const b = data[offset + 2] / 255;
      const v = srgbLuminance(r, g, b);

      const bin = Math.min(numBins - 1, v * numBins) | 0;
      ++bins[bin];
    }
  }
  return bins;
}
</pre>
<p>ì—¬ê¸° í•´ë‹¹í•˜ëŠ” WGSLì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1) fn cs() {
  let size = textureDimensions(ourTexture, 0);
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
  for (var y = 0u; y &lt; size.y; y++) {
    for (var x = 0u; x &lt; size.x; x++) {
      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
      let v = srgbLuminance(color.rgb);
      let bin = min(u32(v * numBins), lastBinIndex);
      bins[bin] += 1;
    }
  }
}
</pre>
<p>ìœ„ì—ì„œ ë§ì´ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. JavaScriptì—ì„œëŠ” <code class="notranslate" translate="no">imgData</code>ì—ì„œ ë°ì´í„°, ë„ˆë¹„, ë†’ì´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
WGSLì—ì„œëŠ” <code class="notranslate" translate="no">textureDimensions</code> í•¨ìˆ˜ì— í…ìŠ¤ì²˜ë¥¼ ì „ë‹¬í•˜ì—¬ ë„ˆë¹„ì™€ ë†’ì´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  let size = textureDimensions(ourTexture, 0);
</pre>
<p><code class="notranslate" translate="no">textureDimensions</code>ëŠ” í…ìŠ¤ì²˜ì™€ ë°‰ ë ˆë²¨(ìœ„ì˜ <code class="notranslate" translate="no">0</code>)ì„ ë°›ì•„
í•´ë‹¹ í…ìŠ¤ì²˜ì˜ ë°‰ ë ˆë²¨ í¬ê¸°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</p>
<p>JavaScriptì—ì„œ í–ˆë˜ ê²ƒì²˜ëŸ¼ í…ìŠ¤ì²˜ì˜ ëª¨ë“  í”½ì…€ì„ ìˆœíšŒí•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  for (var y = 0u; y &lt; size.y; y++) {
    for (var x = 0u; x &lt; size.x; x++) {
</pre>
<p><code class="notranslate" translate="no">textureLoad</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ í…ìŠ¤ì²˜ì—ì„œ ìƒ‰ìƒì„ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
</pre>
<p><code class="notranslate" translate="no">textureLoad</code>ëŠ” í…ìŠ¤ì²˜ì˜ ë‹¨ì¼ ë°‰ ë ˆë²¨ì—ì„œ ë‹¨ì¼ í…ì…€ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
í…ìŠ¤ì²˜, <code class="notranslate" translate="no">vec2u</code> í…ì…€ ìœ„ì¹˜, ë°‰ ë ˆë²¨(<code class="notranslate" translate="no">0</code>)ì„ ë°›ìŠµë‹ˆë‹¤.</p>
<p>íœ˜ë„ ê°’ì„ ê³„ì‚°í•˜ê³ , ë¹ˆ ì¸ë±ìŠ¤ë¡œ ë³€í™˜í•˜ê³ , í•´ë‹¹ ë¹ˆì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
+      let v = srgbLuminance(color.rgb);
+      let bin = min(u32(v * numBins), lastBinIndex);
+      bins[bin] += 1;
</pre>
<p>ì´ì œ ì»´í“¨íŠ¸ ì…°ì´ë”ê°€ ìˆìœ¼ë‹ˆ ì‚¬ìš©í•´ë´…ì‹œë‹¤.</p>
<p>í‘œì¤€ ì´ˆê¸°í™” ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const adapter = await navigator.gpu?.requestAdapter();
  const device = await adapter?.requestDevice();
  if (!device) {
    fail('need a browser that supports WebGPU');
    return;
  }
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ì…°ì´ë”ë¥¼ ë§Œë“­ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const module = device.createShaderModule({
    label: 'histogram shader',
    code: /* wgsl */ `
      @group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
      @group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

      // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
      const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
      fn srgbLuminance(color: vec3f) -&gt; f32 {
        return saturate(dot(color, kSRGBLuminanceFactors));
      }

      @compute @workgroup_size(1) fn cs() {
        let size = textureDimensions(ourTexture, 0);
        let numBins = f32(arrayLength(&amp;bins));
        let lastBinIndex = u32(numBins - 1);
        for (var y = 0u; y &lt; size.y; y++) {
          for (var x = 0u; x &lt; size.x; x++) {
            let position = vec2u(x, y);
            let color = textureLoad(ourTexture, position, 0);
            let v = srgbLuminance(color.rgb);
            let bin = min(u32(v * numBins), lastBinIndex);
            bins[bin] += 1;
          }
        }
      }
    `,
  });
</pre>
<p>ì…°ì´ë”ë¥¼ ì‹¤í–‰í•  ì»´í“¨íŠ¸ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“­ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const pipeline = device.createComputePipeline({
    label: 'histogram',
    layout: 'auto',
    compute: {
      module,
    },
  });
</pre>
<p>ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•œ í›„ í…ìŠ¤ì²˜ë¥¼ ë§Œë“¤ê³  ë°ì´í„°ë¥¼ ë³µì‚¬í•´ì•¼ í•©ë‹ˆë‹¤.
<a href="webgpu-importing-textures.html#a-create-texture-from-source">í…ìŠ¤ì²˜ì— ì´ë¯¸ì§€ ë¡œë”© ë¬¸ì„œ</a>ì—ì„œ
ì‘ì„±í•œ <code class="notranslate" translate="no">createTextureFromSource</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
  const texture = createTextureFromSource(device, imgBitmap);
</pre>
<p>ì…°ì´ë”ê°€ ìƒ‰ìƒ ê°’ì„ í•©ì‚°í•  ìŠ¤í† ë¦¬ì§€ ë²„í¼ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const numBins = 256;
  const histogramBuffer = device.createBuffer({
    size: numBins * 4, // 256 entries * 4 bytes per (u32)
    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
  });
</pre>
<p>ê·¸ë¦¬ê³  ê²°ê³¼ë¥¼ ê°€ì ¸ì™€ì„œ ê·¸ë¦´ ìˆ˜ ìˆë„ë¡ ë²„í¼ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const resultBuffer = device.createBuffer({
    size: histogramBuffer.size,
    usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,
  });
</pre>
<p>í…ìŠ¤ì²˜ì™€ íˆìŠ¤í† ê·¸ë¨ ë²„í¼ë¥¼ íŒŒì´í”„ë¼ì¸ì— ì „ë‹¬í•˜ê¸° ìœ„í•œ
ë°”ì¸ë“œ ê·¸ë£¹ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const bindGroup = device.createBindGroup({
    label: 'histogram bindGroup',
    layout: pipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: { buffer: histogramBuffer }},
      { binding: 1, resource: texture.createView() },
    ],
  });
</pre>
<p>ì´ì œ ì»´í“¨íŠ¸ ì…°ì´ë”ë¥¼ ì‹¤í–‰í•˜ëŠ” ëª…ë ¹ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();
</pre>
<p>íˆìŠ¤í† ê·¸ë¨ ë²„í¼ë¥¼ ê²°ê³¼ ë²„í¼ë¡œ ë³µì‚¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();

+  encoder.copyBufferToBuffer(histogramBuffer, 0, resultBuffer, 0, resultBuffer.size);
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();

  encoder.copyBufferToBuffer(histogramBuffer, 0, resultBuffer, 0, resultBuffer.size);

+  const commandBuffer = encoder.finish();
+  device.queue.submit([commandBuffer]);
</pre>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ê²°ê³¼ ë²„í¼ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ê¸°ì¡´ í•¨ìˆ˜ì— ì „ë‹¬í•˜ì—¬
íˆìŠ¤í† ê·¸ë¨ì„ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  await resultBuffer.mapAsync(GPUMapMode.READ);
  const histogram = new Uint32Array(resultBuffer.getMappedRange());

  showImageBitmap(imgBitmap);

  const numEntries = texture.width * texture.height;
  drawHistogram(histogram, numEntries);

  resultBuffer.unmap();
</pre>
<p>ê·¸ë¦¬ê³  ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-slow.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-slow.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>ê²°ê³¼ íƒ€ì´ë°ì„ ì¸¡ì •í•´ë³´ë‹ˆ <strong>JavaScript ë²„ì „ë³´ë‹¤ ì•½ 30ë°° ëŠë¦½ë‹ˆë‹¤!!!</strong> ğŸ˜±ğŸ˜±ğŸ˜± (ê²°ê³¼ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤).</p>
<p>ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚œ ê±¸ê¹Œìš”? ìœ„ì˜ ì†”ë£¨ì…˜ì„ ë‹¨ì¼ ë£¨í”„ë¡œ ì„¤ê³„í–ˆê³ 
í¬ê¸°ê°€ 1ì¸ ë‹¨ì¼ ì›Œí¬ê·¸ë£¹ í˜¸ì¶œì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” GPUì˜ ë‹¨ì¼ "ì½”ì–´"ë§Œ
íˆìŠ¤í† ê·¸ë¨ì„ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. GPU ì½”ì–´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ
CPU ì½”ì–´ë§Œí¼ ë¹ ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. CPU ì½”ì–´ëŠ” ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ë§ì€ ì¶”ê°€ íšŒë¡œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
GPUëŠ” ëŒ€ê·œëª¨ ë³‘ë ¬í™”ë¡œ ì†ë„ë¥¼ ì–»ì§€ë§Œ ì„¤ê³„ë¥¼ ë” ë‹¨ìˆœí•˜ê²Œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.
ìœ„ì˜ ì…°ì´ë”ë¥¼ ê³ ë ¤í•˜ë©´ ë³‘ë ¬í™”ì˜ ì´ì ì„ ì „í˜€ í™œìš©í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
<p>ì‘ì€ ì˜ˆì œ í…ìŠ¤ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram">
  <div data-diagram="single"></div>
</div>
<blockquote>
<h2 id="ë‹¤ì´ì–´ê·¸ë¨-vs-ì…°ì´ë”-ì°¨ì´ì ">ë‹¤ì´ì–´ê·¸ë¨ vs ì…°ì´ë” ì°¨ì´ì </h2>
<p>ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ ì…°ì´ë”ë¥¼ ì™„ë²½í•˜ê²Œ í‘œí˜„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p>
<ul>
<li>3ê°œì˜ ë¹ˆë§Œ í‘œì‹œí•˜ì§€ë§Œ ì…°ì´ë”ì—ëŠ” 256ê°œì˜ ë¹ˆì´ ìˆìŠµë‹ˆë‹¤</li>
<li>ì½”ë“œê°€ ë‹¨ìˆœí™”ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
<li>â–¢ëŠ” í…ì…€ ìƒ‰ìƒì…ë‹ˆë‹¤</li>
<li>â—¯ëŠ” íœ˜ë„ë¡œ í‘œí˜„ëœ ë¹ˆ ì„ íƒì…ë‹ˆë‹¤</li>
<li>ë§ì€ ê²ƒë“¤ì´ ì•½ì–´ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
<ul>
<li><code class="notranslate" translate="no">wid</code> = <code class="notranslate" translate="no">workgroup_id</code></li>
<li><code class="notranslate" translate="no">gid</code> = <code class="notranslate" translate="no">global_invocation_id</code></li>
<li><code class="notranslate" translate="no">lid</code> = <code class="notranslate" translate="no">local_invocation_id</code></li>
<li><code class="notranslate" translate="no">ourTex</code> = <code class="notranslate" translate="no">ourTexture</code></li>
<li><code class="notranslate" translate="no">texLoad</code> = <code class="notranslate" translate="no">textureLoad</code></li>
<li>ë“±â€¦</li>
</ul>
</li>
</ul>
<p>ì´ëŸ¬í•œ ë³€ê²½ ì‚¬í•­ì€ ë§ì€ ì„¸ë¶€ ì‚¬í•­ì„ í‘œì‹œí•˜ê¸° ìœ„í•œ ê³µê°„ì´ ì œí•œë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ì´ ì²« ë²ˆì§¸ ì˜ˆì œëŠ” ë‹¨ì¼ í˜¸ì¶œì„ ì‚¬ìš©í•˜ì§€ë§Œ, ì§„í–‰í•˜ë©´ì„œ ë” ì ì€ ê³µê°„ì— ë” ë§ì€ ì •ë³´ë¥¼
ì••ì¶•í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ì´ì–´ê·¸ë¨ì´ í˜¼ë€ì„ ì£¼ê¸°ë³´ë‹¤ëŠ” ì´í•´ì— ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ğŸ˜…</p>
</blockquote>
<p>ë‹¨ì¼ GPU í˜¸ì¶œì´ CPUë³´ë‹¤ ëŠë¦¬ë‹¤ëŠ” ì ì„ ê³ ë ¤í•˜ë©´ ì ‘ê·¼ ë°©ì‹ì„ ë³‘ë ¬í™”í•  ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.</p>
<h2 id="ìµœì í™”---ë”-ë§ì€-í˜¸ì¶œ">ìµœì í™” - ë” ë§ì€ í˜¸ì¶œ</h2>
<p>ì•„ë§ˆë„ ì´ë¥¼ ê°€ì†í™”í•˜ëŠ” ê°€ì¥ ì‰½ê³  ëª…í™•í•œ ë°©ë²•ì€ í”½ì…€ë‹¹ í•˜ë‚˜ì˜ ì›Œí¬ê·¸ë£¹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ìœ„ì˜ ì½”ë“œì—ëŠ” for ë£¨í”„ê°€ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">for (y) {
   for (x) {
      ...
   }
}
</pre>
<p>ëŒ€ì‹  <code class="notranslate" translate="no">global_invocation_id</code>ë¥¼ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í•˜ê³ 
ëª¨ë“  ë‹¨ì¼ í”½ì…€ì„ ë³„ë„ì˜ í˜¸ì¶œë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì…°ì´ë”ì— í•„ìš”í•œ ë³€ê²½ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;vec4u&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1, 1, 1)
-fn cs() {
+fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
-  let size = textureDimensions(ourTexture, 0);
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
-  for (var y = 0u; y &lt; size.y; y++) {
-    for (var x = 0u; x &lt; size.x; x++) {
-      let position = vec2u(x, y);
+  let position = global_invocation_id.xy;
  let color = textureLoad(ourTexture, position, 0);
  let v = srgbLuminance(color.rgb);
  let bin = min(u32(v * numBins), lastBinIndex);
  bins[bin] += 1;
-    }
-  }
}
</pre>
<p>ë³´ì‹œë‹¤ì‹œí”¼, ë£¨í”„ë¥¼ ì œê±°í•˜ê³  ëŒ€ì‹  <code class="notranslate" translate="no">@builtin(global_invocation_id)</code> ê°’ì„ ì‚¬ìš©í•˜ì—¬
ê° ì›Œí¬ê·¸ë£¹ì´ ë‹¨ì¼ í”½ì…€ì„ ë‹´ë‹¹í•˜ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ë¡ ì ìœ¼ë¡œ ì´ëŠ”
ëª¨ë“  í”½ì…€ì´ ë³‘ë ¬ë¡œ ì²˜ë¦¬ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
ì´ë¯¸ì§€ëŠ” 2448 Ã— 1505ë¡œ ê±°ì˜ 370ë§Œ í”½ì…€ì´ë¯€ë¡œ
ë³‘ë ¬í™”ì˜ ê¸°íšŒê°€ ë§ìŠµë‹ˆë‹¤.</p>
<p>í•„ìš”í•œ ë‹¤ë¥¸ ë³€ê²½ ì‚¬í•­ì€ ì‹¤ì œë¡œ í”½ì…€ë‹¹ í•˜ë‚˜ì˜ ì›Œí¬ê·¸ë£¹ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
-  pass.dispatchWorkgroups(1);
+  pass.dispatchWorkgroups(texture.width, texture.height);
  pass.end();
</pre>
<p>ì—¬ê¸° ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-with-race.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-with-race.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>ë¬´ì—‡ì´ ì˜ëª»ë˜ì—ˆë‚˜ìš”? ì´ íˆìŠ¤í† ê·¸ë¨ì´ ì´ì „ íˆìŠ¤í† ê·¸ë¨ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì´ë©°
í•©ê³„ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”? ì°¸ê³ : ì»´í“¨í„°ì— ë”°ë¼ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì œ ì»´í“¨í„°ì—ì„œëŠ” ìƒë‹¨ì— ì´ì „ ë²„ì „ì˜ íˆìŠ¤í† ê·¸ë¨ì´ ìˆê³ , í•˜ë‹¨ì— ìƒˆ ë²„ì „ì˜ 4ê°€ì§€ ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.</p>
<style>
.local-img img {
  border: 1px solid #888;
  margin: 0.5em;
}
</style>
<div class="webgpu_center local-img">
  <div>
      <img src="../resources/histogram-slow-luminosity.png" class="histogram-img">
      <div style="text-align: center;">ì´ì „ ê²°ê³¼</div>
  </div>
  <div>
    <div>
        <img src="../resources/histogram-race-01.png" class="histogram-img">
        <img src="../resources/histogram-race-02.png" class="histogram-img">
    </div>
    <div>
        <img src="../resources/histogram-race-03.png" class="histogram-img">
        <img src="../resources/histogram-race-04.png" class="histogram-img">
    </div>
    <div style="text-align: center;">ìƒˆ ê²°ê³¼</div>
  </div>
</div>
<p>ìƒˆ ë²„ì „ì€ ì¼ê´€ë˜ì§€ ì•Šì€ ê²°ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤(ì ì–´ë„ ì œ ì»´í“¨í„°ì—ì„œëŠ”).</p>
<p>ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚¬ë‚˜ìš”?</p>
<p>ì´ê²ƒì€ <a href="../../webgpu-compute-shaders.html#a-race-conditions">ì´ì „ ë¬¸ì„œ</a>ì—ì„œ ì–¸ê¸‰í•œ
ê³ ì „ì ì¸ <em>ê²½ìŸ ì¡°ê±´</em>ì…ë‹ˆë‹¤.</p>
<p>ì…°ì´ë”ì˜ ì´ ì¤„ì€</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">        bins[bin] += 1;
</pre>
<p>ì‹¤ì œë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë³€í™˜ë©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">   let value = bins[bin];
   value = value + 1
   bins[bin] = value;
</pre>
<p>2ê°œ ì´ìƒì˜ í˜¸ì¶œì´ ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ê³ 
ë™ì¼í•œ <code class="notranslate" translate="no">bin</code> ê°’ì„ ê°€ì§ˆ ë•Œ ì–´ë–»ê²Œ ë ê¹Œìš”?</p>
<p><code class="notranslate" translate="no">bin = 1</code>ì´ê³  <code class="notranslate" translate="no">bins[1] = 3</code>ì¸ 2ê°œì˜ í˜¸ì¶œì„ ìƒìƒí•´ë³´ì„¸ìš”.
ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ë©´ ë‘ í˜¸ì¶œ ëª¨ë‘ 3ì„ ë¡œë“œí•˜ê³  ë‘ í˜¸ì¶œ ëª¨ë‘ 4ë¥¼ ì“°ì§€ë§Œ,
ì •ë‹µì€ 5ì—¬ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="webgpu_center data-table">
  <style>
    .local-race th { text-align: center; }
    .local-race td { white-space: pre; }
    .local-race .step { color: #969896; }
  </style>
  <div>
  <table class="local-race">
    <thead>
      <tr><th>í˜¸ì¶œ 1</th>
      <th>í˜¸ì¶œ 2</th>
    </tr></thead>
    <tbody>
      <tr>
        <td>value = bins[bin]     <span class="step">// 3ì„ ë¡œë“œ</span></td>
        <td>value = bins[bin]     <span class="step">// 3ì„ ë¡œë“œ</span></td>
      </tr><tr>
        <td>value = value + 1     <span class="step">// 1ì„ ë”í•¨</span></td>
        <td>value = value + 1     <span class="step">// 1ì„ ë”í•¨</span></td>
      </tr>
      <tr>
        <td>bins[bin] = value     <span class="step">// 4ë¥¼ ì €ì¥</span></td>
        <td>bins[bin] = value     <span class="step">// 4ë¥¼ ì €ì¥</span></td>
      </tr>
    </tbody>
  </table>
  </div>
</div>
<p>ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ë¬¸ì œë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ í˜¸ì¶œì´
ë¹ˆì˜ í˜„ì¬ ê°’ì„ ê°€ì ¸ì™€ì„œ 1ì„ ë”í•˜ê³  ë‹¤ì‹œ ë„£ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìœ¼ë©°,
ê°ê°ì€ ë‹¤ë¥¸ í˜¸ì¶œì´ ë™ì‹œì— ê°™ì€ ë¹ˆì„ ì½ê³  ì—…ë°ì´íŠ¸í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ëª¨ë¦…ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="race"></div></div>
<p>WGSLì—ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ íŠ¹ë³„í•œ â€œì›ìì (atomic)â€ ëª…ë ¹ì´ ìˆìŠµë‹ˆë‹¤.
ì´ ê²½ìš° <code class="notranslate" translate="no">atomicAdd</code>ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code class="notranslate" translate="no">atomicAdd</code>ëŠ” ë§ì…ˆì„ "ì›ìì "ìœ¼ë¡œ ë§Œë“¤ì–´
load-&gt;add-&gt;storeì˜ 3ê°€ì§€ ì‘ì—…ì´ ì•„ë‹ˆë¼ ëª¨ë“  3ê°€ì§€ ì‘ì—…ì´ í•œ ë²ˆì— â€œì›ìì ìœ¼ë¡œâ€ ë°œìƒí•©ë‹ˆë‹¤.
ì´ê²ƒì€ íš¨ê³¼ì ìœ¼ë¡œ ë‘ ê°œ ì´ìƒì˜ í˜¸ì¶œì´ ë™ì‹œì— ê°’ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.</p>
<p>ì›ì í•¨ìˆ˜ëŠ” <code class="notranslate" translate="no">i32</code> ë˜ëŠ” <code class="notranslate" translate="no">u32</code>ì—ì„œë§Œ ì‘ë™í•˜ë©° ë°ì´í„° ìì²´ê°€ <code class="notranslate" translate="no">atomic</code> íƒ€ì…ì´ì–´ì•¼ í•œë‹¤ëŠ” ìš”êµ¬ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì…°ì´ë”ì— ëŒ€í•œ ë³€ê²½ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
+@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;atomic&lt;u32&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1, 1, 1)
fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
  let position = global_invocation_id.xy;
  let color = textureLoad(ourTexture, position, 0);
  let v = srgbLuminance(color.rgb);
  let bin = min(u32(v * numBins), lastBinIndex);
-  bins[bin] += 1;
+  atomicAdd(&amp;bins[bin], 1u);
}
</pre>
<p>í”½ì…€ë‹¹ 1ê°œì˜ ì›Œí¬ê·¸ë£¹ í˜¸ì¶œì„ ì‚¬ìš©í•˜ëŠ” ì»´í“¨íŠ¸ ì…°ì´ë”ê°€ ì‘ë™í•©ë‹ˆë‹¤!</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-race-fixed.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-race-fixed.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>ì•ˆíƒ€ê¹ê²Œë„ ìƒˆë¡œìš´ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. <code class="notranslate" translate="no">atomicAdd</code>ëŠ” íš¨ê³¼ì ìœ¼ë¡œ
ë‹¤ë¥¸ í˜¸ì¶œì´ ë™ì‹œì— ê°™ì€ ë¹ˆì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ì°¨ë‹¨í•´ì•¼ í•©ë‹ˆë‹¤.
ì—¬ê¸°ì„œ ë¬¸ì œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ <code class="notranslate" translate="no">atomicAdd</code>ë¥¼ 3ê°€ì§€ ì‘ì—…ìœ¼ë¡œ í‘œì‹œí•˜ì§€ë§Œ
í˜¸ì¶œì´ <code class="notranslate" translate="no">atomicAdd</code>ë¥¼ ìˆ˜í–‰í•  ë•Œ â€œë¹ˆì„ ì ê·¸ë¯€ë¡œâ€
ë‹¤ë¥¸ í˜¸ì¶œì€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram">
  <div>ë‘ ê°œì˜ ì›Œí¬ê·¸ë£¹, í•˜ë‚˜ëŠ” í•˜ë‹¨ ë¹ˆì„ ì ê·¸ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ê°™ì€ í•˜ë‹¨ ë¹ˆì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ì°¨ë‹¨ë¨</div>
  <div data-diagram="lockedBin"></div>
</div>
<p>ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ í˜¸ì¶œì´ ë¹ˆì„ ì ê¸€ ë•Œ í˜¸ì¶œì—ì„œ ë¹ˆê¹Œì§€ ë¹ˆ ìƒ‰ìƒì˜ ì„ ì´ ìˆìŠµë‹ˆë‹¤.
í•´ë‹¹ ë¹ˆì´ ì ê¸ˆ í•´ì œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í˜¸ì¶œì—ëŠ” ì •ì§€ ì‹ í˜¸ ğŸ›‘ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="noRace"></div></div>
<p>ì œ ì»´í“¨í„°ì—ì„œëŠ” ì´ ìƒˆ ë²„ì „ì´ JavaScriptë³´ë‹¤ ì•½ 4ë°° ë¹ ë¥´ê²Œ ì‹¤í–‰ë˜ì§€ë§Œ ê²°ê³¼ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h2 id="ì›Œí¬ê·¸ë£¹">ì›Œí¬ê·¸ë£¹</h2>
<p>ë” ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆì„ê¹Œìš”? <a href="../../webgpu-compute-shaders.html">ì´ì „ ë¬¸ì„œ</a>ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´,
"ì›Œí¬ê·¸ë£¹"ì€ GPUê°€ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì‘ì€ ì‘ì—… ë‹¨ìœ„ì…ë‹ˆë‹¤. ì…°ì´ë” ëª¨ë“ˆì„ ë§Œë“¤ ë•Œ
3ì°¨ì›ìœ¼ë¡œ ì›Œí¬ê·¸ë£¹ì˜ í¬ê¸°ë¥¼ ì •ì˜í•œ ë‹¤ìŒ <code class="notranslate" translate="no">dispatchWorkgroups</code>ë¥¼ í˜¸ì¶œí•˜ì—¬
ì´ëŸ¬í•œ ì›Œí¬ê·¸ë£¹ì„ ì—¬ëŸ¬ ê°œ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
<p>ì›Œí¬ê·¸ë£¹ì€ ë‚´ë¶€ ìŠ¤í† ë¦¬ì§€ë¥¼ ê³µìœ í•˜ê³  ì›Œí¬ê·¸ë£¹ ë‚´ì—ì„œ í•´ë‹¹ ìŠ¤í† ë¦¬ì§€ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ì‚¬ì‹¤ì„ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?</p>
<p>ì´ë ‡ê²Œ ì‹œë„í•´ë´…ì‹œë‹¤. ì›Œí¬ê·¸ë£¹ í¬ê¸°ë¥¼ 256x1(ì›Œí¬ê·¸ë£¹ë‹¹ 256ê°œì˜ í˜¸ì¶œ)ë¡œ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.
ê° í˜¸ì¶œì´ ì´ë¯¸ì§€ì˜ 256x1 ì„¹ì…˜ì—ì„œ ì‘ì—…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì´ëŠ”
<code class="notranslate" translate="no">Math.ceil(texture.width / 256) * texture.height</code> ì´ ì›Œí¬ê·¸ë£¹ì„ ê°–ê²Œ ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
2448 Ã— 1505ì¸ ì´ë¯¸ì§€ì˜ ê²½ìš° 10 x 1505, ì¦‰ 15050ê°œì˜ ì›Œí¬ê·¸ë£¹ì´ ë©ë‹ˆë‹¤.</p>
<p>ì›Œí¬ê·¸ë£¹ ë‚´ì˜ í˜¸ì¶œì´ ì›Œí¬ê·¸ë£¹ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ íœ˜ë„ ê°’ì„ ë¹ˆìœ¼ë¡œ í•©ì‚°í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì›Œí¬ê·¸ë£¹ì˜ ì›Œí¬ê·¸ë£¹ ë©”ëª¨ë¦¬ë¥¼ ìì²´ "ì²­í¬"ë¡œ ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ë¥¸ ì›Œí¬ê·¸ë£¹ê³¼ ì¡°ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
ì™„ë£Œë˜ë©´ ë‹¤ë¥¸ ì»´í“¨íŠ¸ ì…°ì´ë”ë¥¼ ì‹¤í–‰í•˜ì—¬ ì²­í¬ë¥¼ í•©ì‚°í•©ë‹ˆë‹¤.</p>
<p>ì…°ì´ë”ë¥¼ í¸ì§‘í•´ë´…ì‹œë‹¤. ë¨¼ì € <code class="notranslate" translate="no">bins</code>ë¥¼ <code class="notranslate" translate="no">storage</code> íƒ€ì…ì—ì„œ
<code class="notranslate" translate="no">workgroup</code> íƒ€ì…ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê°™ì€ ì›Œí¬ê·¸ë£¹ì˜ í˜¸ì¶œê³¼ë§Œ ê³µìœ ë˜ë„ë¡ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;atomic&lt;u32&gt;&gt;;
+const chunkWidth = 256;
+const chunkHeight = 1;
+const chunkSize = chunkWidth * chunkHeight;
+var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
</pre>
<p>ìœ„ì—ì„œ ì‰½ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ìƒìˆ˜ë¥¼ ì„ ì–¸í–ˆìŠµë‹ˆë‹¤.</p>
<p>ê·¸ëŸ° ë‹¤ìŒ ëª¨ë“  ì²­í¬ë¥¼ ìœ„í•œ ìŠ¤í† ë¦¬ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">+@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}
</pre>
<p>ìƒìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›Œí¬ê·¸ë£¹ í¬ê¸°ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wsgl" translate="no">-@compute @workgroup_size(1, 1, 1)
+@compute @workgroup_size(chunkWidth, chunkHeight, 1)
</pre>
<p>ë¹ˆì„ ì¦ê°€ì‹œí‚¤ëŠ” ì£¼ìš” ë¶€ë¶„ì€ ì´ì „ ì…°ì´ë”ì™€ ë§¤ìš° ìœ ì‚¬í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
  let size = textureDimensions(ourTexture, 0);
  let position = global_invocation_id.xy;
+  if (all(position &lt; size)) {
-    let numBins = f32(arrayLength(&amp;bins));
+    let numBins = f32(chunkSize);
    let lastBinIndex = u32(numBins - 1);
    let color = textureLoad(ourTexture, position, 0);
    let v = srgbLuminance(color.rgb);
    let bin = min(u32(v * numBins), lastBinIndex);
    atomicAdd(&amp;bins[bin], 1u);
  }
</pre>
<p>ì²­í¬ í¬ê¸°ê°€ ì…°ì´ë”ì— í•˜ë“œì½”ë”©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— í…ìŠ¤ì²˜ ì™¸ë¶€ì˜
í”½ì…€ì—ì„œ ì‘ì—…í•˜ì§€ ì•Šë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì´ë¯¸ì§€ê°€ 300í”½ì…€
ë„ˆë¹„ì¸ ê²½ìš°, ì²« ë²ˆì§¸ ì›Œí¬ê·¸ë£¹ì€ í”½ì…€ 0ì—ì„œ 255ê¹Œì§€ ì‘ì—…í•©ë‹ˆë‹¤. ë‘ ë²ˆì§¸ ì›Œí¬ê·¸ë£¹ì€
í”½ì…€ 256ì—ì„œ 511ê¹Œì§€ ì‘ì—…í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í”½ì…€ 299ê¹Œì§€ë§Œ ì‘ì—…í•˜ë©´ ë©ë‹ˆë‹¤.
ì´ê²ƒì´ <code class="notranslate" translate="no">if(all(position &lt; size))</code>ê°€ í•˜ëŠ” ì¼ì…ë‹ˆë‹¤. <code class="notranslate" translate="no">position</code>ê³¼ <code class="notranslate" translate="no">size</code> ëª¨ë‘
<code class="notranslate" translate="no">vec2u</code>ì´ë¯€ë¡œ <code class="notranslate" translate="no">position &lt; size</code>ëŠ” 2ê°œì˜ ë¶€ìš¸ ê°’ì„ ìƒì„±í•˜ë©° ì´ëŠ” <code class="notranslate" translate="no">vec2&lt;bool&gt;</code>ì…ë‹ˆë‹¤.
<code class="notranslate" translate="no">all</code> í•¨ìˆ˜ëŠ” ëª¨ë“  ì…ë ¥ì´ trueì´ë©´ <code class="notranslate" translate="no">true</code>ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì½”ë“œëŠ”
<code class="notranslate" translate="no">position.x &lt; size.x</code>ì´ê³  <code class="notranslate" translate="no">position.y &lt; size.y</code>ì¸ ê²½ìš°ì—ë§Œ <code class="notranslate" translate="no">if</code> ë‚´ë¶€ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
<p><code class="notranslate" translate="no">numBins</code>ì˜ ê²½ìš°, ì²­í¬ í¬ê¸°ì— ëŒ€í•´ ì •ì˜í•œ ë§Œí¼ì˜ ë¹ˆì´ ìˆìŠµë‹ˆë‹¤.
<code class="notranslate" translate="no">var&lt;storage&gt;</code>ì— ëŒ€í•´ í–ˆë˜ ê²ƒì²˜ëŸ¼ ë²„í¼ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë” ì´ìƒ í¬ê¸°ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
í¬ê¸°ëŠ” ì…°ì´ë” ëª¨ë“ˆì„ ë§Œë“¤ ë•Œ ì •ì˜ë©ë‹ˆë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì…°ì´ë”ì˜ ê°€ì¥ ë‹¤ë¥¸ ë¶€ë¶„ì…ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunkDim = vec2u(chunkWidth, chunkHeight);
  let chunkPos = global_invocation_id.xy / chunkDim;
  let chunk = chunkPos.y * chunksAcross + chunkPos.x;
  let binPos = global_invocation_id.xy % chunkDim;
  let bin = binPos.y * chunkWidth + binPos.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>ì´ ë¶€ë¶„ì€ ê° í˜¸ì¶œì´ í•˜ë‚˜ì˜ ë¹ˆì„ íŠ¹ì • ì²­í¬ì˜ í•´ë‹¹ ë¹ˆìœ¼ë¡œ ë³µì‚¬í•˜ë„ë¡ í•©ë‹ˆë‹¤.
ì²­í¬ëŠ” ì´ ì›Œí¬ê·¸ë£¹ì´ ì‘ì—…í•˜ëŠ” ì²­í¬ì…ë‹ˆë‹¤.
ì¼ë¶€ ê³„ì‚°ì€ <code class="notranslate" translate="no">global_invocation_id</code>ë¥¼
<code class="notranslate" translate="no">chunkPos</code>ì™€ <code class="notranslate" translate="no">binPos</code> ëª¨ë‘ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ê°’ì€ íš¨ê³¼ì ìœ¼ë¡œ
<code class="notranslate" translate="no">workgroup_id</code>ì™€ <code class="notranslate" translate="no">local_invocation_id</code>ì´ë¯€ë¡œ ì´ ì½”ë“œë¥¼ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunk = workgroup_id.y * chunksAcross + workgroup_id.x;
  let bin = local_invocation_id.y * chunkWidth + local_invocation_id.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ <code class="notranslate" translate="no">workgroup_id</code>ì™€ <code class="notranslate" translate="no">local_invocation_id</code>ë¥¼ ì…°ì´ë” í•¨ìˆ˜ì˜ ì…ë ¥ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
+fn cs(
+  @builtin(global_invocation_id) global_invocation_id: vec3u,
+  @builtin(workgroup_id) workgroup_id: vec3u,
+  @builtin(local_invocation_id) local_invocation_id: vec3u,
+) {

  ...
</pre>
<h2 id="workgroupbarrier"><a id="a-workgroup-barrier"></a>workgroupBarrier</h2>
<p><code class="notranslate" translate="no">workgroupBarrier()</code>ëŠ” íš¨ê³¼ì ìœ¼ë¡œ "ì´ ì›Œí¬ê·¸ë£¹ì˜ ëª¨ë“  í˜¸ì¶œì´ ì´ ì§€ì ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ë©ˆì¶¥ë‹ˆë‹¤"ë¼ê³  ë§í•©ë‹ˆë‹¤.
ê° í˜¸ì¶œì´ <code class="notranslate" translate="no">bins</code>ì˜ ë‹¤ë¥¸ ìš”ì†Œë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ë§Œ, ë‚˜ì¤‘ì— ê° í˜¸ì¶œì´
<code class="notranslate" translate="no">bins</code>ì—ì„œ í•˜ë‚˜ì˜ ìš”ì†Œë§Œ <code class="notranslate" translate="no">chunks</code>ì˜ í•´ë‹¹ ìš”ì†Œë¡œ ë³µì‚¬í•˜ë¯€ë¡œ ë‹¤ë¥¸ ëª¨ë“  í˜¸ì¶œì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•©ë‹ˆë‹¤.</p>
<p>ë‹¤ë¥´ê²Œ ë§í•˜ìë©´, í…ìŠ¤ì²˜ì—ì„œ ì½ëŠ” ìƒ‰ìƒì— ë”°ë¼ ëª¨ë“  í˜¸ì¶œì´ <code class="notranslate" translate="no">bins</code>ì˜ ëª¨ë“  ìš”ì†Œë¥¼ <code class="notranslate" translate="no">atomicAdd</code>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ <code class="notranslate" translate="no">local_invocation_id</code> = 3,0ì¸ í˜¸ì¶œë§Œ <code class="notranslate" translate="no">bin[3]</code>ì„ <code class="notranslate" translate="no">chunks[chunk][3]</code>ìœ¼ë¡œ ë³µì‚¬í•˜ë¯€ë¡œ
ë‹¤ë¥¸ ëª¨ë“  í˜¸ì¶œì´ <code class="notranslate" translate="no">bin[3]</code>ì„ ì—…ë°ì´íŠ¸í•  ê¸°íšŒë¥¼ ê°€ì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.</p>
<p>ëª¨ë‘ í•©ì¹˜ë©´ ìƒˆë¡œìš´ ì…°ì´ë”ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">const chunkWidth = 256;
const chunkHeight = 1;
const chunkSize = chunkWidth * chunkHeight;
var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(chunkWidth, chunkHeight, 1)
fn cs(
  @builtin(global_invocation_id) global_invocation_id: vec3u,
  @builtin(workgroup_id) workgroup_id: vec3u,
  @builtin(local_invocation_id) local_invocation_id: vec3u,
) {
  let size = textureDimensions(ourTexture, 0);
  let position = global_invocation_id.xy;
  if (all(position &lt; size)) {
    let numBins = f32(chunkSize);
    let lastBinIndex = u32(numBins - 1);
    let color = textureLoad(ourTexture, position, 0);
    let v = srgbLuminance(color.rgb);
    let bin = min(u32(v * numBins), lastBinIndex);
    atomicAdd(&amp;bins[bin], 1u);
  }

  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunk = workgroup_id.y * chunksAcross + workgroup_id.x;
  let bin = local_invocation_id.y * chunkWidth + local_invocation_id.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>í•œ ê°€ì§€ ë” í•  ìˆ˜ ìˆëŠ” ê²ƒì€ <code class="notranslate" translate="no">chunkWidth</code>ì™€ <code class="notranslate" translate="no">chunkHeight</code>ë¥¼ í•˜ë“œì½”ë”©í•˜ëŠ” ëŒ€ì‹ 
JavaScriptì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">+  const k = {
+    chunkWidth: 256,
+    chunkHeight: 1,
+  };
+  const sharedConstants = Object.entries(k)
+    .map(([k, v]) =&gt; `const ${k} = ${v};`)
+    .join('\n');

  const histogramChunkModule = device.createShaderModule({
    label: 'histogram chunk shader',
    code: /* wgsl */ `
-      const chunkWidth = 256;
-      const chunkHeight = 1;
+      ${sharedConstants}
      const chunkSize = chunkWidth * chunkHeight;
      var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
      @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
      @group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

      ...
    `,
  });
</pre>
<p>ì´ ì…°ì´ë”ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="chunks"></div></div>
<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ê° ì›Œí¬ê·¸ë£¹ì€ í•œ ì²­í¬ ë¶„ëŸ‰ì˜ í”½ì…€ì„ ì½ê³ 
ë¹ˆì„ ì ì ˆíˆ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, 2ê°œì˜ í˜¸ì¶œì´ ê°™ì€
ë¹ˆì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ëŠ” ê²½ìš° í•˜ë‚˜ëŠ” ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤ ğŸ›‘. ê·¸ í›„ ëª¨ë‘
<code class="notranslate" translate="no">workgroupBarrier</code> ğŸš§ì—ì„œ ì„œë¡œë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ê·¸ í›„ ê° í˜¸ì¶œì€ ë‹´ë‹¹í•˜ëŠ” ë¹ˆì„
ì‘ì—… ì¤‘ì¸ ì²­í¬ì˜ í•´ë‹¹ ë¹ˆìœ¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.</p>
<h2 id="ì²­í¬-í•©ì‚°í•˜ê¸°">ì²­í¬ í•©ì‚°í•˜ê¸°</h2>
<p>ì´ì œ ëª¨ë“  í”½ì…€ íœ˜ë„ ê°’ì´ ê³„ì‚°ë˜ì—ˆì§€ë§Œ ë¹ˆì„ í•©ì‚°í•˜ì—¬ ë‹µì„ ì–»ì–´ì•¼ í•©ë‹ˆë‹¤.
ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì»´í“¨íŠ¸ ì…°ì´ë”ë¥¼ ì‘ì„±í•´ë´…ì‹œë‹¤. ë¹ˆë‹¹ í•˜ë‚˜ì˜ í˜¸ì¶œì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê° í˜¸ì¶œì€ ê° ì²­í¬ì˜ ê°™ì€ ë¹ˆì—ì„œ ëª¨ë“  ê°’ì„ ë”í•œ ë‹¤ìŒ ê²°ê³¼ë¥¼ ì²« ë²ˆì§¸ ì²­í¬ì— ì”ë‹ˆë‹¤.</p>
<p>ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">const chunkWidth = 256;
const chunkHeight = 1;
const chunkSize = chunkWidth * chunkHeight;
@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;

@compute @workgroup_size(chunkSize, 1, 1)
fn cs(@builtin(local_invocation_id) local_invocation_id: vec3u) {
  var sum = u32(0);
  let numChunks = arrayLength(&amp;chunks);
  for (var i = 0u; i &lt; numChunks; i++) {
    sum += chunks[i][local_invocation_id.x];
  }
  chunks[0][local_invocation_id.x] = sum;
}
</pre>
<p>ê·¸ë¦¬ê³  ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ <code class="notranslate" translate="no">chunkWidth</code>ì™€ <code class="notranslate" translate="no">chunkHeight</code>ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const chunkSumModule = device.createShaderModule({
  label: 'chunk sum shader',
  code: /* wgsl */ `
*    ${sharedConstants}
    const chunkSize = chunkWidth * chunkHeight;
    @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;

    @compute @workgroup_size(chunkSize, 1, 1)

    ...
    }
  `,
});
</pre>
<p>ì´ ì…°ì´ë”ëŠ” íš¨ê³¼ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="sum"></div></div>
<p>ì´ì œ ì´ 2ê°œì˜ ì…°ì´ë”ê°€ ìˆìœ¼ë‹ˆ ì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ ì‚¬ìš©í•´ë´…ì‹œë‹¤.
ë‘ ì…°ì´ë” ëª¨ë‘ì— ëŒ€í•œ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  const pipeline = device.createComputePipeline({
-    label: 'histogram',
-    layout: 'auto',
-    compute: {
-      module,
--    },
-  });

+  const histogramChunkPipeline = device.createComputePipeline({
+    label: 'histogram',
+    layout: 'auto',
+    compute: {
+      module: histogramChunkModule,
++    },
+  });
+
+  const chunkSumPipeline = device.createComputePipeline({
+    label: 'chunk sum',
+    layout: 'auto',
+    compute: {
+      module: chunkSumModule,
++    },
+  });
</pre>
<p>ì „ì²´ ì´ë¯¸ì§€ë¥¼ ì»¤ë²„í•  ìˆ˜ ìˆì„ ë§Œí¼ í° ìŠ¤í† ë¦¬ì§€ ë²„í¼ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ë¯€ë¡œ
ì „ì²´ ì´ë¯¸ì§€ë¥¼ ì»¤ë²„í•˜ëŠ” ë° í•„ìš”í•œ ì²­í¬ ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
  const texture = createTextureFromSource(device, imgBitmap);

-  const numBins = 256;
-  const histogramBuffer = device.createBuffer({
-    size: numBins * 4, // 256 entries * 4 bytes per (u32)
-    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
-  });
+  const chunkSize = k.chunkWidth * k.chunkHeight;
+  const chunksAcross = Math.ceil(texture.width / k.chunkWidth);
+  const chunksDown = Math.ceil(texture.height / k.chunkHeight);
+  const numChunks = chunksAcross * chunksDown;
+  const chunksBuffer = device.createBuffer({
+    size: numChunks * chunkSize * 4, // 4 bytes per (u32)
+    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
+  });
</pre>
<p>ê²°ê³¼ë¥¼ ì½ê¸° ìœ„í•œ ê²°ê³¼ ë²„í¼ê°€ ì—¬ì „íˆ í•„ìš”í•˜ì§€ë§Œ ë” ì´ìƒ
ì´ì „ ë²„í¼ì™€ ê°™ì€ í¬ê¸°ê°€ ì•„ë‹™ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const resultBuffer = device.createBuffer({
-    size: histogramBuffer.size,
+    size: chunkSize * 4,  // 4 bytes per (u32)
    usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,
  });
</pre>
<p>ê° íŒ¨ìŠ¤ì— ëŒ€í•œ ë°”ì¸ë“œê·¸ë£¹ì´ í•„ìš”í•©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” í…ìŠ¤ì²˜ì™€ ì²­í¬ë¥¼
ì²« ë²ˆì§¸ ì…°ì´ë”ì— ì „ë‹¬í•˜ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì²­í¬ë¥¼ ë‘ ë²ˆì§¸ ì…°ì´ë”ì— ì „ë‹¬í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  const bindGroup = device.createBindGroup({
+  const histogramBindGroup = device.createBindGroup({
    label: 'histogram bindGroup',
    layout: histogramChunkPipeline.getBindGroupLayout(0),
    entries: [
-      { binding: 0, resource: { buffer: histogramBuffer }},
+      { binding: 0, resource: { buffer: chunksBuffer }},
      { binding: 1, resource: texture.createView() },
    ],
  });

  const chunkSumBindGroup = device.createBindGroup({
    label: 'sum bindGroup',
    layout: chunkSumPipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: { buffer: chunksBuffer }},
    ],
  });
</pre>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì…°ì´ë”ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í”½ì…€ì„ ì½ê³ 
ë¹ˆìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ë¶€ë¶„, ê° ì²­í¬ì— ëŒ€í•´ í•˜ë‚˜ì˜ ì›Œí¬ê·¸ë£¹ì„ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();

+  // ê° ì˜ì—­ì— ëŒ€í•œ íˆìŠ¤í† ê·¸ë¨ ìƒì„±
-  pass.setPipeline(pipeline);
-  pass.setBindGroup(0, bindGroup);
-  pass.dispatchWorkgroups(texture.width, texture.height);
+  pass.setPipeline(histogramChunkPipeline);
+  pass.setBindGroup(0, histogramBindGroup);
+  pass.dispatchWorkgroups(chunksAcross, chunksDown);
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ì²­í¬ë¥¼ í•©ì‚°í•˜ëŠ” ì…°ì´ë”ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë¹ˆë‹¹ 1ê°œì˜ í˜¸ì¶œì„ ì‚¬ìš©í•˜ëŠ”
1ê°œì˜ ì›Œí¬ê·¸ë£¹ì…ë‹ˆë‹¤(256ê°œì˜ í˜¸ì¶œ).</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">+  // ì˜ì—­ í•©ì‚°
+  pass.setPipeline(chunkSumPipeline);
+  pass.setBindGroup(0, chunkSumBindGroup);
+  pass.dispatchWorkgroups(1);
</pre>
<p>ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼í•©ë‹ˆë‹¤.</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-optimized.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-optimized.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>ì œ ì»´í“¨í„°ì—ì„œ íƒ€ì´ë°ì„ ì¸¡ì •í•´ë³´ë‹ˆ ì²« ë²ˆì§¸ ì…°ì´ë”ê°€ 0.2msì— ì‹¤í–‰ë©ë‹ˆë‹¤!
ì „ì²´ ì´ë¯¸ì§€ë¥¼ ì½ê³  ëª¨ë“  ì²­í¬ë¥¼ ë§¤ìš° ë¹ ë¥´ê²Œ ì±„ì› ìŠµë‹ˆë‹¤!</p>
<p>ì•ˆíƒ€ê¹ê²Œë„ ì²­í¬ë¥¼ í•©ì‚°í•˜ëŠ” ë¶€ë¶„ì€ í›¨ì”¬ ì˜¤ë˜ ê±¸ë ¸ìŠµë‹ˆë‹¤. 11ms
ì´ì „ ì…°ì´ë”ë³´ë‹¤ ëŠë¦½ë‹ˆë‹¤!</p>
<p>ë‹¤ë¥¸ ì»´í“¨í„°ì—ì„œëŠ” ì´ì „ ì†”ë£¨ì…˜ì´ 4.4msì˜€ê³  ìƒˆë¡œìš´ ê²ƒì€ 1.7msì˜€ìœ¼ë¯€ë¡œ
ì™„ì „í•œ ì†ì‹¤ì€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.</p>
<p>ë” ì˜í•  ìˆ˜ ìˆì„ê¹Œìš”?</p>
<h2 id="ë¦¬ë“€ìŠ¤">ë¦¬ë“€ìŠ¤</h2>
<p>ìœ„ì˜ ì†”ë£¨ì…˜ì€ ë‹¨ì¼ ì›Œí¬ê·¸ë£¹ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. 256ê°œì˜ í˜¸ì¶œì´ ìˆì§€ë§Œ
ìµœì‹  GPUì—ëŠ” ìˆ˜ì²œ ê°œì˜ ì½”ì–´ê°€ ìˆê³  ìš°ë¦¬ëŠ” ê·¸ ì¤‘ 256ê°œë§Œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
<p>ë¦¬ë“€ì‹±ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ê¸°ìˆ ì„ ì—¬ê¸°ì„œ ì‹œë„í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì›Œí¬ê·¸ë£¹ì´
2ê°œì˜ ì²­í¬ë§Œ ì¶”ê°€í•˜ë„ë¡ í•˜ì—¬ ê²°ê³¼ë¥¼ ì²˜ìŒ 2ê°œì˜ ì²­í¬ ì¤‘ ì²« ë²ˆì§¸ì— ì”ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´
1000ê°œì˜ ì²­í¬ê°€ ìˆìœ¼ë©´ 500ê°œì˜ ì›Œí¬ê·¸ë£¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í›¨ì”¬ ë” ë§ì€ ë³‘ë ¬í™”ì…ë‹ˆë‹¤.
500ê°œì˜ ì²­í¬ê°€ 250ê°œë¡œ, 250 -&gt; 125, 125 -&gt; 63 ë“±ìœ¼ë¡œ
1ê°œì˜ ì²­í¬ë¡œ ì¤„ì¼ ë•Œê¹Œì§€ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="reduceDiagram"></div></div>
<p>í•˜ë‚˜ì˜ ì…°ì´ë”ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ì²­í¬ë¥¼ í•˜ë‚˜ì˜ ì²­í¬ë¡œ ì¤„ì´ê¸° ìœ„í•´ ìŠ¤íŠ¸ë¼ì´ë“œë¥¼ ì „ë‹¬í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
ìŠ¤íŠ¸ë¼ì´ë“œëŠ” í•©ì‚°í•˜ëŠ” ë‘ ë²ˆì§¸ ì²­í¬ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ ì§„í–‰í•´ì•¼ í•˜ëŠ” ì²­í¬ ìˆ˜ì…ë‹ˆë‹¤.
ìŠ¤íŠ¸ë¼ì´ë“œ 1ì„ ì „ë‹¬í•˜ë©´ ì¸ì ‘í•œ ì²­í¬ë¥¼ í•©ì‚°í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¼ì´ë“œ 2ë¥¼ ì „ë‹¬í•˜ë©´ ë‹¤ë¥¸ ëª¨ë“  ì²­í¬ë¥¼ í•©ì‚°í•©ë‹ˆë‹¤. ë“±ë“±â€¦</p>
<p>ì…°ì´ë”ì— ëŒ€í•œ ë³€ê²½ ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const chunkSumModule = device.createShaderModule({
  label: 'chunk sum shader',
  code: /* wgsl */ `
    ${sharedConstants}
    const chunkSize = chunkWidth * chunkHeight;

+    struct Uniforms {
+      stride: u32,
+    };

    @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;vec4u, chunkSize&gt;&gt;;
+    @group(0) @binding(1) var&lt;uniform&gt; uni: Uniforms;

    @compute @workgroup_size(chunkSize, 1, 1) fn cs(
      @builtin(local_invocation_id) local_invocation_id: vec3u,
      @builtin(workgroup_id) workgroup_id: vec3u,
    ) {
-      var sum = u32(0);
-      let numChunks = arrayLength(&amp;chunks);
-      for (var i = 0u; i &lt; numChunks; i++) {
-        sum += chunks[i][local_invocation_id.x];
-      }
-      chunks[0][local_invocation_id.x] = sum;
+      let chunk0 = workgroup_id.x * uni.stride * 2;
+      let chunk1 = chunk0 + uni.stride;
+
+      let sum = chunks[chunk0][local_invocation_id.x] +
+                chunks[chunk1][local_invocation_id.x];
+      chunks[chunk0][local_invocation_id.x] = sum;
    }
  `,
});
</pre>
<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ìœ ë‹ˆí¼ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” <code class="notranslate" translate="no">workgroup_id.x</code>ì™€ <code class="notranslate" translate="no">uni.stride</code>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ
<code class="notranslate" translate="no">chunk0</code>ê³¼ <code class="notranslate" translate="no">chunk1</code>ì„ ê³„ì‚°í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ 2ê°œì˜ ì²­í¬ì—ì„œ 2ê°œì˜ ë¹ˆì„ ë”í•˜ê³ 
ì²« ë²ˆì§¸ì— ë‹¤ì‹œ ì €ì¥í•©ë‹ˆë‹¤.</p>
<p>ì˜¬ë°”ë¥¸ í˜¸ì¶œ ìˆ˜ì™€ ìŠ¤íŠ¸ë¼ì´ë“œ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤.
ì°¸ê³ : ì–´ë‘ì›Œì§„ ì²­í¬ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì²­í¬ì…ë‹ˆë‹¤.</p>
<div class="webgpu_center compute-diagram"><div data-diagram="reduce"></div></div>
<p>ì´ ìƒˆë¡œìš´ ì½”ë“œë¥¼ ì‘ë™ì‹œí‚¤ë ¤ë©´ ê° ìŠ¤íŠ¸ë¼ì´ë“œ ê°’ì— ëŒ€í•œ ìœ ë‹ˆí¼ ë²„í¼ì™€
ë°”ì¸ë“œê·¸ë£¹ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const sumBindGroups = [];
const numSteps = Math.ceil(Math.log2(numChunks));
for (let i = 0; i &lt; numSteps; ++i) {
  const stride = 2 ** i;
  const uniformBuffer = device.createBuffer({
    size: 4,
    usage: GPUBufferUsage.UNIFORM,
    mappedAtCreation: true,
  });
  new Uint32Array(uniformBuffer.getMappedRange()).set([stride]);
  uniformBuffer.unmap();

  const chunkSumBindGroup = device.createBindGroup({
    layout: chunkSumPipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: { buffer: chunksBuffer }},
      { binding: 1, resource: { buffer: uniformBuffer }},
    ],
  });
  sumBindGroups.push(chunkSumBindGroup);
}
</pre>
<p>ê·¸ëŸ° ë‹¤ìŒ 1ê°œì˜ ì²­í¬ë¡œ ì¤„ì¼ ë•Œê¹Œì§€ ì˜¬ë°”ë¥¸ ë””ìŠ¤íŒ¨ì¹˜ ìˆ˜ë¡œ
ì´ê²ƒë“¤ì„ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  // ì˜ì—­ í•©ì‚°
-  pass.setPipeline(chunkSumPipeline);
-  pass.setBindGroup(0, chunkSumBindGroup);
-  pass.dispatchWorkgroups(1);
+  // ì²­í¬ ë¦¬ë“€ìŠ¤
+  const pass = encoder.beginComputePass();
+  pass.setPipeline(chunkSumPipeline);
+  let chunksLeft = numChunks;
+  sumBindGroups.forEach(bindGroup =&gt; {
+    pass.setBindGroup(0, bindGroup);
+    const dispatchCount = Math.floor(chunksLeft / 2);
+    chunksLeft -= dispatchCount;
+    pass.dispatchWorkgroups(dispatchCount);
+  });
</pre>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-optimized-more.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-optimized-more.html" target="_blank">ìƒˆ ì°½ìœ¼ë¡œ ë³´ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</a>
</div>

<p></p>
<p>ì´ ë²„ì „ì˜ íƒ€ì´ë°ì„ ì¸¡ì •í•´ë³´ë‹ˆ í…ŒìŠ¤íŠ¸í•œ ë‘ ì»´í“¨í„° ëª¨ë‘ì—ì„œ 1ms ë¯¸ë§Œì´ ë‚˜ì™”ìŠµë‹ˆë‹¤! ğŸ‰ğŸš€</p>
<p>ë‹¤ì–‘í•œ ì»´í“¨í„°ì˜ íƒ€ì´ë°ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="webgpu_center data-table">
  <div data-diagram="timings"></div>
</div>
<p>íˆìŠ¤í† ê·¸ë¨ì„ ê³„ì‚°í•˜ëŠ” ë” ë¹ ë¥¸ ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì²­í¬ í¬ê¸°ë¥¼ ì‹œë„í•˜ëŠ” ê²ƒë„ ì¢‹ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
256x1ë³´ë‹¤ 16x16ì´ ë” ë‚˜ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ë˜í•œ ì–´ëŠ ì‹œì ì—ì„œ WebGPUëŠ” <em>ì„œë¸Œê·¸ë£¹</em>ì„ ì§€ì›í•  ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë©° ì´ëŠ”
ë˜ ë‹¤ë¥¸ ì „ì²´ ì£¼ì œì´ì ë” ë§ì€ ìµœì í™”ë¥¼ ìœ„í•œ ì˜ì—­ì…ë‹ˆë‹¤.</p>
<p>ì´ ì˜ˆì œë“¤ì´ ì»´í“¨íŠ¸ ì…°ì´ë”ë¥¼ ì‘ì„±í•˜ê³  ìµœì í™”í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ
ì•„ì´ë””ì–´ë¥¼ ì œê³µí–ˆê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ìš”ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<ul>
<li>
<p>GPUê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ë³‘ë ¬í™”ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì°¾ìœ¼ì„¸ìš”</p>
</li>
<li>
<p>ê²½ìŸ ì¡°ê±´ì„ ì¸ì‹í•˜ì„¸ìš”</p>
</li>
<li>
<p><code class="notranslate" translate="no">var&lt;workgroup&gt;</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›Œí¬ê·¸ë£¹ì˜ ëª¨ë“  í˜¸ì¶œ ê°„ì— ê³µìœ ë˜ëŠ” ìŠ¤í† ë¦¬ì§€ë¥¼ ë§Œë“œì„¸ìš”</p>
</li>
<li>
<p>í˜¸ì¶œ ê°„ ì¡°ì •ì´ ëœ í•„ìš”í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì„¤ê³„í•˜ì„¸ìš”.</p>
</li>
<li>
<p>ì¡°ì •ì´ í•„ìš”í•œ ê²½ìš° ì›ì ì—°ì‚°ê³¼ <code class="notranslate" translate="no">workgroupBarrier</code>ê°€ ì†”ë£¨ì…˜ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ìš°ë¦¬ëŠ” ì´ ë¶€ë¶„ì—ì„œ ê·¸ëŸ­ì €ëŸ­ í–ˆìŠµë‹ˆë‹¤. ì›Œí¬ê·¸ë£¹ ë©”ëª¨ë¦¬ì—ì„œ ì²­í¬ë¥¼ ê³„ì‚°í•  ë•Œ
ì—¬ì „íˆ ì¶©ëŒì´ ìˆìœ¼ë©° <code class="notranslate" translate="no">atomicAdd</code>ë¥¼ í†µí•´ í•´ê²°í–ˆì§€ë§Œ ì›Œí¬ê·¸ë£¹ì˜ <code class="notranslate" translate="no">bins</code>ì—ì„œ
<code class="notranslate" translate="no">chunks</code>ë¡œ ë³µì‚¬í•  ë•ŒëŠ” ì¶©ëŒì´ ì—†ìœ¼ë©° <code class="notranslate" translate="no">chunks</code>ë¥¼ í•˜ë‚˜ì˜ ìµœì¢… ê²°ê³¼ë¡œ ì¤„ì¼ ë•Œë„ ì¶©ëŒì´ ì—†ìŠµë‹ˆë‹¤.</p>
</li>
</ul>
<p>í•˜ë‚˜ ë”</p>
<ul>
<li>
<p>GPUê°€ ë¹ ë¥´ë‹¤ê³  ê°€ì •í•˜ì§€ ë§ˆì„¸ìš”.</p>
<p>GPUì˜ ê°œë³„ ì½”ì–´ëŠ” ê·¸ë‹¤ì§€ ë¹ ë¥´ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ë°°ì› ìŠµë‹ˆë‹¤. ëª¨ë“  ì†ë„ëŠ”
ë³‘ë ¬í™”ì—ì„œ ë‚˜ì˜¤ë¯€ë¡œ ë³‘ë ¬ ì†”ë£¨ì…˜ì„ ì„¤ê³„í•´ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
</ul>
<p><a href="webgpu-compute-shaders-histogram-part-2.html">ë‹¤ìŒ ë¬¸ì„œ</a>ì—ì„œëŠ”
ì´ê²ƒë“¤ì„ ì•½ê°„ ì¡°ì •í•˜ê³  JavaScriptë¡œ ê°€ì ¸ì˜¤ëŠ” ëŒ€ì‹ 
GPUë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ê·¸ë˜í”„ë¡œ ê·¸ë¦¬ë„ë¡ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.
ë˜í•œ ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ì„ ìƒì„±í•œ ê²ƒì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ ì¡°ì •ì„ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<!-- keep this at the bottom of the article -->
<link rel="stylesheet" href="../webgpu-compute-shaders-histogram.css">
<script type="module" src="../webgpu-compute-shaders-histogram.js"></script>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgpu/lessons/webgpu-compute-shaders-histogram.html">English
    </option><option value="/webgpu/lessons/es/webgpu-compute-shaders-histogram.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">æ—¥æœ¬èª
    </option><option value="/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html" selected="">í•œêµ­ì–´
    </option><option value="/webgpu/lessons/ru/webgpu-compute-shaders-histogram.html">Ğ ÑƒÑÑĞºĞ¸Ğ¹
    </option><option value="/webgpu/lessons/tr/webgpu-compute-shaders-histogram.html">TÃ¼rkÃ§e
    </option><option value="/webgpu/lessons/uk/webgpu-compute-shaders-histogram.html">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°
    </option><option value="/webgpu/lessons/zh_cn/webgpu-compute-shaders-histogram.html">ç®€ä½“ä¸­æ–‡
</option></select>


        <div id="toc">
          <ul>  <li>ê¸°ì´ˆ</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-fundamentals.html">ê¸°ì´ˆ</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-inter-stage-variables.html">ìŠ¤í…Œì´ì§€ê°„ ë³€ìˆ˜(Inter-stage Variables)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-uniforms.html">Uniforms</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-storage-buffers.html">ìŠ¤í† ë¦¬ì§€ ë²„í¼(Storage Buffers)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-vertex-buffers.html">ì •ì  ë²„í¼</a></li>
  <li>í…ìŠ¤ì²˜</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-textures.html">í…ìŠ¤ì²˜</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-importing-textures.html">ì´ë¯¸ì§€ ë¡œë”©</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-textures-external-video.html">ë¹„ë””ì˜¤ ì‚¬ìš©í•˜ê¸°</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-cube-maps.html">íë¸Œë§µ(Cube Maps)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-storage-textures.html">ìŠ¤í† ë¦¬ì§€ í…ìŠ¤ì²˜</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-multisampling.html">ë©€í‹° ìƒ˜í”Œë§ / MSAA</a></li>
        </ul>
<li><a href="/webgpu/lessons/ko/webgpu-constants.html">ìƒìˆ˜(Constants)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-memory-layout.html">ë°ì´í„° ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-transparency.html">Transparency and Blending</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-bind-group-layouts.html">ë°”ì¸ë“œ ê·¸ë£¹ ë ˆì´ì•„ì›ƒ</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-copying-data.html">ë°ì´í„° ë³µì‚¬í•˜ê¸°</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-limits-and-features.html">ì„ íƒì  ê¸°ëŠ¥(optional feature)ê³¼ ì œí•œ(limit)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-timing.html">íƒ€ì´ë° ì„±ëŠ¥</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-wgsl.html">WGSL</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-how-it-works.html">ë™ì‘ ë°©ì‹</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-compatibility-mode.html">Compatibility Mode</a></li>
        </ul>
  <li>3D ìˆ˜í•™</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-translation.html">Translation</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-rotation.html">Rotation</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-scale.html">Scale</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-matrix-math.html">Matrix Math</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-orthographic-projection.html">Orthographic Projection</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-perspective-projection.html">Perspective Projection</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-cameras.html">Cameras</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-matrix-stacks.html">Matrix Stacks</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-scene-graphs.html">Scene Graphs</a></li>
        </ul>
  <li>ì¡°ëª…</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-lighting-directional.html">Directional Lighting</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-lighting-point.html">Point Lighting</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>ê¸°ë²•</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-large-triangle-to-cover-clip-space.html">Large Clip Space Triangle</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-environment-maps.html">Environment maps</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-skybox.html">Skyboxes</a></li>
        </ul>
  <li>í›„ì²˜ë¦¬</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-post-processing.html">Basic CRT Effect</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-image-adjustments.html">Image Adjustments</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-1dlut.html">1D Lookup Table (LUT)</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-3dlut.html">3D Lookup Table (LUT)</a></li>
        </ul>
  <li>Editor</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-highlighting.html">Highlighting</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-camera-controls.html">Camera Controls</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-picking.html">Picking</a></li>
        </ul>
        </ul>
  <li>ì»´í“¨íŠ¸ ì…°ì´ë”</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-compute-shaders.html">ì»´í“¨íŠ¸ ì…°ì´ë” ê¸°ì´ˆ</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html">ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-compute-shaders-histogram-part-2.html">ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨ Part 2</a></li>
        </ul>
  <li>ê¸°íƒ€</li>
        <ul>
          <li><a href="/webgpu/lessons/ko/webgpu-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-multiple-canvases.html">Multiple Canvases</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-points.html">Points</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-from-webgl.html">WebGPU from WebGL</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-optimization.html">Speed and Optimization</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-debugging.html">ë””ë²„ê¹…ê³¼ ì—ëŸ¬</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-resources.html">ë¦¬ì†ŒìŠ¤ / ì°¸ê³ ìë£Œ</a></li>
<li><a href="/webgpu/lessons/ko/webgpu-wgsl-function-reference.html">WGSL Function Reference</a></li>
<li><a href="/webgpu/lessons/resources/wgsl-offset-computer.html">WGSL Offset Computer</a></li>
        </ul></ul>
<ul>
  <li><a href="https://github.com/webgpu/webgpufundamentals">github</a></li>
  <li><a href="/webgpu/lessons/resources/wgsl-offset-computer.html">WGSL Offset Computer</a></li>
  <li><a href="https://google.github.io/tour-of-wgsl/">Tour of WGSL</a></li>
  <li><a href="https://gpuweb.github.io/types/">WebGPU API Reference</a></li>
  <li><a href="https://www.w3.org/TR/webgpu/">WebGPU Spec</a></li>
  <li><a href="https://www.w3.org/TR/WGSL/">WGSL Spec</a></li>
  <li><a href="https://webgpureport.org">WebGPUReport.org</a></li>
  <li><a href="https://web3dsurvey.com/webgpu">Web3DSurvey.com</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        
<div>ì§ˆë¬¸ì´ ìˆë‚˜ìš”? <a href="http://stackoverflow.com/questions/tagged/webgpu">Stack Overflow</a>ì— ë¬¼ì–´ë³´ì„¸ìš”.</div>
<div>
   <a href="https://github.com/webgpu/webgpufundamentals/issues/new?assignees=&amp;labels=suggested+topic&amp;template=suggest-topic.md&amp;title=%5BSUGGESTION%5D">ì œì•ˆ</a> /
   <a href="https://github.com/webgpu/webgpufundamentals/issues/new?assignees=&amp;labels=&amp;template=request.md&amp;title=">ìš”ì²­ ì‚¬í•­</a> /
   <a href="https://github.com/webgpu/webgpufundamentals/issues/new?assignees=&amp;labels=bug+%2F+issue&amp;template=bug-issue-report.md&amp;title=">ì´ìŠˆ</a> /
   <a href="https://github.com/webgpu/webgpufundamentals/issues/new?assignees=&amp;labels=bug+%2F+issue&amp;template=bug-issue-report.md&amp;title=">ë²„ê·¸</a>
</div>
  

        <div id="disqus_thread"></div>
        <script>
            var disqus_config = function () {
              this.page.url = `${window.location.origin}${window.location.pathname}`;
              this.page.identifier = `WebGPU ì»´í“¨íŠ¸ ì…°ì´ë” - ì´ë¯¸ì§€ íˆìŠ¤í† ê·¸ë¨`;
            };
            (function() { // DON'T EDIT BELOW THIS LINE
                if (window.location.hostname.indexOf("webgpufundamentals.org") < 0) {
                    return;
                }
                var d = document, s = d.createElement('script');
                s.src = 'https://webgpufundamentals-org.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>

<script>
const settings = {
  contribTemplate: "<a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a>ë‹˜<br> ë‹¹ì‹ ì˜ <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} ê¸°ì—¬ì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.</a>",
  owner: "gfxfundamentals",
  repo: "webgpufundamentals",
};
</script>
<script src="/contributors.js"></script>
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
<script src="/3rdparty/jquery-3.3.1.slim.min.js"></script>
<script src="/webgpu/lessons/resources/js/prettify.js"></script>
<script src="/webgpu/lessons/resources/js/lesson.js" type="module"></script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-92BFT5PE4H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-92BFT5PE4H');
</script>






</body></html>