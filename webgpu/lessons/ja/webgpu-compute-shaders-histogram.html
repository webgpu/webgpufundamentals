<!DOCTYPE html><!-- this file is auto-generated from webgpu/lessons/ja/webgpu-compute-shaders-histogram.md. Do not edited directly --><!--
Copyright 2023, GfxFundamentals Contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

* Redistributions of source code must retain the above copyright
  notice, this list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above
  copyright notice, this list of conditions and the following disclaimer
  in the documentation and/or other materials provided with the
  distribution.

* Neither the name of GfxFundamentals nor the names of the
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


--><html lang="ja"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—ã™ã‚‹ã€‚">
<meta name="keywords" content="webgpu graphics">
<meta name="thumbnail" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ja.jpg">

<meta property="og:title" content="WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ja.jpg">
<meta property="og:description" content="ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—ã™ã‚‹ã€‚">
<meta property="og:url" content="https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgpufundamentals.org">
<meta name="twitter:title" content="WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ">
<meta name="twitter:url" content="https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">
<meta name="twitter:description" content="ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—ã™ã‚‹ã€‚">
<meta name="twitter:image:src" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ja.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgpufundamentals.org/#website",
      "url":"https://webgpufundamentals.org/",
      "name":"webgpufundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html#primaryimage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-compute-shaders-histogram_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html#webpage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html",
      "inLanguage":"ja",
      "name":"WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ",
      "keywords":"webgpu graphics programming",
      "isPartOf":{
        "@id":"https://webgpufundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html#primaryimage"
      }
    }
  ]
}
</script>

<title>WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ </title>
<link href="/webgpu/lessons/resources/webgpufundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="apple-touch-icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">
<link rel="icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">

<link rel="stylesheet" href="/webgpu/lessons/lang.css">
<link rel="stylesheet" href="/webgpu/lessons/resources/lesson.css">
</head>
<body>
<div class="webgpu_navbar">
  <div>
    <select class="language">
    <option value="/webgpu/lessons/webgpu-compute-shaders-histogram.html">English
    </option><option value="/webgpu/lessons/es/webgpu-compute-shaders-histogram.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html" selected="">æ—¥æœ¬èª
    </option><option value="/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html">í•œêµ­ì–´
    </option><option value="/webgpu/lessons/ru/webgpu-compute-shaders-histogram.html">Ğ ÑƒÑÑĞºĞ¸Ğ¹
    </option><option value="/webgpu/lessons/tr/webgpu-compute-shaders-histogram.html">TÃ¼rkÃ§e
    </option><option value="/webgpu/lessons/uk/webgpu-compute-shaders-histogram.html">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°
    </option><option value="/webgpu/lessons/zh_cn/webgpu-compute-shaders-histogram.html">ç®€ä½“ä¸­æ–‡
</option></select>


    <a href="#toc">ç›®æ¬¡</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgpu_header">
  <h1><a href="/webgpu/lessons/ja/">webgpufundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(160px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub">
  <div>
    <div><a href="https://github.com/webgpu/webgpufundamentals">Fix, Fork, Contribute <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"></path>
    </g>
</svg>
</a></div>
  </div>
</div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ </h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <div class="warn">ã“ã®è¨˜äº‹ã¯Gemini Code Assistã«ã‚ˆã£ã¦è‡ªå‹•ç¿»è¨³ã•ã‚Œã¾ã—ãŸã€‚ç¿»è¨³ã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ãŠæ‰‹æ•°ã§ã™ãŒ<a href="https://github.com/webgpu/webgpufundamentals/pulls">ã“ã¡ã‚‰</a>ã‹ã‚‰Pull Requestã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚</div>
<p>ã“ã®è¨˜äº‹ã¯ã€<a href="webgpu-compute-shaders.html">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®åŸºæœ¬ã«é–¢ã™ã‚‹è¨˜äº‹</a>ã®ç¶šãã§ã™ã€‚</p>
<p>ã“ã‚Œã¯2éƒ¨æ§‹æˆã®é•·ã„è¨˜äº‹ã«ãªã‚Šã€ç‰©äº‹ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«å¤šãã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¸ã¿ã¾ã™ã€‚ã“ã®æœ€é©åŒ–ã«ã‚ˆã‚Šç‰©äº‹ã¯é«˜é€Ÿã«ãªã‚Šã¾ã™ãŒã€æ®‹å¿µãªãŒã‚‰å‡ºåŠ›ã¯çµæœã‚’å¤‰æ›´ã—ãªã„ãŸã‚ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨åŒã˜ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚</p>
<p>ã•ã‚‰ã«ã€é€Ÿåº¦ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦è¨€åŠã—ã¾ã™ãŒã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã¨ã€è¨˜äº‹ã¨ä¾‹ãŒã•ã‚‰ã«é•·ããªã‚‹ãŸã‚ã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦ã¯<a href="webgpu-timing.html">åˆ¥ã®è¨˜äº‹</a>ã«è­²ã‚Šã€ã“ã‚Œã‚‰ã®è¨˜äº‹ã§ã¯ã€ç§è‡ªèº«ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦è¨€åŠã—ã€å®Ÿè¡Œå¯èƒ½ãªä¾‹ã‚’ã„ãã¤ã‹æä¾›ã—ã¾ã™ã€‚ã“ã®è¨˜äº‹ãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ä½œæˆã™ã‚‹1ã¤ã®ä¾‹ã«ãªã‚‹ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</p>
<p>ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¨ã¯ã€ç”»åƒå†…ã®ã™ã¹ã¦ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’ãã®å€¤ã¾ãŸã¯ãã®å€¤ã®ä½•ã‚‰ã‹ã®å°ºåº¦ã§åˆè¨ˆã™ã‚‹ã‚‚ã®ã§ã™ã€‚</p>
<p>ãŸã¨ãˆã°ã€ã“ã®6x7ã®ç”»åƒã§ã™ã€‚</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="image" style="display: inline-block; width: 240px; max-width: 100%;"></div>
    <div style="text-align: center;">6x7</div>
  </div>
</div>
<p>ã“ã‚Œã‚‰ã®è‰²ãŒã‚ã‚Šã¾ã™ã€‚</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="colors" style="display: inline-block; width: 240px; max-width: 100%;"></div>
  </div>
</div>
<p>å„è‰²ã«ã¤ã„ã¦ã€è¼åº¦ãƒ¬ãƒ™ãƒ«ï¼ˆã©ã‚Œã ã‘æ˜ã‚‹ã„ã‹ï¼‰ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§èª¿ã¹ãŸã¨ã“ã‚ã€ã“ã®å¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">// è¼åº¦ã«å¯¾ã—ã¦0ã‹ã‚‰1ã®å€¤ã‚’è¿”ã—ã¾ã™ã€‚
// ã“ã“ã§ã€rã€gã€bã¯ãã‚Œãã‚Œ0ã‹ã‚‰1ã®ç¯„å›²ã§ã™ã€‚
function srgbLuminance(r, g, b) {
  // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
  return r * 0.2126 +
         g * 0.7152 +
         b * 0.0722;
}
</pre>
<p>ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã€å„å€¤ã‚’è¼åº¦ãƒ¬ãƒ™ãƒ«ã«å¤‰æ›ã§ãã¾ã™ã€‚</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="luminance" style="display: inline-block; width: 240px; max-width: 100%;"></div>
  </div>
</div>
<p>ã€Œãƒ“ãƒ³ã€ã®æ•°ã‚’æ±ºã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚3ã¤ã®ãƒ“ãƒ³ã«æ±ºã‚ã¾ã—ã‚‡ã†ã€‚æ¬¡ã«ã€ãã‚Œã‚‰ã®è¼åº¦å€¤ã‚’é‡å­åŒ–ã—ã¦ã€Œãƒ“ãƒ³ã€ã‚’é¸æŠã—ã€å„ãƒ“ãƒ³ã«åã¾ã‚‹ãƒ”ã‚¯ã‚»ãƒ«ã®æ•°ã‚’åˆè¨ˆã§ãã¾ã™ã€‚</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="imageHistogram" style="display: inline-block; width: 40px; max-width: 100%;"></div>
  </div>
</div>
<p>æœ€å¾Œã«ã€ãã‚Œã‚‰ã®ãƒ“ãƒ³ã®å€¤ã‚’ã‚°ãƒ©ãƒ•åŒ–ã§ãã¾ã™ã€‚</p>
<div class="webgpu_center">
  <div>
    <div data-diagram="imageHistogramGraph" style="display: inline-block; width: 96px; max-width: 100%;"></div>
  </div>
</div>
<p>ã‚°ãƒ©ãƒ•ã¯ã€ä¸­ç¨‹åº¦ã®æ˜ã‚‹ã•ã®ãƒ”ã‚¯ã‚»ãƒ«ï¼ˆğŸŸ¥ 16ï¼‰ã‚ˆã‚Šã‚‚æš—ã„ãƒ”ã‚¯ã‚»ãƒ«ï¼ˆğŸŸ¦ 18ï¼‰ãŒå¤šãã€æ˜ã‚‹ã„ãƒ”ã‚¯ã‚»ãƒ«ï¼ˆğŸŸ¨ 8ï¼‰ã¯ã•ã‚‰ã«å°‘ãªã„ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯3ã¤ã®ãƒ“ãƒ³ã ã‘ã§ã¯ãã‚Œã»ã©é¢ç™½ãã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ã“ã®ã‚ˆã†ãªå†™çœŸã‚’æ’®ã‚‹ã¨</p>
<div class="webgpu_center">
  <div>
    <div><img src="../../resources/images/pexels-francesco-ungaro-96938-mid.jpg" style="width: 700px;"></div>
    <div style="text-align: center;"><a href="https://www.pexels.com/photo/cute-kitten-hiding-behind-a-pillow-96938/">å†™çœŸæä¾›ï¼šFrancesco Ungaro</a></div>
  </div>
</div>
<p>ãƒ”ã‚¯ã‚»ãƒ«ã®è¼åº¦å€¤ã‚’æ•°ãˆä¸Šã’ã€ãŸã¨ãˆã°256å€‹ã®ãƒ“ãƒ³ã«åˆ†ã‘ã€ã‚°ãƒ©ãƒ•åŒ–ã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="webgpu_center center">
  <div>
    <div><img src="../resources/histogram-luminosity-photoshop.png" style="width: 237px;" class="nobg"></div>
  </div>
</div>
<p>ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®è¨ˆç®—ã¯éå¸¸ã«ç°¡å˜ã§ã™ã€‚ã¾ãšJavaScriptã§ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData"><code class="notranslate" translate="no">ImageData</code></a>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã«ã€ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function computeHistogram(numBins, imgData) {
  const {width, height, data} = imgData;
  const bins = new Array(numBins).fill(0);
  for (let y = 0; y &lt; height; ++y) {
    for (let x = 0; x &lt; width; ++x) {
      const offset = (y * width + x) * 4;

      const r = data[offset + 0] / 255;
      const g = data[offset + 1] / 255;
      const b = data[offset + 2] / 255;
      const v = srgbLuminance(r, g, b);

      const bin = Math.min(numBins - 1, v * numBins) | 0;
      ++bins[bin];
    }
  }
  return histogram;
}
</pre>
<p>ä¸Šè¨˜ã®ã‚ˆã†ã«ã€å„ãƒ”ã‚¯ã‚»ãƒ«ã‚’ã‚¦ã‚©ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼ã—ã¾ã™ã€‚ç”»åƒã‹ã‚‰rã€gã€bã‚’æŠ½å‡ºã—ã¾ã™ã€‚è¼åº¦å€¤ã‚’è¨ˆç®—ã—ã¾ã™ã€‚ãã‚Œã‚’ãƒ“ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¤‰æ›ã—ã€ãã®ãƒ“ãƒ³ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚</p>
<p>ãã®ãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚ŒãŸã‚‰ã€ã‚°ãƒ©ãƒ•åŒ–ã§ãã¾ã™ã€‚ãƒ¡ã‚¤ãƒ³ã®ã‚°ãƒ©ãƒ•é–¢æ•°ã¯ã€å„ãƒ“ãƒ³ã«å¯¾ã—ã¦ä½•ã‚‰ã‹ã®ã‚¹ã‚±ãƒ¼ãƒ«ã¨ã‚­ãƒ£ãƒ³ãƒã‚¹ã®é«˜ã•ã§ä¹—ç®—ã•ã‚ŒãŸç·šã‚’æç”»ã™ã‚‹ã ã‘ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  ctx.fillStyle = '#fff';

  for (let x = 0; x &lt; numBins; ++x) {
    const v = histogram[x] * scale * height;
    ctx.fillRect(x, height - v, 1, v);
  }
</pre>
<p>ã‚¹ã‚±ãƒ¼ãƒ«ã‚’æ±ºå®šã™ã‚‹ã®ã¯å€‹äººçš„ãªé¸æŠã®ã‚ˆã†ã§ã™ã€‚ã‚¹ã‚±ãƒ¼ãƒ«ã‚’é¸æŠã™ã‚‹ãŸã‚ã®è‰¯ã„å…¬å¼ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã—ã¦ãã ã•ã„ã€‚ğŸ˜… ãƒãƒƒãƒˆã§èª¿ã¹ãŸã¨ã“ã‚ã€ã‚¹ã‚±ãƒ¼ãƒ«ã«ã¤ã„ã¦ã“ã®å…¬å¼ã‚’æ€ã„ã¤ãã¾ã—ãŸã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const numBins = histogram.length;
  const max = Math.max(...histogram);
  const scale = Math.max(1 / max, 0.2 * numBins / numEntries);
</pre>
<p>ã“ã“ã§ã€<code class="notranslate" translate="no">numEntries</code>ã¯ç”»åƒå†…ã®ãƒ”ã‚¯ã‚»ãƒ«ã®ç·æ•°ï¼ˆã¤ã¾ã‚Šã€å¹…*é«˜ã•ï¼‰ã§ã‚ã‚Šã€åŸºæœ¬çš„ã«ã¯ã€æœ€ã‚‚å€¤ã®å¤šã„ãƒ“ãƒ³ãŒã‚°ãƒ©ãƒ•ã®ä¸Šéƒ¨ã«è§¦ã‚Œã‚‹ã‚ˆã†ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ãŒã€ãã®ãƒ“ãƒ³ãŒå¤§ãã™ãã‚‹å ´åˆã¯ã€è¦‹æ „ãˆã®è‰¯ã„ã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹æ¯”ç‡ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€2Dã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆã—ã¦æç”»ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function drawHistogram(histogram, numEntries, height = 100) {
  const numBins = histogram.length;
  const max = Math.max(...histogram);
  const scale = Math.max(1 / max, 0.2 * numBins / numEntries);

  const canvas = document.createElement('canvas');
  canvas.width = numBins;
  canvas.height = height;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  ctx.fillStyle = '#fff';

  for (let x = 0; x &lt; numBins; ++x) {
    const v = histogram[x] * scale * height;
    ctx.fillRect(x, height - v, 1, v);
  }
}
</pre>
<p>æ¬¡ã«ã€ç”»åƒã‚’èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<a href="webgpu-importing-textures.html">ç”»åƒã®èª­ã¿è¾¼ã¿ã«é–¢ã™ã‚‹è¨˜äº‹</a>ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
</pre>
<p>ç”»åƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã«ã¯ã€ç”»åƒã‚’2Dã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»ã—ã€<code class="notranslate" translate="no">getImageData</code>ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function getImageData(img) {
  const canvas = document.createElement('canvas');

  // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç”»åƒã¨åŒã˜ã‚µã‚¤ã‚ºã«ã—ã¾ã™
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;

  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  return ctx.getImageData(0, 0, canvas.width, canvas.height);
}
</pre>
<p>ã¾ãŸã€<a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap"><code class="notranslate" translate="no">ImageBitmap</code></a>ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ã‚‚ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function showImageBitmap(imageBitmap) {
  const canvas = document.createElement('canvas');
  canvas.width = imageBitmap.width;
  canvas.height = imageBitmap.height;

  const bm = canvas.getContext('bitmaprenderer');
  bm.transferFromImageBitmap(imageBitmap);
  document.body.appendChild(canvas);
}
</pre>
<p>ç”»åƒãŒå¤§ãã™ããªã„ã‚ˆã†ã«CSSã‚’è¿½åŠ ã—ã€èƒŒæ™¯è‰²ã‚’æŒ‡å®šã—ã¦æç”»ã™ã‚‹å¿…è¦ãŒãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-css" translate="no">canvas {
  display: block;
  max-width: 256px;
  border: 1px solid #888;
  background-color: #333;
}
</pre>
<p>ãã—ã¦ã€ä¸Šè¨˜ã§æ›¸ã„ãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');

  const imgData = getImageData(imgBitmap);
  const numBins = 256;
  const histogram = computeHistogram(numBins, imgData);

  showImageBitmap(imgBitmap);

  const numEntries = imgData.width * imgData.height;
  drawHistogram(histogram, numEntries);
}
</pre>
<p>ãã—ã¦ã€ã“ã‚ŒãŒç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã§ã™ã€‚</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-javascript.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-javascript.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>JavaScriptã‚³ãƒ¼ãƒ‰ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã€ç°¡å˜ã«ç†è§£ã§ããŸã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚WebGPUã«å¤‰æ›ã—ã¾ã—ã‚‡ã†ï¼</p>
<h1 id="gpuã§ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¨ˆç®—ã™ã‚‹"><a id="a-comptuing-a-histogram"></a>GPUã§ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¨ˆç®—ã™ã‚‹</h1>
<p>æœ€ã‚‚æ˜ç™½ãªè§£æ±ºç­–ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚JavaScriptã®<code class="notranslate" translate="no">computeHistogram</code>é–¢æ•°ã‚’WGSLã«ç›´æ¥å¤‰æ›ã—ã¾ã™ã€‚</p>
<p>è¼åº¦é–¢æ•°ã¯éå¸¸ã«ç°¡å˜ã§ã™ã€‚ã‚‚ã†ä¸€åº¦JavaScriptã‚’ç¤ºã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">// è¼åº¦ã«å¯¾ã—ã¦0ã‹ã‚‰1ã®å€¤ã‚’è¿”ã—ã¾ã™ã€‚
// ã“ã“ã§ã€rã€gã€bã¯ãã‚Œãã‚Œ0ã‹ã‚‰1ã®ç¯„å›²ã§ã™ã€‚
function srgbLuminance(r, g, b) {
  // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
  return r * 0.2126 +
         g * 0.7152 +
         b * 0.0722;
}
</pre>
<p>ãã—ã¦ã€ã“ã‚ŒãŒå¯¾å¿œã™ã‚‹WGSLã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}
</pre>
<p><code class="notranslate" translate="no">dot</code>é–¢æ•°ã¯ã€Œãƒ‰ãƒƒãƒˆç©ã€ã®ç•¥ã§ã€1ã¤ã®ãƒ™ã‚¯ãƒˆãƒ«ã®å„è¦ç´ ã‚’åˆ¥ã®ãƒ™ã‚¯ãƒˆãƒ«ã®å¯¾å¿œã™ã‚‹è¦ç´ ã§ä¹—ç®—ã—ã€ãã®çµæœã‚’åŠ ç®—ã—ã¾ã™ã€‚ä¸Šè¨˜ã®ã‚ˆã†ãª<code class="notranslate" translate="no">vec3f</code>ã®å ´åˆã€æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã§ãã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">fn dot(a: vec3f, b: vec3f) -&gt; f32 {
  return a.x * b.x + a.y * b.y + a.z * b.z;
}
</pre>
<p>ã“ã‚Œã¯JavaScriptã«ã‚ã£ãŸã‚‚ã®ã§ã™ã€‚ä¸»ãªé•ã„ã¯ã€WGSLã§ã¯å€‹ã€…ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ã¯ãªãã€è‰²ã‚’<code class="notranslate" translate="no">vec3f</code>ã¨ã—ã¦æ¸¡ã™ã“ã¨ã§ã™ã€‚</p>
<p>ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¨ˆç®—ã™ã‚‹ä¸»è¦éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã€ã‚‚ã†ä¸€åº¦JavaScriptã‚’ç¤ºã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function computeHistogram(numBins, imgData) {
  const {width, height, data} = imgData;
  const bins = new Array(numBins).fill(0);
  for (let y = 0; y &lt; height; ++y) {
    for (let x = 0; x &lt; width; ++x) {
      const offset = (y * width + x) * 4;

      const r = data[offset + 0] / 255;
      const g = data[offset + 1] / 255;
      const b = data[offset + 2] / 255;
      const v = srgbLuminance(r, g, b);

      const bin = Math.min(numBins - 1, v * numBins) | 0;
      ++bins[bin];
    }
  }
  return bins;
}
</pre>
<p>ã“ã‚ŒãŒå¯¾å¿œã™ã‚‹WGSLã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1) fn cs() {
  let size = textureDimensions(ourTexture, 0);
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
  for (var y = 0u; y &lt; size.y; y++) {
    for (var x = 0u; x &lt; size.x; x++) {
      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
      let v = srgbLuminance(color.rgb);
      let bin = min(u32(v * numBins), lastBinIndex);
      bins[bin] += 1;
    }
  }
}
</pre>
<p>ä¸Šè¨˜ã§ã¯ã€ã‚ã¾ã‚Šå¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚JavaScriptã§ã¯ã€<code class="notranslate" translate="no">imgData</code>ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã€å¹…ã€é«˜ã•ã‚’å–å¾—ã—ã¾ã™ã€‚WGSLã§ã¯ã€<code class="notranslate" translate="no">textureDimensions</code>é–¢æ•°ã«æ¸¡ã™ã“ã¨ã§ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‹ã‚‰å¹…ã¨é«˜ã•ã‚’å–å¾—ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  let size = textureDimensions(ourTexture, 0);
</pre>
<p><code class="notranslate" translate="no">textureDimensions</code>ã¯ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ãƒŸãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ï¼ˆä¸Šè¨˜ã®<code class="notranslate" translate="no">0</code>ï¼‰ã‚’å—ã‘å–ã‚Šã€ãã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®ãƒŸãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ã‚µã‚¤ã‚ºã‚’è¿”ã—ã¾ã™ã€‚</p>
<p>JavaScriptã§è¡Œã£ãŸã‚ˆã†ã«ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®ã™ã¹ã¦ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’ãƒ«ãƒ¼ãƒ—ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  for (var y = 0u; y &lt; size.y; y++) {
    for (var x = 0u; x &lt; size.x; x++) {
</pre>
<p><code class="notranslate" translate="no">textureLoad</code>ã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‹ã‚‰è‰²ã‚’å–å¾—ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
</pre>
<p><code class="notranslate" translate="no">textureLoad</code>ã¯ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®å˜ä¸€ã®ãƒŸãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‹ã‚‰å˜ä¸€ã®ãƒ†ã‚¯ã‚»ãƒ«ã‚’è¿”ã—ã¾ã™ã€‚ãƒ†ã‚¯ã‚¹ãƒãƒ£ã€<code class="notranslate" translate="no">vec2u</code>ãƒ†ã‚¯ã‚»ãƒ«ä½ç½®ã€ãƒŸãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ï¼ˆ<code class="notranslate" translate="no">0</code>ï¼‰ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚</p>
<p>è¼åº¦å€¤ã‚’è¨ˆç®—ã—ã€ãã‚Œã‚’ãƒ“ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¤‰æ›ã—ã¦ã€ãã®ãƒ“ãƒ³ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">      let position = vec2u(x, y);
      let color = textureLoad(ourTexture, position, 0);
+      let v = srgbLuminance(color.rgb);
+      let bin = min(u32(v * numBins), lastBinIndex);
+      bins[bin] += 1;
</pre>
<p>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒã§ããŸã®ã§ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã—ã‚‡ã†ã€‚</p>
<p>ã‹ãªã‚Šæ¨™æº–çš„ãªåˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">async function main() {
  const adapter = await navigator.gpu?.requestAdapter();
  const device = await adapter?.requestDevice();
  if (!device) {
    fail('WebGPUã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãŒå¿…è¦ã§ã™');
    return;
  }
</pre>
<p>æ¬¡ã«ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const module = device.createShaderModule({
    label: 'histogram shader',
    code: `
      @group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
      @group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

      // from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
      const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
      fn srgbLuminance(color: vec3f) -&gt; f32 {
        return saturate(dot(color, kSRGBLuminanceFactors));
      }

      @compute @workgroup_size(1) fn cs() {
        let size = textureDimensions(ourTexture, 0);
        let numBins = f32(arrayLength(&amp;bins));
        let lastBinIndex = u32(numBins - 1);
        for (var y = 0u; y &lt; size.y; y++) {
          for (var x = 0u; x &lt; size.x; x++) {
            let position = vec2u(x, y);
            let color = textureLoad(ourTexture, position, 0);
            let v = srgbLuminance(color.rgb);
            let bin = min(u32(v * numBins), lastBinIndex);
            bins[bin] += 1;
          }
        }
      }
    `,
  });
</pre>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const pipeline = device.createComputePipeline({
    label: 'histogram',
    layout: 'auto',
    compute: {
      module,
    },
  });
</pre>
<p>ç”»åƒã‚’èª­ã¿è¾¼ã‚“ã å¾Œã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½œæˆã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<a href="../webgpu-importing-textures.html#a-create-texture-from-source">ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¸ã®ç”»åƒã®èª­ã¿è¾¼ã¿ã«é–¢ã™ã‚‹è¨˜äº‹</a>ã§æ›¸ã„ãŸ<code class="notranslate" translate="no">createTextureFromSource</code>é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
  const texture = createTextureFromSource(device, imgBitmap);
</pre>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒè‰²ã®å€¤ã‚’åˆè¨ˆã™ã‚‹ãŸã‚ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒãƒ•ã‚¡ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const numBins = 256;
  const histogramBuffer = device.createBuffer({
    size: numBins * 4, // 256ã‚¨ãƒ³ãƒˆãƒª * 4ãƒã‚¤ãƒˆ/u32
    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
  });
</pre>
<p>ãã—ã¦ã€çµæœã‚’å–å¾—ã—ã¦æç”»ã™ã‚‹ãŸã‚ã®ãƒãƒƒãƒ•ã‚¡ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const resultBuffer = device.createBuffer({
    size: histogramBuffer.size,
    usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,
  });
</pre>
<p>ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãƒãƒƒãƒ•ã‚¡ã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«æ¸¡ã™ãŸã‚ã®ãƒã‚¤ãƒ³ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ãŒå¿…è¦ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const bindGroup = device.createBindGroup({
    label: 'histogram bindGroup',
    layout: pipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: histogramBuffer },
      { binding: 1, resource: texture.createView() },
    ],
  });
</pre>
<p>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();
</pre>
<p>ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãƒãƒƒãƒ•ã‚¡ã‚’çµæœãƒãƒƒãƒ•ã‚¡ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();

+  encoder.copyBufferToBuffer(histogramBuffer, 0, resultBuffer, 0, resultBuffer.size);
</pre>
<p>ãã—ã¦ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
  pass.dispatchWorkgroups(1);
  pass.end();

  encoder.copyBufferToBuffer(histogramBuffer, 0, resultBuffer, 0, resultBuffer.size);

+  const commandBuffer = encoder.finish();
+  device.queue.submit([commandBuffer]);
</pre>
<p>æœ€å¾Œã«ã€çµæœãƒãƒƒãƒ•ã‚¡ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€æ—¢å­˜ã®é–¢æ•°ã«æ¸¡ã—ã¦ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’æç”»ã§ãã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  await resultBuffer.mapAsync(GPUMapMode.READ);
  const histogram = new Uint32Array(resultBuffer.getMappedRange());

  showImageBitmap(imgBitmap);

  const numEntries = texture.width * texture.height;
  drawHistogram(histogram, numEntries);

  resultBuffer.unmap();
</pre>
<p>ãã—ã¦ã€ãã‚Œã¯æ©Ÿèƒ½ã™ã‚‹ã¯ãšã§ã™ã€‚</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-slow.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-slow.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>çµæœã‚’è¨ˆæ™‚ã—ãŸã¨ã“ã‚ã€<strong>ã“ã‚Œã¯JavaScriptãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ç´„30å€é…ã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸ!!!</strong> ğŸ˜±ğŸ˜±ğŸ˜± (YMMV)ã€‚</p>
<p>ã©ã†ã—ãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸Šè¨˜ã®è§£æ±ºç­–ã¯å˜ä¸€ã®ãƒ«ãƒ¼ãƒ—ã§è¨­è¨ˆã—ã€ã‚µã‚¤ã‚º1ã®å˜ä¸€ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã¤ã¾ã‚Šã€GPUã®å˜ä¸€ã®ã€Œã‚³ã‚¢ã€ã®ã¿ãŒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®è¨ˆç®—ã«ä½¿ç”¨ã•ã‚ŒãŸã¨ã„ã†ã“ã¨ã§ã™ã€‚GPUã‚³ã‚¢ã¯ä¸€èˆ¬çš„ã«CPUã‚³ã‚¢ã»ã©é«˜é€Ÿã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚CPUã‚³ã‚¢ã«ã¯ã€é€Ÿåº¦ã‚’ä¸Šã’ã‚‹ãŸã‚ã®å¤§é‡ã®è¿½åŠ å›è·¯ãŒã‚ã‚Šã¾ã™ã€‚GPUã¯å¤§è¦æ¨¡ãªä¸¦åˆ—åŒ–ã‹ã‚‰é€Ÿåº¦ã‚’å¾—ã¾ã™ãŒã€è¨­è¨ˆã‚’ã‚ˆã‚Šå˜ç´”ã«ä¿ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ã¯ã€ä¸¦åˆ—åŒ–ã‚’åˆ©ç”¨ã—ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<p>å°ã•ãªã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨ã—ã¦ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã®å›³ã‚’æ¬¡ã«ç¤ºã—ã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram">
  <div data-diagram="single"></div>
</div>
<blockquote>
<h2 id="å›³ã¨ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®é•ã„">å›³ã¨ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®é•ã„</h2>
<p>ã“ã‚Œã‚‰ã®å›³ã¯ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Œå…¨ã«è¡¨ç¾ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
<ul>
<li>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«ã¯256å€‹ã®ãƒ“ãƒ³ãŒã‚ã‚Šã¾ã™ãŒã€3ã¤ã®ãƒ“ãƒ³ã—ã‹è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</li>
<li>ã‚³ãƒ¼ãƒ‰ã¯ç°¡ç•¥åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚</li>
<li>â–¢ã¯ãƒ†ã‚¯ã‚»ãƒ«ã‚«ãƒ©ãƒ¼ã§ã™ã€‚</li>
<li>â—¯ã¯è¼åº¦ã¨ã—ã¦è¡¨ã•ã‚Œã‚‹ãƒ“ãƒ³ã®é¸æŠã§ã™ã€‚</li>
<li>å¤šãã®ã‚‚ã®ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚
<ul>
<li><code class="notranslate" translate="no">wid</code> = <code class="notranslate" translate="no">workgroup_id</code></li>
<li><code class="notranslate" translate="no">gid</code> = <code class="notranslate" translate="no">global_invocation_id</code></li>
<li><code class="notranslate" translate="no">lid</code> = <code class="notranslate" translate="no">local_invocation_id</code></li>
<li><code class="notranslate" translate="no">ourTex</code> = <code class="notranslate" translate="no">ourTexture</code></li>
<li><code class="notranslate" translate="no">texLoad</code> = <code class="notranslate" translate="no">textureLoad</code></li>
<li>ãªã©â€¦</li>
</ul>
</li>
</ul>
<p>ã“ã‚Œã‚‰ã®å¤‰æ›´ã®å¤šãã¯ã€å¤šãã®è©³ç´°ã‚’è¡¨ç¤ºã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¹ãƒšãƒ¼ã‚¹ãŒé™ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ã“ã®æœ€åˆã®ä¾‹ã§ã¯å˜ä¸€ã®å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€é€²ã‚€ã«ã¤ã‚Œã¦ã€ã‚ˆã‚Šå°‘ãªã„ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ˆã‚Šå¤šãã®æƒ…å ±ã‚’è©°ã‚è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å›³ãŒç†è§£ã‚’åŠ©ã‘ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€ç‰©äº‹ã‚’ã‚ˆã‚Šæ··ä¹±ã•ã›ã‚‹ã‚‚ã®ã§ã¯ãªã„ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚ğŸ˜…</p>
</blockquote>
<p>å˜ä¸€ã®GPUå‘¼ã³å‡ºã—ãŒCPUã‚ˆã‚Šã‚‚é…ã„ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã€ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ä¸¦åˆ—åŒ–ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<h2 id="æœ€é©åŒ–---ã‚ˆã‚Šå¤šãã®å‘¼ã³å‡ºã—">æœ€é©åŒ– - ã‚ˆã‚Šå¤šãã®å‘¼ã³å‡ºã—</h2>
<p>ã“ã‚Œã‚’é«˜é€ŸåŒ–ã™ã‚‹æœ€ã‚‚ç°¡å˜ã§æ˜ç™½ãªæ–¹æ³•ã¯ã€ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã«ã¯forãƒ«ãƒ¼ãƒ—ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">for (y) {
   for (x) {
      ...
   }
}
</pre>
<p>ä»£ã‚ã‚Šã«<code class="notranslate" translate="no">global_invocation_id</code>ã‚’å…¥åŠ›ã¨ã—ã¦ä½¿ç”¨ã—ã€ã™ã¹ã¦ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’å€‹åˆ¥ã®å‘¼ã³å‡ºã—ã§å‡¦ç†ã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</p>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«å¿…è¦ãªå¤‰æ›´ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;vec4u&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

// from: https://www.w3.org/WAI/GL/wiki/Relative_luminance
const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1, 1, 1)
-fn cs() {
+fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
-  let size = textureDimensions(ourTexture, 0);
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
-  for (var y = 0u; y &lt; size.y; y++) {
-    for (var x = 0u; x &lt; size.x; x++) {
-      let position = vec2u(x, y);
+  let position = global_invocation_id.xy;
  let color = textureLoad(ourTexture, position, 0);
  let v = srgbLuminance(color.rgb);
  let bin = min(u32(v * numBins), lastBinIndex);
  bins[bin] += 1;
-    }
-  }
}
</pre>
<p>ã”è¦§ã®ã¨ãŠã‚Šã€ãƒ«ãƒ¼ãƒ—ã‚’ãªãã—ã€ä»£ã‚ã‚Šã«<code class="notranslate" translate="no">@builtin(global_invocation_id)</code>å€¤ã‚’ä½¿ç”¨ã—ã¦ã€å„ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãŒå˜ä¸€ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’æ‹…å½“ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ç†è«–çš„ã«ã¯ã€ã“ã‚Œã«ã‚ˆã‚Šã™ã¹ã¦ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’ä¸¦åˆ—ã«å‡¦ç†ã§ãã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ç”»åƒã¯2448Ã—1505ã§ã€ã»ã¼370ä¸‡ãƒ”ã‚¯ã‚»ãƒ«ãªã®ã§ã€ä¸¦åˆ—åŒ–ã®æ©Ÿä¼šã¯ãŸãã•ã‚“ã‚ã‚Šã¾ã™ã€‚</p>
<p>å¿…è¦ãªã‚‚ã†1ã¤ã®å¤‰æ›´ã¯ã€å®Ÿéš›ã«ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();
  pass.setPipeline(pipeline);
  pass.setBindGroup(0, bindGroup);
-  pass.dispatchWorkgroups(1);
+  pass.dispatchWorkgroups(texture.width, texture.height);
  pass.end();
</pre>
<p>å®Ÿè¡Œä¸­ã§ã™ã€‚</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-with-race.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-with-race.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>ä½•ãŒå•é¡Œãªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿãªãœã“ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¯å‰ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¨ä¸€è‡´ã›ãšã€åˆè¨ˆã‚‚ä¸€è‡´ã—ãªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿæ³¨ï¼šãŠä½¿ã„ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã¯ã€ç§ã¨ã¯ç•°ãªã‚‹çµæœãŒå¾—ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ç§ã®å ´åˆã€ã“ã‚Œã¯å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãŒä¸Šã§ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®4ã¤ã®çµæœãŒä¸‹ã§ã™ã€‚</p>
<style>
.local-img img {
  border: 1px solid #888;
  margin: 0.5em;
}
</style>
<div class="webgpu_center local-img">
  <div>
      <img src="../resources/histogram-slow-luminosity.png" class="histogram-img">
      <div style="text-align: center;">å‰ã®çµæœ</div>
  </div>
  <div>
    <div>
        <img src="../resources/histogram-race-01.png" class="histogram-img">
        <img src="../resources/histogram-race-02.png" class="histogram-img">
    </div>
    <div>
        <img src="../resources/histogram-race-03.png" class="histogram-img">
        <img src="../resources/histogram-race-04.png" class="histogram-img">
    </div>
    <div style="text-align: center;">æ–°ã—ã„çµæœ</div>
  </div>
</div>
<p>æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ä¸€è²«æ€§ã®ãªã„çµæœãŒå¾—ã‚‰ã‚Œã¾ã™ï¼ˆå°‘ãªãã¨ã‚‚ç§ã®ãƒã‚·ãƒ³ã§ã¯ï¼‰ã€‚</p>
<p>ä½•ãŒèµ·ã“ã£ãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
<p>ã“ã‚Œã¯ã€<a href="../../webgpu-compute-shaders.html#a-race-conditions">å‰ã®è¨˜äº‹</a>ã§è¿°ã¹ãŸå¤å…¸çš„ãª<em>ç«¶åˆçŠ¶æ…‹</em>ã§ã™ã€‚</p>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã“ã®è¡Œ</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">        bins[bin] += 1;
</pre>
<p>ã¯ã€å®Ÿéš›ã«ã¯ã“ã‚Œã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">   let value = bins[bin];
   value = value + 1
   bins[bin] = value;
</pre>
<p>2ã¤ä»¥ä¸Šã®å‘¼ã³å‡ºã—ãŒä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã€åŒã˜<code class="notranslate" translate="no">bin</code>å€¤ã‚’æŒã¤ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
<p><code class="notranslate" translate="no">bin = 1</code>ã§<code class="notranslate" translate="no">bins[1] = 3</code>ã®2ã¤ã®å‘¼ã³å‡ºã—ã‚’æƒ³åƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ä¸¡æ–¹ã®å‘¼ã³å‡ºã—ãŒ3ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€ä¸¡æ–¹ã®å‘¼ã³å‡ºã—ãŒ4ã‚’æ›¸ãè¾¼ã¿ã¾ã™ãŒã€æ­£ã—ã„ç­”ãˆã¯5ã§ã™ã€‚</p>
<div class="webgpu_center data-table">
  <style>
    .local-race th { text-align: center; }
    .local-race td { white-space: pre; }
    .local-race .step { color: #969896; }
  </style>
  <div>
  <table class="local-race">
    <thead>
      <tr><th>å‘¼ã³å‡ºã—1</th>
      <th>å‘¼ã³å‡ºã—2</th>
    </tr></thead>
    <tbody>
      <tr>
        <td>value = bins[bin]     <span class="step">// 3ã‚’ãƒ­ãƒ¼ãƒ‰</span></td>
        <td>value = bins[bin]     <span class="step">// 3ã‚’ãƒ­ãƒ¼ãƒ‰</span></td>
      </tr><tr>
        <td>value = value + 1     <span class="step">// 1ã‚’è¿½åŠ </span></td>
        <td>value = value + 1     <span class="step">// 1ã‚’è¿½åŠ </span></td>
      </tr>
      <tr>
        <td>bins[bin] = value     <span class="step">// 4ã‚’æ ¼ç´</span></td>
        <td>bins[bin] = value     <span class="step">// 4ã‚’æ ¼ç´</span></td>
      </tr>
    </tbody>
  </table>
  </div>
</div>
<p>ä¸‹ã®å›³ã§å•é¡Œã‚’è¦–è¦šçš„ã«ç¢ºèªã§ãã¾ã™ã€‚ã„ãã¤ã‹ã®å‘¼ã³å‡ºã—ãŒãƒ“ãƒ³ã®ç¾åœ¨ã®å€¤ã‚’å–å¾—ã—ã€ãã‚Œã«1ã‚’åŠ ãˆã¦å…ƒã«æˆ»ã™ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãã‚Œãã‚ŒãŒã€åˆ¥ã®å‘¼ã³å‡ºã—ãŒåŒã˜ãƒ“ãƒ³ã‚’åŒæ™‚ã«èª­ã¿æ›¸ãã—ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ã„ã¦ã„ã¾ã›ã‚“ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="race"></div></div>
<p>WGSLã«ã¯ã€ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ç‰¹åˆ¥ãªã€Œã‚¢ãƒˆãƒŸãƒƒã‚¯ã€å‘½ä»¤ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€<code class="notranslate" translate="no">atomicAdd</code>ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚<code class="notranslate" translate="no">atomicAdd</code>ã¯ã€åŠ ç®—ã‚’ã€Œã‚¢ãƒˆãƒŸãƒƒã‚¯ã€ã«ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ãƒ­ãƒ¼ãƒ‰-&gt;åŠ ç®—-&gt;æ ¼ç´ã®3ã¤ã®æ“ä½œã§ã¯ãªãã€3ã¤ã®æ“ä½œã™ã¹ã¦ãŒä¸€åº¦ã«ã€Œã‚¢ãƒˆãƒŸãƒƒã‚¯ã«ã€è¡Œã‚ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€2ã¤ä»¥ä¸Šã®å‘¼ã³å‡ºã—ãŒåŒæ™‚ã«å€¤ã‚’æ›´æ–°ã™ã‚‹ã®ã‚’åŠ¹æœçš„ã«é˜²ãã¾ã™ã€‚</p>
<p>ã‚¢ãƒˆãƒŸãƒƒã‚¯é–¢æ•°ã«ã¯ã€<code class="notranslate" translate="no">i32</code>ã¾ãŸã¯<code class="notranslate" translate="no">u32</code>ã§ã®ã¿æ©Ÿèƒ½ã—ã€ãƒ‡ãƒ¼ã‚¿è‡ªä½“ãŒ<code class="notranslate" translate="no">atomic</code>å‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†è¦ä»¶ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¸ã®å¤‰æ›´ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;u32&gt;;
+@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;atomic&lt;u32&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(1, 1, 1)
fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
  let numBins = f32(arrayLength(&amp;bins));
  let lastBinIndex = u32(numBins - 1);
  let position = global_invocation_id.xy;
  let color = textureLoad(ourTexture, position, 0);
  let v = srgbLuminance(color.rgb);
  let bin = min(u32(v * numBins), lastBinIndex);
-  bins[bin] += 1;
+  atomicAdd(&amp;bins[bin], 1u);
}
</pre>
<p>ã“ã‚Œã§ã€ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒæ©Ÿèƒ½ã—ã¾ã™ï¼</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-race-fixed.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-race-fixed.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>æ®‹å¿µãªãŒã‚‰ã€æ–°ã—ã„å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚<code class="notranslate" translate="no">atomicAdd</code>ã¯ã€ä»–ã®å‘¼ã³å‡ºã—ãŒåŒã˜ãƒ“ãƒ³ã‚’åŒæ™‚ã«æ›´æ–°ã™ã‚‹ã®ã‚’åŠ¹æœçš„ã«ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã§å•é¡Œã‚’ç¢ºèªã§ãã¾ã™ã€‚ä¸‹ã®å›³ã¯ã€<code class="notranslate" translate="no">atomicAdd</code>ã‚’3ã¤ã®æ“ä½œã¨ã—ã¦ç¤ºã—ã¦ã„ã¾ã™ãŒã€å‘¼ã³å‡ºã—ãŒ<code class="notranslate" translate="no">atomicAdd</code>ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã€åˆ¥ã®å‘¼ã³å‡ºã—ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã«ã€Œãƒ“ãƒ³ã‚’ãƒ­ãƒƒã‚¯ã€ã—ã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram">
  <div>2ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã€1ã¤ã¯ä¸‹ã®ãƒ“ãƒ³ã‚’ãƒ­ãƒƒã‚¯ã—ã€ã‚‚ã†1ã¤ã¯åŒã˜ä¸‹ã®ãƒ“ãƒ³ã®ä½¿ç”¨ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™</div>
  <div data-diagram="lockedBin"></div>
</div>
<p>å›³ã§ã¯ã€å‘¼ã³å‡ºã—ãŒãƒ“ãƒ³ã‚’ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹å ´åˆã€å‘¼ã³å‡ºã—ã‹ã‚‰ãƒ“ãƒ³ã®è‰²ã®ç·šãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãã®ãƒ“ãƒ³ãŒãƒ­ãƒƒã‚¯è§£é™¤ã•ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã„ã‚‹å‘¼ã³å‡ºã—ã«ã¯ã€åœæ­¢æ¨™è­˜ğŸ›‘ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="noRace"></div></div>
<p>ç§ã®ãƒã‚·ãƒ³ã§ã¯ã€ã“ã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯JavaScriptã‚ˆã‚Šã‚‚ç´„4å€é«˜é€Ÿã«å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€YMMVã§ã™ã€‚</p>
<h2 id="ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—">ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—</h2>
<p>ã‚‚ã£ã¨é€Ÿãã§ãã¾ã™ã‹ï¼Ÿ<a href="../../webgpu-compute-shaders.html">å‰ã®è¨˜äº‹</a>ã§è¿°ã¹ãŸã‚ˆã†ã«ã€ã€Œãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã€ã¯ã€GPUã«å®Ÿè¡Œã‚’ä¾é ¼ã§ãã‚‹æœ€å°ã®ä½œæ¥­å˜ä½ã§ã™ã€‚ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ãã«3æ¬¡å…ƒã§ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚ºã‚’å®šç¾©ã—ã€<code class="notranslate" translate="no">dispatchWorkgroups</code>ã‚’å‘¼ã³å‡ºã—ã¦ã“ã‚Œã‚‰ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å¤šæ•°å®Ÿè¡Œã—ã¾ã™ã€‚</p>
<p>ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã¯ã€å†…éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å…±æœ‰ã—ã€ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—è‡ªä½“å†…ã§ãã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’èª¿æ•´ã§ãã¾ã™ã€‚ãã®äº‹å®Ÿã‚’ã©ã®ã‚ˆã†ã«åˆ©ç”¨ã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
<p>ã“ã‚Œã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚ºã‚’256x1ï¼ˆãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚ãŸã‚Š256å›ã®å‘¼ã³å‡ºã—ï¼‰ã«ã—ã¾ã™ã€‚å„å‘¼ã³å‡ºã—ãŒç”»åƒã®256x1ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€åˆè¨ˆã§<code class="notranslate" translate="no">Math.ceil(texture.width / 256) * texture.height</code>ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æŒã¤ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚2448Ã—1505ã®ç”»åƒã®å ´åˆã€10 x 1505ã¾ãŸã¯15050ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ãªã‚Šã¾ã™ã€‚</p>
<p>ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®å‘¼ã³å‡ºã—ã«ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã—ã¦ã€è¼åº¦å€¤ã‚’ãƒ“ãƒ³ã«åˆè¨ˆã•ã›ã¾ã™ã€‚</p>
<p>æœ€å¾Œã«ã€ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã‚’ç‹¬è‡ªã®ã€Œãƒãƒ£ãƒ³ã‚¯ã€ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ãã†ã™ã‚Œã°ã€ä»–ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã¨èª¿æ•´ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚å®Œäº†ã—ãŸã‚‰ã€åˆ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãƒãƒ£ãƒ³ã‚¯ã‚’åˆè¨ˆã—ã¾ã™ã€‚</p>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ç·¨é›†ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã€<code class="notranslate" translate="no">bins</code>ã‚’<code class="notranslate" translate="no">storage</code>å‹ã‹ã‚‰<code class="notranslate" translate="no">workgroup</code>å‹ã«å¤‰æ›´ã—ã¦ã€åŒã˜ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®å‘¼ã³å‡ºã—ã¨ã®ã¿å…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-@group(0) @binding(0) var&lt;storage, read_write&gt; bins: array&lt;atomic&lt;u32&gt;&gt;;
+const chunkWidth = 256;
+const chunkHeight = 1;
+const chunkSize = chunkWidth * chunkHeight;
+var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
</pre>
<p>ä¸Šè¨˜ã§ã¯ã€ç°¡å˜ã«å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã„ãã¤ã‹ã®å®šæ•°ã‚’å®£è¨€ã—ã¾ã—ãŸã€‚</p>
<p>æ¬¡ã«ã€ã™ã¹ã¦ã®ãƒãƒ£ãƒ³ã‚¯ç”¨ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">+@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}
</pre>
<p>å®šæ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚ºã‚’å®šç¾©ã§ãã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wsgl" translate="no">-@compute @workgroup_size(1, 1, 1)
+@compute @workgroup_size(chunkWidth, chunkHeight, 1)
</pre>
<p>ãƒ“ãƒ³ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ä¸»è¦éƒ¨åˆ†ã¯ã€å‰ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¨éå¸¸ã«ã‚ˆãä¼¼ã¦ã„ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
  let size = textureDimensions(ourTexture, 0);
  let position = global_invocation_id.xy;
+  if (all(position &lt; size)) {
-    let numBins = f32(arrayLength(&amp;bins));
+    let numBins = f32(chunkSize);
    let lastBinIndex = u32(numBins - 1);
    let color = textureLoad(ourTexture, position, 0);
    let v = srgbLuminance(color.rgb);
    let bin = min(u32(v * numBins), lastBinIndex);
    atomicAdd(&amp;bins[bin], 1u);
  }
</pre>
<p>ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã¯ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£å¤–ã®ãƒ”ã‚¯ã‚»ãƒ«ã§ä½œæ¥­ã—ãŸãã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã¨ãˆã°ã€ç”»åƒãŒ300ãƒ”ã‚¯ã‚»ãƒ«å¹…ã®å ´åˆã€æœ€åˆã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã¯ãƒ”ã‚¯ã‚»ãƒ«0ã‹ã‚‰255ã§ä½œæ¥­ã—ã¾ã™ã€‚2ç•ªç›®ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã¯ãƒ”ã‚¯ã‚»ãƒ«256ã‹ã‚‰511ã§ä½œæ¥­ã—ã¾ã™ãŒã€ãƒ”ã‚¯ã‚»ãƒ«299ã¾ã§ã—ã‹ä½œæ¥­ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚ŒãŒ<code class="notranslate" translate="no">if(all(position &lt; size))</code>ã®å½¹å‰²ã§ã™ã€‚<code class="notranslate" translate="no">position</code>ã¨<code class="notranslate" translate="no">size</code>ã¯ä¸¡æ–¹ã¨ã‚‚<code class="notranslate" translate="no">vec2u</code>ãªã®ã§ã€<code class="notranslate" translate="no">position &lt; size</code>ã¯2ã¤ã®ãƒ–ãƒ¼ãƒ«å€¤ã€ã¤ã¾ã‚Š<code class="notranslate" translate="no">vec2&lt;bool&gt;</code>ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<code class="notranslate" translate="no">all</code>é–¢æ•°ã¯ã€ã™ã¹ã¦ã®å…¥åŠ›ãŒtrueã®å ´åˆã«<code class="notranslate" translate="no">true</code>ã‚’è¿”ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã¯<code class="notranslate" translate="no">position.x &lt; size.x</code>ã¨<code class="notranslate" translate="no">position.y &lt; size.y</code>ã®å ´åˆã«ã®ã¿<code class="notranslate" translate="no">if</code>å†…ã«å…¥ã‚Šã¾ã™ã€‚</p>
<p><code class="notranslate" translate="no">numBins</code>ã«ã¤ã„ã¦ã¯ã€ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã«å®šç¾©ã—ãŸã®ã¨åŒã˜æ•°ã®ãƒ“ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚<code class="notranslate" translate="no">var&lt;storage&gt;</code>ã§è¡Œã£ãŸã‚ˆã†ã«<code class="notranslate" translate="no">var&lt;workgroup&gt;</code>ã«ãƒãƒƒãƒ•ã‚¡ã‚’æ¸¡ã•ãªã„ãŸã‚ã€ã‚µã‚¤ã‚ºã‚’æ¤œç´¢ã§ããªããªã‚Šã¾ã—ãŸã€‚ãã®ã‚µã‚¤ã‚ºã¯ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ãã«å®šç¾©ã•ã‚Œã¾ã™ã€‚</p>
<p>æœ€å¾Œã«ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®æœ€ã‚‚ç•°ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunkDim = vec2u(chunkWidth, chunkHeight);
  let chunkPos = global_invocation_id.xy / chunkDim;
  let chunk = chunkPos.y * chunksAcross + chunkPos.x;
  let binPos = global_invocation_id.xy % chunkDim;
  let bin = binPos.y * chunkWidth + binPos.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>ã“ã®éƒ¨åˆ†ã¯ã€å„å‘¼ã³å‡ºã—ãŒ1ã¤ã®ãƒ“ãƒ³ã‚’ã€ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãŒä½œæ¥­ã—ã¦ã„ã‚‹ç‰¹å®šã®ãƒãƒ£ãƒ³ã‚¯ã®å¯¾å¿œã™ã‚‹ãƒ“ãƒ³ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã ã‘ã§ã™ã€‚<code class="notranslate" translate="no">global_invocation_id</code>ã‚’<code class="notranslate" translate="no">chunkPos</code>ã¨<code class="notranslate" translate="no">binPos</code>ã®ä¸¡æ–¹ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®è¨ˆç®—ã®ä¸€éƒ¨ã§ã™ã€‚ã“ã‚Œã‚‰ã®å€¤ã¯ã€äº‹å®Ÿä¸Š<code class="notranslate" translate="no">workgroup_id</code>ã¨<code class="notranslate" translate="no">local_invocation_id</code>ãªã®ã§ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æ¬¡ã®ã‚ˆã†ã«ç°¡ç•¥åŒ–ã§ãã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunk = workgroup_id.y * chunksAcross + workgroup_id.x;
  let bin = local_invocation_id.y * chunkWidth + local_invocation_id.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>æ¬¡ã«ã€<code class="notranslate" translate="no">workgroup_id</code>ã¨<code class="notranslate" translate="no">local_invocation_id</code>ã‚’ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼é–¢æ•°ã®å…¥åŠ›ã¨ã—ã¦è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">-fn cs(@builtin(global_invocation_id) global_invocation_id: vec3u) {
+fn cs(
+  @builtin(global_invocation_id) global_invocation_id: vec3u,
+  @builtin(workgroup_id) workgroup_id: vec3u,
+  @builtin(local_invocation_id) local_invocation_id: vec3u,
+) {

  ...
</pre>
<h2 id="workgroupbarrier"><a id="a-workgroup-barrier"></a>workgroupBarrier</h2>
<p><code class="notranslate" translate="no">workgroupBarrier()</code>ã¯ã€äº‹å®Ÿä¸Šã€ã€Œã“ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ãŒã“ã®ãƒã‚¤ãƒ³ãƒˆã«åˆ°é”ã™ã‚‹ã¾ã§ã“ã“ã§åœæ­¢ã™ã‚‹ã€ã¨è¨€ã£ã¦ã„ã¾ã™ã€‚ã“ã‚ŒãŒå¿…è¦ãªã®ã¯ã€å„å‘¼ã³å‡ºã—ãŒ<code class="notranslate" translate="no">bins</code>ã®ç•°ãªã‚‹è¦ç´ ã‚’æ›´æ–°ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ãŒã€ãã®å¾Œã€å„å‘¼ã³å‡ºã—ã¯<code class="notranslate" translate="no">bins</code>ã‹ã‚‰1ã¤ã®è¦ç´ ã®ã¿ã‚’<code class="notranslate" translate="no">chunks</code>ã®1ã¤ã®å¯¾å¿œã™ã‚‹è¦ç´ ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãŸã‚ã€ä»–ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>åˆ¥ã®è¨€ã„æ–¹ã‚’ã™ã‚Œã°ã€ã©ã®å‘¼ã³å‡ºã—ã‚‚ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‹ã‚‰èª­ã¿å–ã‚‹è‰²ã«å¿œã˜ã¦<code class="notranslate" translate="no">bins</code>ã®ä»»æ„ã®è¦ç´ ã‚’<code class="notranslate" translate="no">atomicAdd</code>ã§ãã¾ã™ã€‚ã—ã‹ã—ã€<code class="notranslate" translate="no">local_invocation_id</code> = 3,0ã®ã¿ãŒ<code class="notranslate" translate="no">bin[3]</code>ã‚’<code class="notranslate" translate="no">chunks[chunk][3]</code>ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãŸã‚ã€ä»–ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ãŒ<code class="notranslate" translate="no">bin[3]</code>ã‚’æ›´æ–°ã™ã‚‹æ©Ÿä¼šã‚’æŒã¤ã¾ã§å¾…æ©Ÿã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ã“ã‚ŒãŒæ–°ã—ã„ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">const chunkWidth = 256;
const chunkHeight = 1;
const chunkSize = chunkWidth * chunkHeight;
var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
@group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

const kSRGBLuminanceFactors = vec3f(0.2126, 0.7152, 0.0722);
fn srgbLuminance(color: vec3f) -&gt; f32 {
  return saturate(dot(color, kSRGBLuminanceFactors));
}

@compute @workgroup_size(chunkWidth, chunkHeight, 1)
fn cs(
  @builtin(global_invocation_id) global_invocation_id: vec3u,
  @builtin(workgroup_id) workgroup_id: vec3u,
  @builtin(local_invocation_id) local_invocation_id: vec3u,
) {
  let size = textureDimensions(ourTexture, 0);
  let position = global_invocation_id.xy;
  if (all(position &lt; size)) {
    let numBins = f32(chunkSize);
    let lastBinIndex = u32(numBins - 1);
    let color = textureLoad(ourTexture, position, 0);
    let v = srgbLuminance(color.rgb);
    let bin = min(u32(v * numBins), lastBinIndex);
    atomicAdd(&amp;bins[bin], 1u);
  }

  workgroupBarrier();

  let chunksAcross = (size.x + chunkWidth - 1) / chunkWidth;
  let chunk = workgroup_id.y * chunksAcross + workgroup_id.x;
  let bin = local_invocation_id.y * chunkWidth + local_invocation_id.x;

  chunks[chunk][bin] = atomicLoad(&amp;bins[bin]);
}
</pre>
<p>ã‚‚ã†1ã¤ã§ãã‚‹ã“ã¨ã¯ã€<code class="notranslate" translate="no">chunkWidth</code>ã¨<code class="notranslate" translate="no">chunkHeight</code>ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã®ã§ã¯ãªãã€JavaScriptã‹ã‚‰æ¬¡ã®ã‚ˆã†ã«æ¸¡ã™ã“ã¨ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">+  const k = {
+    chunkWidth: 256,
+    chunkHeight: 1,
+  };
+  const sharedConstants = Object.entries(k)
+    .map(([k, v]) =&gt; `const ${k} = ${v};`)
+    .join('\n');

  const histogramChunkModule = device.createShaderModule({
    label: 'histogram chunk shader',
    code: `
-      const chunkWidth = 256;
-      const chunkHeight = 1;
+      ${sharedConstants}
      const chunkSize = chunkWidth * chunkHeight;
      var&lt;workgroup&gt; bins: array&lt;atomic&lt;u32&gt;, chunkSize&gt;;
      @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;
      @group(0) @binding(1) var ourTexture: texture_2d&lt;f32&gt;;

      ...
    `,
  });
</pre>
<p>ã“ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="chunks"></div></div>
<p>ä¸Šè¨˜ã®ã‚ˆã†ã«ã€å„ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã¯1ãƒãƒ£ãƒ³ã‚¯åˆ†ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã«å¿œã˜ã¦ãƒ“ãƒ³ã‚’æ›´æ–°ã—ã¾ã™ã€‚ä»¥å‰ã¨åŒæ§˜ã«ã€2ã¤ã®å‘¼ã³å‡ºã—ãŒåŒã˜ãƒ“ãƒ³ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€ãã®ã†ã¡ã®1ã¤ã¯å¾…æ©Ÿã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ğŸ›‘ã€‚ãã®å¾Œã€ãã‚Œã‚‰ã¯ã™ã¹ã¦<code class="notranslate" translate="no">workgroupBarrier</code>ğŸš§ã§äº’ã„ã«å¾…æ©Ÿã—ã¾ã™ã€‚ãã®å¾Œã€å„å‘¼ã³å‡ºã—ã¯ã€æ‹…å½“ã™ã‚‹ãƒ“ãƒ³ã‚’ã€ä½œæ¥­ã—ã¦ã„ã‚‹ãƒãƒ£ãƒ³ã‚¯ã®å¯¾å¿œã™ã‚‹ãƒ“ãƒ³ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚</p>
<h2 id="ãƒãƒ£ãƒ³ã‚¯ã®åˆè¨ˆ">ãƒãƒ£ãƒ³ã‚¯ã®åˆè¨ˆ</h2>
<p>ã™ã¹ã¦ã®ãƒ”ã‚¯ã‚»ãƒ«ã®è¼åº¦å€¤ãŒã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã—ãŸãŒã€ç­”ãˆã‚’å¾—ã‚‹ã«ã¯ãƒ“ãƒ³ã‚’åˆè¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ãƒ“ãƒ³ã”ã¨ã«1ã¤ã®å‘¼ã³å‡ºã—ã‚’è¡Œã„ã¾ã™ã€‚å„å‘¼ã³å‡ºã—ã¯ã€å„ãƒãƒ£ãƒ³ã‚¯ã®åŒã˜ãƒ“ãƒ³ã®ã™ã¹ã¦ã®å€¤ã‚’åˆè¨ˆã—ã€ãã®çµæœã‚’æœ€åˆã®ãƒãƒ£ãƒ³ã‚¯ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚</p>
<p>ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">const chunkWidth = 256;
const chunkHeight = 1;
const chunkSize = chunkWidth * chunkHeight;
@group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;

@compute @workgroup_size(chunkSize, 1, 1)
fn cs(@builtin(local_invocation_id) local_invocation_id: vec3u) {
  var sum = u32(0);
  let numChunks = arrayLength(&amp;chunks);
  for (var i = 0u; i &lt; numChunks; i++) {
    sum += chunks[i][local_invocation_id.x];
  }
  chunks[0][local_invocation_id.x] = sum;
}
</pre>
<p>ãã—ã¦ã€ä»¥å‰ã¨åŒæ§˜ã«ã€<code class="notranslate" translate="no">chunkWidth</code>ã¨<code class="notranslate" translate="no">chunkHeight</code>ã‚’æŒ¿å…¥ã§ãã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const chunkSumModule = device.createShaderModule({
  label: 'chunk sum shader',
  code: `
*    ${sharedConstants}
    const chunkSize = chunkWidth * chunkHeight;
    @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;u32, chunkSize&gt;&gt;;

    @compute @workgroup_size(chunkSize, 1, 1)

    ...
    }
  `,
});
</pre>
<p>ã“ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¯ã€äº‹å®Ÿä¸Šã€æ¬¡ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="sum"></div></div>
<p>ã“ã‚Œã‚‰ã®2ã¤ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒã§ããŸã®ã§ã€ãã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ã‚‡ã†ã€‚ä¸¡æ–¹ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  const pipeline = device.createComputePipeline({
-    label: 'histogram',
-    layout: 'auto',
-    compute: {
-      module,
--    },
-  });

+  const histogramChunkPipeline = device.createComputePipeline({
+    label: 'histogram',
+    layout: 'auto',
+    compute: {
+      module: histogramChunkModule,
++    },
+  });
+
+  const chunkSumPipeline = device.createComputePipeline({
+    label: 'chunk sum',
+    layout: 'auto',
+    compute: {
+      module: chunkSumModule,
++    },
+  });
</pre>
<p>ã™ã¹ã¦ã®ãƒãƒ£ãƒ³ã‚¯ã«ååˆ†ãªå¤§ãã•ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒãƒ•ã‚¡ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ç”»åƒå…¨ä½“ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒãƒ£ãƒ³ã‚¯ã®æ•°ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const imgBitmap = await loadImageBitmap('resources/images/pexels-francesco-ungaro-96938-mid.jpg');
  const texture = createTextureFromSource(device, imgBitmap);

-  const numBins = 256;
-  const histogramBuffer = device.createBuffer({
-    size: numBins * 4, // 256ã‚¨ãƒ³ãƒˆãƒª * 4ãƒã‚¤ãƒˆ/u32
-    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
-  });
+  const chunkSize = k.chunkWidth * k.chunkHeight;
+  const chunksAcross = Math.ceil(texture.width / k.chunkWidth);
+  const chunksDown = Math.ceil(texture.height / k.chunkHeight);
+  const numChunks = chunksAcross * chunksDown;
+  const chunksBuffer = device.createBuffer({
+    size: numChunks * chunkSize * 4, // 4ãƒã‚¤ãƒˆ/u32
+    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,
+  });
</pre>
<p>çµæœã‚’èª­ã¿å–ã‚‹ãŸã‚ã®çµæœãƒãƒƒãƒ•ã‚¡ã¯ã¾ã å¿…è¦ã§ã™ãŒã€å‰ã®ãƒãƒƒãƒ•ã‚¡ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const resultBuffer = device.createBuffer({
-    size: histogramBuffer.size,
+    size: chunkSize * 4,  // 4ãƒã‚¤ãƒˆ/u32
    usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,
  });
</pre>
<p>å„ãƒ‘ã‚¹ã«ãƒã‚¤ãƒ³ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ãŒå¿…è¦ã§ã™ã€‚1ã¤ã¯ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ãƒãƒ£ãƒ³ã‚¯ã‚’æœ€åˆã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã—ã€ã‚‚ã†1ã¤ã¯ãƒãƒ£ãƒ³ã‚¯ã‚’2ç•ªç›®ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  const bindGroup = device.createBindGroup({
+  const histogramBindGroup = device.createBindGroup({
    label: 'histogram bindGroup',
    layout: histogramChunkPipeline.getBindGroupLayout(0),
    entries: [
-      { binding: 0, resource: histogramBuffer },
+      { binding: 0, resource: chunksBuffer },
      { binding: 1, resource: texture.createView() },
    ],
  });

  const chunkSumBindGroup = device.createBindGroup({
    label: 'sum bindGroup',
    layout: chunkSumPipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: chunksBuffer },
    ],
  });
</pre>
<p>æœ€å¾Œã«ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ã¾ãšã€ãƒ”ã‚¯ã‚»ãƒ«ã‚’èª­ã¿å–ã£ã¦ãƒ“ãƒ³ã«åˆ†é¡ã™ã‚‹éƒ¨åˆ†ã§ã™ã€‚ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã«1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">  const encoder = device.createCommandEncoder({ label: 'histogram encoder' });
  const pass = encoder.beginComputePass();

+  // å„é ˜åŸŸã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã™
-  pass.setPipeline(pipeline);
-  pass.setBindGroup(0, bindGroup);
-  pass.dispatchWorkgroups(texture.width, texture.height);
+  pass.setPipeline(histogramChunkPipeline);
+  pass.setBindGroup(0, histogramBindGroup);
+  pass.dispatchWorkgroups(chunksAcross, chunksDown);
</pre>
<p>æ¬¡ã«ã€ãƒãƒ£ãƒ³ã‚¯ã‚’åˆè¨ˆã™ã‚‹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ“ãƒ³ã”ã¨ã«1ã¤ã®å‘¼ã³å‡ºã—ï¼ˆ256å›ã®å‘¼ã³å‡ºã—ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹1ã¤ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã ã‘ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">+  // é ˜åŸŸã‚’åˆè¨ˆã—ã¾ã™
+  pass.setPipeline(chunkSumPipeline);
+  pass.setBindGroup(0, chunkSumBindGroup);
+  pass.dispatchWorkgroups(1);
</pre>
<p>æ®‹ã‚Šã®ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ã§ã™ã€‚</p>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-optimized.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-optimized.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>ç§ã®ãƒã‚·ãƒ³ã§ã“ã‚Œã‚’è¨ˆæ™‚ã—ãŸã¨ã“ã‚ã€æœ€åˆã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒ0.2msã§å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’è¦‹ã¦ã†ã‚Œã—ãæ€ã„ã¾ã—ãŸï¼ç”»åƒå…¨ä½“ã‚’èª­ã¿å–ã‚Šã€ã™ã¹ã¦ã®ãƒãƒ£ãƒ³ã‚¯ã‚’ã‚ã£ã¨ã„ã†é–“ã«åŸ‹ã‚å°½ãã—ã¾ã—ãŸï¼</p>
<p>æ®‹å¿µãªãŒã‚‰ã€ãƒãƒ£ãƒ³ã‚¯ã‚’åˆè¨ˆã™ã‚‹éƒ¨åˆ†ã¯ã¯ã‚‹ã‹ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚11msã§ã™ã€‚ã“ã‚Œã¯ã€å‰ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚ˆã‚Šã‚‚é…ã„ã§ã™ï¼</p>
<p>åˆ¥ã®ãƒã‚·ãƒ³ã§ã¯ã€å‰ã®è§£æ±ºç­–ã¯4.4msã§ã€ã“ã®æ–°ã—ã„è§£æ±ºç­–ã¯1.7msã ã£ãŸã®ã§ã€å®Œå…¨ãªæå¤±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<p>ã‚‚ã£ã¨ã†ã¾ãã§ãã¾ã™ã‹ï¼Ÿ</p>
<h2 id="ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹</h2>
<p>ä¸Šè¨˜ã®è§£æ±ºç­–ã§ã¯ã€å˜ä¸€ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚256å›ã®å‘¼ã³å‡ºã—ãŒã‚ã‚Šã¾ã™ãŒã€æœ€æ–°ã®GPUã«ã¯æ•°åƒã®ã‚³ã‚¢ãŒã‚ã‚Šã€ãã®ã†ã¡256å€‹ã—ã‹ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
<p>è©¦ã™ã“ã¨ãŒã§ãã‚‹1ã¤ã®æ‰‹æ³•ã¯ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å„ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«2ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã®ã¿ã‚’è¿½åŠ ã•ã›ã€ãã®çµæœã‚’ãã‚Œã‚‰2ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã®æœ€åˆã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§ã€1000å€‹ã®ãƒãƒ£ãƒ³ã‚¯ãŒã‚ã‚‹å ´åˆã€500å€‹ã®ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã¯ã‚‹ã‹ã«å¤šãã®ä¸¦åˆ—åŒ–ã§ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¹°ã‚Šè¿”ã—ã€500å€‹ã®ãƒãƒ£ãƒ³ã‚¯ã‚’250å€‹ã«ã€250å€‹ã‚’125å€‹ã«ã€125å€‹ã‚’63å€‹ã«ã€ã¨ã„ã†ã‚ˆã†ã«ã€1ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã™ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="reduceDiagram"></div></div>
<p>1ã¤ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã¿ã‚’ä½¿ç”¨ã§ãã€ãƒãƒ£ãƒ³ã‚¯ã‚’1ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰ã‚’æ¸¡ã™ã ã‘ã§ã™ã€‚ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰ã¯ã€åˆè¨ˆã—ã¦ã„ã‚‹2ç•ªç›®ã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ°é”ã™ã‚‹ãŸã‚ã«é€²ã‚€å¿…è¦ãŒã‚ã‚‹ãƒãƒ£ãƒ³ã‚¯ã®æ•°ã§ã™ã€‚ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰1ã‚’æ¸¡ã™ã¨ã€éš£æ¥ã™ã‚‹ãƒãƒ£ãƒ³ã‚¯ã‚’åˆè¨ˆã—ã¾ã™ã€‚ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰2ã‚’æ¸¡ã™ã¨ã€1ã¤ãŠãã®ãƒãƒ£ãƒ³ã‚¯ã‚’åˆè¨ˆã—ã¾ã™ã€‚ãªã©â€¦</p>
<p>ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¸ã®å¤‰æ›´ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const chunkSumModule = device.createShaderModule({
  label: 'chunk sum shader',
  code: `
    ${sharedConstants}
    const chunkSize = chunkWidth * chunkHeight;

+    struct Uniforms {
+      stride: u32,
+    };

    @group(0) @binding(0) var&lt;storage, read_write&gt; chunks: array&lt;array&lt;vec4u, chunkSize&gt;&gt;;
+    @group(0) @binding(1) var&lt;uniform&gt; uni: Uniforms;

    @compute @workgroup_size(chunkSize, 1, 1) fn cs(
      @builtin(local_invocation_id) local_invocation_id: vec3u,
      @builtin(workgroup_id) workgroup_id: vec3u,
    ) {
-      var sum = u32(0);
-      let numChunks = arrayLength(&amp;chunks);
-      for (var i = 0u; i &lt; numChunks; i++) {
-        sum += chunks[i][local_invocation_id.x];
-      }
-      chunks[0][local_invocation_id.x] = sum;
+      let chunk0 = workgroup_id.x * uni.stride * 2;
+      let chunk1 = chunk0 + uni.stride;
+
+      let sum = chunks[chunk0][local_invocation_id.x] +
+                chunks[chunk1][local_invocation_id.x];
+      chunks[chunk0][local_invocation_id.x] = sum;
    }
  `,
});
</pre>
<p>ä¸Šè¨˜ã®ã‚ˆã†ã«ã€<code class="notranslate" translate="no">workgroup_id.x</code>ã¨ã€ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã¨ã—ã¦æ¸¡ã™<code class="notranslate" translate="no">uni.stride</code>ã«åŸºã¥ã„ã¦<code class="notranslate" translate="no">chunk0</code>ã¨<code class="notranslate" translate="no">chunk1</code>ã‚’è¨ˆç®—ã—ã¾ã™ã€‚æ¬¡ã«ã€2ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã‹ã‚‰2ã¤ã®ãƒ“ãƒ³ã‚’è¿½åŠ ã—ã€ãã‚Œã‚‰ã‚’æœ€åˆã®ãƒ“ãƒ³ã«æ ¼ç´ã—ã¾ã™ã€‚</p>
<p>æ­£ã—ã„æ•°ã®å‘¼ã³å‡ºã—ã¨ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰è¨­å®šã§å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚æ³¨ï¼šæš—ããªã£ãŸãƒãƒ£ãƒ³ã‚¯ã¯ã€ä½¿ç”¨ã•ã‚Œãªããªã£ãŸãƒãƒ£ãƒ³ã‚¯ã§ã™ã€‚</p>
<div class="webgpu_center compute-diagram"><div data-diagram="reduce"></div></div>
<p>ã“ã®æ–°ã—ã„ã‚‚ã®ã‚’æ©Ÿèƒ½ã•ã›ã‚‹ã«ã¯ã€å„ã‚¹ãƒˆãƒ©ã‚¤ãƒ‰å€¤ã¨ãƒã‚¤ãƒ³ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const sumBindGroups = [];
const numSteps = Math.ceil(Math.log2(numChunks));
for (let i = 0; i &lt; numSteps; ++i) {
  const stride = 2 ** i;
  const uniformBuffer = device.createBuffer({
    size: 4,
    usage: GPUBufferUsage.UNIFORM,
    mappedAtCreation: true,
  });
  new Uint32Array(uniformBuffer.getMappedRange()).set([stride]);
  uniformBuffer.unmap();

  const chunkSumBindGroup = device.createBindGroup({
    layout: chunkSumPipeline.getBindGroupLayout(0),
    entries: [
      { binding: 0, resource: chunksBuffer },
      { binding: 1, resource: uniformBuffer },
    ],
  });
  sumBindGroups.push(chunkSumBindGroup);
}
</pre>
<p>æ¬¡ã«ã€1ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã™ã‚‹ã¾ã§ã€æ­£ã—ã„æ•°ã®ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã§ã“ã‚Œã‚‰ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ã™ã€‚</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">-  // é ˜åŸŸã‚’åˆè¨ˆã—ã¾ã™
-  pass.setPipeline(chunkSumPipeline);
-  pass.setBindGroup(0, chunkSumBindGroup);
-  pass.dispatchWorkgroups(1);
+  // ãƒãƒ£ãƒ³ã‚¯ã‚’ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã—ã¾ã™
+  const pass = encoder.beginComputePass();
+  pass.setPipeline(chunkSumPipeline);
+  let chunksLeft = numChunks;
+  sumBindGroups.forEach(bindGroup =&gt; {
+    pass.setBindGroup(0, bindGroup);
+    const dispatchCount = Math.floor(chunksLeft / 2);
+    chunksLeft -= dispatchCount;
+    pass.dispatchWorkgroups(dispatchCount);
+  });
</pre>
<p></p><div class="webgpu_example_container">
  <div><iframe class="webgpu_example" style=" " src="/webgpu/resources/editor.html?url=/webgpu/lessons/..%2Fwebgpu-compute-shaders-histogram-optimized-more.html"></iframe></div>
  <a class="webgpu_center" href="/webgpu/lessons/../webgpu-compute-shaders-histogram-optimized-more.html" target="_blank">ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ¥ã®ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</a>
</div>

<p></p>
<p>ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨ˆæ™‚ã—ãŸã¨ã“ã‚ã€ãƒ†ã‚¹ãƒˆã—ãŸä¸¡æ–¹ã®ãƒã‚·ãƒ³ã§1msæœªæº€ã§ã—ãŸï¼ğŸ‰ğŸš€</p>
<p>ã•ã¾ã–ã¾ãªãƒã‚·ãƒ³ã‹ã‚‰ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ã„ãã¤ã‹ç¤ºã—ã¾ã™ã€‚</p>
<div class="webgpu_center data-table">
  <div data-diagram="timings"></div>
</div>
<p>ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¨ˆç®—ã™ã‚‹ã‚ˆã‚Šé«˜é€Ÿãªæ–¹æ³•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€ç•°ãªã‚‹ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã‚’è©¦ã™æ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚256x1ã‚ˆã‚Šã‚‚16x16ã®æ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€ã‚ã‚‹æ™‚ç‚¹ã§WebGPUã¯<em>ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—</em>ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å¯èƒ½æ€§ãŒé«˜ãã€ã“ã‚Œã¯ã¾ã£ãŸãåˆ¥ã®ãƒˆãƒ”ãƒƒã‚¯ã§ã‚ã‚Šã€ã•ã‚‰ã«æœ€é©åŒ–ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>ä»Šã®ã¨ã“ã‚ã€ã“ã‚Œã‚‰ã®ä¾‹ãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ä½œæˆã¨æœ€é©åŒ–ã®æ–¹æ³•ã«é–¢ã™ã‚‹ã„ãã¤ã‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æä¾›ã—ãŸã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚è¦ç‚¹ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<ul>
<li>GPUãŒæä¾›ã™ã‚‹ã™ã¹ã¦ã®ä¸¦åˆ—åŒ–ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹</li>
<li>ç«¶åˆçŠ¶æ…‹ã«æ³¨æ„ã™ã‚‹</li>
<li><code class="notranslate" translate="no">var&lt;workgroup&gt;</code>ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ã§å…±æœ‰ã•ã‚Œã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹</li>
<li>å‘¼ã³å‡ºã—é–“ã®èª¿æ•´ãŒå°‘ãªã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è¨­è¨ˆã™ã‚‹ã‚ˆã†ã«åŠªã‚ã‚‹</li>
<li>èª¿æ•´ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œã¨<code class="notranslate" translate="no">workgroupBarrier</code>ãŒè§£æ±ºç­–ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</li>
</ul>
<p>ã“ã®ç‚¹ã§ã¯ã€ã¾ã‚ã¾ã‚ã§ã—ãŸã€‚ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã§ãƒãƒ£ãƒ³ã‚¯ã‚’è¨ˆç®—ã™ã‚‹ã¨ãã€<code class="notranslate" translate="no">atomicAdd</code>ã‚’ä»‹ã—ã¦è§£æ±ºã—ãŸç«¶åˆãŒã¾ã ã‚ã‚Šã¾ã™ãŒã€ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®<code class="notranslate" translate="no">bins</code>ã‹ã‚‰<code class="notranslate" translate="no">chunks</code>ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨ãã«ç«¶åˆã¯ãªãã€<code class="notranslate" translate="no">chunks</code>ã‚’æœ€çµ‚çµæœã®1ã¤ã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚¹ã™ã‚‹ã¨ãã«ã‚‚ç«¶åˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
<p>ã‚‚ã†1ã¤ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>
<ul>
<li>GPUãŒé«˜é€Ÿã§ã‚ã‚‹ã¨æƒ³å®šã—ãªã„</li>
</ul>
<p>GPUã®å€‹ã€…ã®ã‚³ã‚¢ã¯ãã‚Œã»ã©é«˜é€Ÿã§ã¯ãªã„ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸã€‚ã™ã¹ã¦ã®é€Ÿåº¦ã¯ä¸¦åˆ—åŒ–ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹ãŸã‚ã€ä¸¦åˆ—ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­è¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p><a href="webgpu-compute-shaders-histogram-part-2.html">æ¬¡ã®è¨˜äº‹</a>ã§ã¯ã€ã“ã‚Œã‚‰ã‚’å°‘ã—èª¿æ•´ã—ã€JavaScriptã«å¼•ãæˆ»ã™ã®ã§ã¯ãªãã€GPUã‚’ä½¿ç”¨ã—ã¦çµæœã‚’ã‚°ãƒ©ãƒ•åŒ–ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚ã¾ãŸã€ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ãŸã“ã¨ã«åŸºã¥ã„ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ“ãƒ‡ã‚ªèª¿æ•´ã‚‚è©¦ã¿ã¾ã™ã€‚</p>
<!-- ã“ã®è¨˜äº‹ã®æœ€å¾Œã«ã“ã‚Œã‚’ä¿æŒã—ã¦ãã ã•ã„ -->
<link rel="stylesheet" href="../webgpu-compute-shaders-histogram.css">
<script type="module" src="../webgpu-compute-shaders-histogram.js"></script>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgpu/lessons/webgpu-compute-shaders-histogram.html">English
    </option><option value="/webgpu/lessons/es/webgpu-compute-shaders-histogram.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html" selected="">æ—¥æœ¬èª
    </option><option value="/webgpu/lessons/ko/webgpu-compute-shaders-histogram.html">í•œêµ­ì–´
    </option><option value="/webgpu/lessons/ru/webgpu-compute-shaders-histogram.html">Ğ ÑƒÑÑĞºĞ¸Ğ¹
    </option><option value="/webgpu/lessons/tr/webgpu-compute-shaders-histogram.html">TÃ¼rkÃ§e
    </option><option value="/webgpu/lessons/uk/webgpu-compute-shaders-histogram.html">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°
    </option><option value="/webgpu/lessons/zh_cn/webgpu-compute-shaders-histogram.html">ç®€ä½“ä¸­æ–‡
</option></select>


        <div id="toc">
          <ul>  <li>åŸºæœ¬</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-fundamentals.html">åŸºæœ¬</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-inter-stage-variables.html">inter-stageå¤‰æ•°</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-uniforms.html">ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ </a></li>
<li><a href="/webgpu/lessons/ja/webgpu-storage-buffers.html">ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒãƒ•ã‚¡</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-vertex-buffers.html">é ‚ç‚¹ãƒãƒƒãƒ•ã‚¡</a></li>
  <li>ãƒ†ã‚¯ã‚¹ãƒãƒ£</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-textures.html">ãƒ†ã‚¯ã‚¹ãƒãƒ£</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-importing-textures.html">ç”»åƒã®èª­ã¿è¾¼ã¿</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-textures-external-video.html">ãƒ“ãƒ‡ã‚ªã®ä½¿ç”¨</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-cube-maps.html">ã‚­ãƒ¥ãƒ¼ãƒ–ãƒãƒƒãƒ—</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-storage-textures.html">ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¯ã‚¹ãƒãƒ£</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-multisampling.html">ãƒãƒ«ãƒã‚µãƒ³ãƒ—ãƒªãƒ³ã‚° / MSAA</a></li>
        </ul>
<li><a href="/webgpu/lessons/ja/webgpu-constants.html">å®šæ•°</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-memory-layout.html">æ§‹é€ ä½“ã¨ãƒ¡ãƒ¢ãƒªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-transparency.html">é€æ˜åº¦ã¨ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-bind-group-layouts.html">ãƒã‚¤ãƒ³ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-copying-data.html">ãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-limits-and-features.html">ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¨åˆ¶é™</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-timing.html">ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-wgsl.html">WGSL</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-how-it-works.html">ä»•çµ„ã¿</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-compatibility-mode.html">äº’æ›ãƒ¢ãƒ¼ãƒ‰</a></li>
        </ul>
  <li>3Dã®æ•°å­¦</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-translation.html">å¹³è¡Œç§»å‹•</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-rotation.html">å›è»¢</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-scale.html">ã‚¹ã‚±ãƒ¼ãƒ«</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-matrix-math.html">è¡Œåˆ—æ¼”ç®—</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-orthographic-projection.html">æ­£å°„å½±</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-perspective-projection.html">é€è¦–æŠ•å½±</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-cameras.html">ã‚«ãƒ¡ãƒ©</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-matrix-stacks.html">è¡Œåˆ—ã‚¹ã‚¿ãƒƒã‚¯</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-scene-graphs.html">ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•</a></li>
        </ul>
  <li>ãƒ©ã‚¤ãƒˆ</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-lighting-directional.html">æŒ‡å‘æ€§ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-lighting-point.html">ç‚¹å…‰æº</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-lighting-spot.html">ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆ</a></li>
        </ul>
  <li>ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-large-triangle-to-cover-clip-space.html">å¤§ããªã‚¯ãƒªãƒƒãƒ—ç©ºé–“ã®ä¸‰è§’å½¢</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-environment-maps.html">ç’°å¢ƒãƒãƒƒãƒ—</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-skybox.html">ã‚¹ã‚«ã‚¤ãƒœãƒƒã‚¯ã‚¹</a></li>
        </ul>
  <li>ãƒã‚¹ãƒˆãƒ—ãƒ­ã‚»ãƒƒã‚·ãƒ³ã‚°</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-post-processing.html">åŸºæœ¬çš„ãªCRTã‚¨ãƒ•ã‚§ã‚¯ãƒˆ</a></li>
        </ul>
        </ul>
  <li>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-compute-shaders.html">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®åŸºæœ¬</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ </a></li>
<li><a href="/webgpu/lessons/ja/webgpu-compute-shaders-histogram-part-2.html">ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  ãƒ‘ãƒ¼ãƒˆ2</a></li>
        </ul>
  <li>ãã®ä»–ã®ãƒˆãƒ”ãƒƒã‚¯</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-multiple-canvases.html">è¤‡æ•°ã®ã‚­ãƒ£ãƒ³ãƒã‚¹</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-points.html">ãƒã‚¤ãƒ³ãƒˆ</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-from-webgl.html">WebGLã‹ã‚‰WebGPUã¸</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-optimization.html">é€Ÿåº¦ã¨æœ€é©åŒ–</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-debugging.html">ãƒ‡ãƒãƒƒã‚°ã¨ã‚¨ãƒ©ãƒ¼</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-resources.html">ãƒªã‚½ãƒ¼ã‚¹ / å‚è€ƒæ–‡çŒ®</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-wgsl-function-reference.html">WGSL é–¢æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</a></li>
<li><a href="/webgpu/lessons/resources/wgsl-offset-computer.html">WGSL ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—æ©Ÿ</a></li>
        </ul></ul>
<ul>
  <li><a href="https://github.com/webgpu/webgpufundamentals">github</a></li>
  <li><a href="https://google.github.io/tour-of-wgsl/">Tour of WGSL</a></li>
  <li><a href="https://gpuweb.github.io/types/">WebGPU API Reference</a></li>
  <li><a href="https://www.w3.org/TR/webgpu/">WebGPU Spec</a></li>
  <li><a href="https://www.w3.org/TR/WGSL/">WGSL Spec</a></li>
  <li><a href="https://webgpureport.org">WebGPUReport.org</a></li>
  <li><a href="https://web3dsurvey.com/webgpu">Web3DSurvey.com</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>å•é¡Œç‚¹/ãƒã‚°? <a href="https://github.com/webgpu/webgpufundamentals/issues">githubã§issueã‚’ä½œæˆ</a>.</div>

        <div id="disqus_thread"></div>
        <script>
            var disqus_config = function () {
              this.page.url = `${window.location.origin}${window.location.pathname}`;
              this.page.identifier = `WebGPU ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ - ç”»åƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ `;
            };
            (function() { // DON'T EDIT BELOW THIS LINE
                if (window.location.hostname.indexOf("webgpufundamentals.org") < 0) {
                    return;
                }
                var d = document, s = d.createElement('script');
                s.src = 'https://webgpufundamentals-org.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>

<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgpufundamentals",
};
</script>
<script src="/contributors.js"></script>
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
<script src="/3rdparty/jquery-3.3.1.slim.min.js"></script>
<script src="/webgpu/lessons/resources/prettify.js"></script>
<script src="/webgpu/lessons/resources/lesson.js" type="module"></script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-92BFT5PE4H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-92BFT5PE4H');
</script>






</body></html>