<!DOCTYPE html><!-- this file is auto-generated from webgpu/lessons/ja/webgpu-memory-layout.md. Do not edited directly --><!--
Copyright 2023, GfxFundamentals Contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

* Redistributions of source code must retain the above copyright
  notice, this list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above
  copyright notice, this list of conditions and the following disclaimer
  in the documentation and/or other materials provided with the
  distribution.

* Neither the name of GfxFundamentals nor the names of the
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


--><html lang="ja"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="WebGPUにおけるデータのレイアウトとデータの準備">
<meta name="keywords" content="webgpu graphics">
<meta name="thumbnail" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-memory-layout_ja.jpg">

<meta property="og:title" content="構造体とメモリレイアウト">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-memory-layout_ja.jpg">
<meta property="og:description" content="WebGPUにおけるデータのレイアウトとデータの準備">
<meta property="og:url" content="https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgpufundamentals.org">
<meta name="twitter:title" content="構造体とメモリレイアウト">
<meta name="twitter:url" content="https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html">
<meta name="twitter:description" content="WebGPUにおけるデータのレイアウトとデータの準備">
<meta name="twitter:image:src" content="https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-memory-layout_ja.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgpufundamentals.org/#website",
      "url":"https://webgpufundamentals.org/",
      "name":"webgpufundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html#primaryimage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/screenshots/webgpu-memory-layout_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html#webpage",
      "url":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html",
      "inLanguage":"ja",
      "name":"構造体とメモリレイアウト",
      "keywords":"webgpu graphics programming",
      "isPartOf":{
        "@id":"https://webgpufundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgpufundamentals.org/webgpu/lessons/ja/webgpu-memory-layout.html#primaryimage"
      }
    }
  ]
}
</script>

<title>構造体とメモリレイアウト</title>
<link href="/webgpu/lessons/resources/webgpufundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="apple-touch-icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">
<link rel="icon" href="/webgpu/lessons/resources/webgpufundamentals-icon.png">

<link rel="stylesheet" href="/webgpu/lessons/lang.css">
<link rel="stylesheet" href="/webgpu/lessons/resources/lesson.css">
</head>
<body>
<div class="webgpu_navbar">
  <div>
    <select class="language">
    <option value="/webgpu/lessons/webgpu-memory-layout.html">English
    </option><option value="/webgpu/lessons/es/webgpu-memory-layout.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-memory-layout.html" selected="">日本語
    </option><option value="/webgpu/lessons/ko/webgpu-memory-layout.html">한국어
    </option><option value="/webgpu/lessons/ru/webgpu-memory-layout.html">Русский
    </option><option value="/webgpu/lessons/uk/webgpu-memory-layout.html">Українська
    </option><option value="/webgpu/lessons/zh_cn/webgpu-memory-layout.html">简体中文
</option></select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="webgpu_header">
  <h1><a href="/webgpu/lessons/ja/">webgpufundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(160px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub">
  <div>
    <div><a href="https://github.com/webgpu/webgpufundamentals">Fix, Fork, Contribute <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"></path>
    </g>
</svg>
</a></div>
  </div>
</div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>構造体とメモリレイアウト</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>WebGPUで扱うデータは、ほとんどの場合、シェーダで定義したデータ構造に合わせて
明示的にメモリレイアウトする必要があります。
このことは、JavaScriptやTypeScriptにおけるデータの扱いとは対照的です。
JavaScriptやTypeScriptのプログラミングでは、そういったことを意識する機会は滅多にありません。</p>
<p>シェーダはWGSLという言語で書きますが、WGSL言語のプログラミングでは、頻繁に<code class="notranslate" translate="no">struct</code>(構造体)を定義します。
構造体というのは、JavaScriptで言えばオブジェクトと似た仕組みです。
WGSLの構造体では「メンバー変数」を定義しますが、
これはJavaScriptのオブジェクトでプロパティを定義するのに似ています。</p>
<p>JavaScriptでは、オブジェクトのプロパティの定義は名前を付けて終わりですが、
WGSLの構造体のメンバー変数の定義では名前のほかに、「変数のデータ型」を明示する必要があります。
また、シェーダ中の構造体に対してはバッファからデータを渡すことになりますが、
「バッファ上の、どこに、どういったデータを配置すれば、構造体の各メンバーに正しくデータが割り当てられるか」
は、<strong>あなたの責任</strong>となっています。</p>
<p><a href="webgpu-wgsl.html">WGSL</a> v1には、基本となる4種類のデータ型があります。</p>
<ul>
<li><code class="notranslate" translate="no">f32</code> (32ビット浮動小数点数型)</li>
<li><code class="notranslate" translate="no">i32</code> (32ビット符号付き整数型)</li>
<li><code class="notranslate" translate="no">u32</code> (32ビット符号なし整数型)</li>
<li><code class="notranslate" translate="no">f16</code> (16ビット浮動小数点数型) <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></li>
</ul>
<p>1バイトは8ビットなので、32ビット型データなら4バイト、16ビット型データなら2バイトです。</p>
<p>以下のような構造体の場合、</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">struct OurStruct {
  velocity: f32,
  acceleration: f32,
  frameCount: u32,
};
</pre>
<p>そのデータレイアウトを図示するとこのようになります。</p>
<div class="webgpu_center" data-diagram="ourStructV1"></div>
<p>図中の各四角ブロックは1バイトを表しています。
上の図の通り、この構造体全体は12バイトとなります。
12バイトの、最初の4バイトは<code class="notranslate" translate="no">velocity</code>に、次の4バイトは<code class="notranslate" translate="no">acceleration</code>に、
最後の4バイトは<code class="notranslate" translate="no">frameCount</code>に使用されます。</p>
<p>この構造体<code class="notranslate" translate="no">OurStruct</code>にデータを渡すためには、
渡すデータの方を構造体に合わせたメモリレイアウトにする必要があります。
実際にやってみましょう。</p>
<p>まず<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>を12バイトのサイズで生成します。
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>に実際のデータを書き込む際には、各種の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code class="notranslate" translate="no">TypedArray</code></a>(型付き配列)ビューを利用します。</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const kOurStructSizeBytes =
  4 + // velocity
  4 + // acceleration
  4 ; // frameCount
const ourStructData = new ArrayBuffer(kOurStructSizeBytes);
const ourStructValuesAsF32 = new Float32Array(ourStructData);
const ourStructValuesAsU32 = new Uint32Array(ourStructData);
</pre>
<p>上のコードで、<code class="notranslate" translate="no">ourStructData</code>は<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>のオブジェクトです。これはメモリチャンク、つまりは、バイト列です。
この「バイト列」を、３つの「数値」として扱うために、「ビュー(view)」を作成しています。</p>
<p><code class="notranslate" translate="no">ourStructValuesAsF32</code>は、メモリの中身を「32ビット浮動小数点数値として扱う」ためのビューです。</p>
<p><code class="notranslate" translate="no">ourStructValuesAsU32</code>は、メモリの中身を「32ビット符号なし整数値として扱う」ためのビューです。</p>
<p>これらのビューは<strong>同じメモリを見ている</strong>、という点に注意してください。</p>
<p>ここまでで、バッファ１つ、そのバッファに対するビューを２つ、用意しました。
これを利用して、バッファに、構造体の各メンバーのデータ型に合わせた数値データをセットできます。</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const kVelocityOffset = 0;
const kAccelerationOffset = 1;
const kFrameCountOffset = 2;

ourStructValuesAsF32[kVelocityOffset] = 1.2;
ourStructValuesAsF32[kAccelerationOffset] = 3.4;
ourStructValuesAsU32[kFrameCountOffset] = 56;    // これは整数値
</pre>
<h2 id="typedarrays"><a id="a-typed-arrays"></a> <code class="notranslate" translate="no">TypedArrays</code></h2>
<p>以上で、「12バイトのバッファ」に「３つの数値」を適切に配置することができました。</p>
<p>さて、プログラミングでは、同じことをやるために色々な書き方ができます。
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>のような<code class="notranslate" translate="no">TypeArray</code>(型付き配列)には、以下のようなコンストラクタがあります。</p>
<ul>
<li>
<p><code class="notranslate" translate="no">new Float32Array(12)</code></p>
<p>このやり方では、引数に「配列要素数」を指定しています。この例ではまず48バイト(<code class="notranslate" translate="no">Float32Array(12)</code>に合わせて48=12*4バイト)の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が、「新たに」生成されます。そしてその<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>を<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>として扱うためのビューが作られます。</p>
</li>
<li>
<p><code class="notranslate" translate="no">new Float32Array([4, 5, 6])</code></p>
<p>このやり方では、引数に「配列要素」を直接与えています。この例ではまず12バイト(32bit floatの配列要素が３つと解釈されるので12=4*3バイト)の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が「新たに」生成されます。そしてその<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>を<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>として扱うためのビューが作られます。そして、そこに初期値として、4、5、6という数値データが書き込まれます。</p>
<p>引数として「<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code class="notranslate" translate="no">TypedArray</code></a>」を与えるやり方もあります。たとえば、</p>
<p><code class="notranslate" translate="no">new Float32Array(someUint8ArrayOf6Values)</code>と書いた場合(someUint8ArrayOf6Valuesは
「6要素の、Uint8Arrayデータ」とします)、24バイト(各要素のサイズは、元データは8bitだが生成されるビューの側が32bitなので6要素*32bit=192bit=24バイト)の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が「新たに」生成されます。そしてその<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>を<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>として扱うためのビューが作られます。そして、そこに初期値として元のビュー<code class="notranslate" translate="no">someUint8ArrayOf6Values</code>の各要素の値が<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>へとコピーされます。値のコピーは、バイナリデータとしてではなく数値として解釈されます。下のコードの様な意味です。</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">srcArray.forEach((v, i) =&gt; dstArray[i] = v);
</pre>
</li>
<li>
<p><code class="notranslate" translate="no">new Float32Array(someArrayBuffer)</code></p>
<p>このやり方では、引数に既存の「<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>」を与えています。記事の上の方で書いたサンプルプログラムのやり方はこの形です。<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>は「<strong>既存のバッファ</strong>」に対するビューとなり、新たに<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が生成されることはありません。</p>
</li>
<li>
<p><code class="notranslate" translate="no">new Float32Array(someArrayBuffer, byteOffset)</code></p>
<p>このやり方では、引数として、既存の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>と「オフセット値」を与えています。<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>は「<strong>既存のバッファ</strong>の先頭を<code class="notranslate" translate="no">byteOffset</code>と見なした範囲」に対するビューとなります。また、新たに<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が生成されることはありません。</p>
</li>
<li>
<p><code class="notranslate" translate="no">new Float32Array(someArrayBuffer, byteOffset, length)</code></p>
<p>このやり方では、引数として、既存の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>と「オフセット値」と「length」を与えています。
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array"><code class="notranslate" translate="no">Float32Array</code></a>は「<strong>既存のバッファ</strong>の、先頭を<code class="notranslate" translate="no">byteOffset</code>、要素数を<code class="notranslate" translate="no">length</code>と見なした範囲」に対するビューとなります。要素数なので、lengthが3であればfloat32要素が3つとなるので12バイトに相当します。また、新たに<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>が生成されることはありません。</p>
</li>
</ul>
<p>先ほどのコードを、最後のやり方で書き直すなら、このように書けます。</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const kOurStructSizeBytes =
  4 + // velocity
  4 + // acceleration
  4 ; // frameCount
const ourStructData = new ArrayBuffer(kOurStructSizeBytes);
const velocityView = new Float32Array(ourStructData, 0, 1);
const accelerationView = new Float32Array(ourStructData, 4, 1);
const frameCountView = new Uint32Array(ourStructData, 8, 1);

velocityView[0] = 1.2;
accelerationView[0] = 3.4;
frameCountView[0] = 56;
</pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code class="notranslate" translate="no">TypedArray</code></a>についてもう少し説明します。
すべての<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code class="notranslate" translate="no">TypedArray</code></a>には以下のプロパティがあります。</p>
<ul>
<li><code class="notranslate" translate="no">length</code>: 要素数</li>
<li><code class="notranslate" translate="no">byteLength</code>: 全体のバイト数</li>
<li><code class="notranslate" translate="no">byteOffset</code>: <code class="notranslate" translate="no">TypeArray</code>が見ている<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>のオフセット値</li>
<li><code class="notranslate" translate="no">buffer</code>: <code class="notranslate" translate="no">TypeArray</code>が見ている<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a></li>
</ul>
<p>また、<code class="notranslate" translate="no">TypeArray</code>には各種のメソッドがあります。
<code class="notranslate" translate="no">TypeArray</code>の持つメソッドの多くは、JavaScriptの<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><code class="notranslate" translate="no">Array</code></a>オブジェクトが持つメソッドと似ていますが、
独特なものとして<code class="notranslate" translate="no">subarray</code>メソッドがあります。
<code class="notranslate" translate="no">subarray</code>メソッドは元のビューと同じ型の<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code class="notranslate" translate="no">TypedArray</code></a>ビューを生成します。
引数は<code class="notranslate" translate="no">subarray(begin, end)</code>となっていますが、<code class="notranslate" translate="no">end</code>番要素は含まれません。
例えば<code class="notranslate" translate="no">someTypedArray.subarray(5, 10)</code>と書いた場合、
「元のビューが見ている<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a>と<strong>同じ<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code class="notranslate" translate="no">ArrayBuffer</code></a></strong> を、
someTypedArrayとして5番目から9番目の要素の部分だけを見るためのビューを生成する」、
といった意味になります。</p>
<p>先ほどのコードは、こんな風に書き替えることもできます。</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const kOurStructSizeFloat32Units =
  1 + // velocity
  1 + // acceleration
  1 ; // frameCount
const ourStructDataAsF32 = new Float32Array(kOurStructSizeFloat32Units);
const ourStructDataAsU32 = new Uint32Array(ourStructDataAsF32.buffer);
const velocityView = ourStructDataAsF32.subarray(0, 1);
const accelerationView = ourStructDataAsF32.subarray(1, 2);
const frameCountView = ourStructDataAsU32.subarray(2, 3);

velocityView[0] = 1.2;
accelerationView[0] = 3.4;
frameCountView[0] = 56;
</pre>
<p><a href="webgpu-wgsl.html">WGSL</a>には最初に書いた4種の基本型を基にしたデータ型が多数あります。
これを列挙してみます。</p>
<div class="webgpu_center data-table">
  <div>
  <style>
    .wgsl-types tr:nth-child(5n) { height: 1em };
  </style>
  <table class="wgsl-types">
    <thead>
      <tr><th>type</th><th>description</th><th>short name</th></tr><tr>
    </tr></thead>
    <tbody>
      <tr><td><code class="notranslate" translate="no">vec2&lt;f32&gt;</code></td><td>a type with 2  <code class="notranslate" translate="no">f32</code>s</td><td><code class="notranslate" translate="no">vec2f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec2&lt;u32&gt;</code></td><td>a type with 2  <code class="notranslate" translate="no">u32</code>s</td><td><code class="notranslate" translate="no">vec2u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec2&lt;i32&gt;</code></td><td>a type with 2  <code class="notranslate" translate="no">i32</code>s</td><td><code class="notranslate" translate="no">vec2i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec2&lt;f16&gt;</code></td><td>a type with 2  <code class="notranslate" translate="no">f16</code>s</td><td><code class="notranslate" translate="no">vec2h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">vec3&lt;f32&gt;</code></td><td>a type with 3  <code class="notranslate" translate="no">f32</code>s</td><td><code class="notranslate" translate="no">vec3f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec3&lt;u32&gt;</code></td><td>a type with 3  <code class="notranslate" translate="no">u32</code>s</td><td><code class="notranslate" translate="no">vec3u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec3&lt;i32&gt;</code></td><td>a type with 3  <code class="notranslate" translate="no">i32</code>s</td><td><code class="notranslate" translate="no">vec3i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec3&lt;f16&gt;</code></td><td>a type with 3  <code class="notranslate" translate="no">f16</code>s</td><td><code class="notranslate" translate="no">vec3h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">vec4&lt;f32&gt;</code></td><td>a type with 4  <code class="notranslate" translate="no">f32</code>s</td><td><code class="notranslate" translate="no">vec4f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec4&lt;u32&gt;</code></td><td>a type with 4  <code class="notranslate" translate="no">u32</code>s</td><td><code class="notranslate" translate="no">vec4u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec4&lt;i32&gt;</code></td><td>a type with 4  <code class="notranslate" translate="no">i32</code>s</td><td><code class="notranslate" translate="no">vec4i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">vec4&lt;f16&gt;</code></td><td>a type with 4  <code class="notranslate" translate="no">f16</code>s</td><td><code class="notranslate" translate="no">vec4h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat2x2&lt;f32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec2&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x2f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x2&lt;u32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec2&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x2u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x2&lt;i32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec2&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x2i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x2&lt;f16&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec2&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x2h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat2x3&lt;f32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec3&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x3f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x3&lt;u32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec3&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x3u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x3&lt;i32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec3&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x3i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x3&lt;f16&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec3&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x3h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat2x4&lt;f32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec4&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x4f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x4&lt;u32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec4&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x4u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x4&lt;i32&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec4&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x4i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat2x4&lt;f16&gt;</code></td><td>a matrix of 2 <code class="notranslate" translate="no">vec4&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat2x4h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat3x2&lt;f32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec2&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x2f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x2&lt;u32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec2&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x2u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x2&lt;i32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec2&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x2i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x2&lt;f16&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec2&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x2h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat3x3&lt;f32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec3&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x3f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x3&lt;u32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec3&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x3u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x3&lt;i32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec3&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x3i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x3&lt;f16&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec3&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x3h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat3x4&lt;f32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec4&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x4f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x4&lt;u32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec4&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x4u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x4&lt;i32&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec4&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x4i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat3x4&lt;f16&gt;</code></td><td>a matrix of 3 <code class="notranslate" translate="no">vec4&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat3x4h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat4x2&lt;f32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec2&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x2f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x2&lt;u32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec2&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x2u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x2&lt;i32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec2&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x2i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x2&lt;f16&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec2&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x2h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat4x3&lt;f32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec3&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x3f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x3&lt;u32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec3&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x3u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x3&lt;i32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec3&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x3i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x3&lt;f16&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec3&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x3h</code></td></tr>
      <tr></tr>
      <tr><td><code class="notranslate" translate="no">mat4x4&lt;f32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec4&lt;f32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x4f</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x4&lt;u32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec4&lt;u32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x4u</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x4&lt;i32&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec4&lt;i32&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x4i</code></td></tr>
      <tr><td><code class="notranslate" translate="no">mat4x4&lt;f16&gt;</code></td><td>a matrix of 4 <code class="notranslate" translate="no">vec4&lt;f16&gt;</code>s</td><td><code class="notranslate" translate="no">mat4x4h</code></td></tr>
    </tbody>
  </table>
  </div>
</div>
<p>ここで、問題です。</p>
<p>「<code class="notranslate" translate="no">vec3f</code>は、<code class="notranslate" translate="no">f32</code>要素を3つ持つ型です。また、<code class="notranslate" translate="no">mat4x4f</code>は、各要素が<code class="notranslate" translate="no">f32</code>となっている4x4行列、つまり<code class="notranslate" translate="no">f32</code>要素を16個持つ型です。
以下のような構造体を定義したとき、メモリレイアウトがどうなるか答えなさい。」</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">struct Ex2 {
  scale: f32,
  offset: vec3f,
  projection: mat4x4f,
};
</pre>
<p>さて正解は！？</p>
<div class="webgpu_center" data-diagram="ourStructEx2"></div>
<p>予想と違いましたか？
上の図は、「各データ型にはアラインメント(alignment)要件がある」、ということを示してます。
各データの開始バイトは、メモリ上では「各変数の型に対応した特定のバイト数の倍数」に整列(align)する必要があります。</p>
<p>次の表は、各種のデータ型のサイズとアラインメントの一覧です。</p>
<div class="webgpu_center data-table" data-diagram="wgslTypeTable" style="width: 95%; columns: 14em;"></div>
<p>さらに！もう少し話は続きます。</p>
<p>以下の構造体のレイアウトはどうなると思いますか？</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">struct Ex3 {
  transform: mat3x3f,
  directions: array&lt;vec3f, 4&gt;,
};
</pre>
<p><code class="notranslate" translate="no">array&lt;type, count&gt;</code>というのは、「データ型が<code class="notranslate" translate="no">type</code>、要素数が<code class="notranslate" translate="no">count</code>の配列」です。</p>
<p>正解は、このようになります。</p>
<div class="webgpu_center" data-diagram="ourStructEx3"></div>
<p>アラインメントの表を見ると、<code class="notranslate" translate="no">vec3&lt;f32&gt;</code>のalignの値は16となっています。
このため、<code class="notranslate" translate="no">vec3&lt;f32&gt;</code>中の12バイトデータはすべて16バイト単位に整列されます。
これは、「各<code class="notranslate" translate="no">vec3&lt;f32&gt;</code>の開始バイト」は、「offsetが0や16の倍数の位置」にしか置けない、ということです。
数が合わない場合は、必要に応じて、バッファには空白(padding。図中では"-pad-")が配置されます。
このルールは、<code class="notranslate" translate="no">vec3&lt;f32&gt;</code>のデータが「行列の要素」であっても「配列の要素」であっても同様です。</p>
<p>次の例を見てみましょう。</p>
<pre class="prettyprint showlinemods notranslate lang-wgsl" translate="no">struct Ex4a {
  velocity: vec3f,
};

struct Ex4 {
  orientation: vec3f,
  size: f32,
  direction: array&lt;vec3f, 1&gt;,
  scale: f32,
  info: Ex4a,
  friction: f32,
};
</pre>
<div class="webgpu_center" data-diagram="ourStructEx4"></div>
<p><code class="notranslate" translate="no">size</code>は、直前の<code class="notranslate" translate="no">vec3f</code>型データ<code class="notranslate" translate="no">orientation</code>のすぐ後ろ、オフセット12バイト目の部分にうまくはまっています。
一方で、<code class="notranslate" translate="no">scale</code>や<code class="notranslate" translate="no">friction</code>はうまくはまらず、パディングを挟んで、それぞれオフセット32、64のところに飛び出して配置されています。
この違いは何でしょう。</p>
<p>これは、配列や構造体には、基本型とはまた別の、特別なアラインメントのルールがあるためです。
配列や構造体は、この例の<code class="notranslate" translate="no">direction</code>のような「要素数がひとつだけの配列」であっても、
<code class="notranslate" translate="no">Ex4a</code>のような「要素が<code class="notranslate" translate="no">vec3f</code>ひとつだけの構造体」であっても、
配列や構造体の独自の、アラインメントのルールに従います。</p>
<h1 id="オフセットとサイズの計算は頭痛の元！">オフセットとサイズの計算は頭痛の元！</h1>
<p>WGSL中のデータのサイズとオフセットの計算は、WebGPUの扱いにおいて、恐らくは最大の難所と言えるでしょう。
これらの計算は自分でやる必要があります。
シェーダ中の構造体のデータ構造に変更があれば、メモリレイアウトがどう変わるのか再考して、
JavaScript側でオフセット値を書き換えて、つじつまを合わせる必要があります。
変更が構造体の中ほどのデータだった場合、それ以降のすべてのメンバのオフセット値を再計算する必要があります。</p>
<p>どこかで１バイトでも間違えれば、シェーダには誤ったデータが送られることになります。
シェーダはエラーメッセージを返すでもなく、ただ黙々と間違った結果を出力します。
シェーダの入力データが間違っているからです。
3Dモデルが表示されなかったり、計算結果が間違ったり、といったことが起きます。</p>
<p>幸い、こういった作業を手助けするライブラリが存在しています。</p>
<p>例えば「<a href="https://github.com/greggman/webgpu-utils">webgpu-utils</a>」です。</p>
<p>このライブラリにWGSLコードを与えると、すべてをあなたの替わりにやってくれるAPIを返してくれます。
構造体の変更をしても、これを使えばたいていの場合、コードはうまく動くはずです。</p>
<p>今回のサンプルプログラムで実際に<code class="notranslate" translate="no">webgpu-utils</code>を使ってみる場合、以下のようなコードになるでしょう。</p>
<pre class="prettyprint showlinemods notranslate notranslate" translate="no">import {
  makeShaderDataDefinitions,
  makeStructuredView,
} from 'https://greggman.github.io/webgpu-utils/dist/0.x/webgpu-utils-1.x.module.js';

const code = `
struct Ex4a {
  velocity: vec3f,
};

struct Ex4 {
  orientation: vec3f,
  size: f32,
  direction: array&lt;vec3f, 1&gt;,
  scale: f32,
  info: Ex4a,
  friction: f32,
};
@group(0) @binding(0) var&lt;uniform&gt; myUniforms: Ex4;

...
`;

const defs = makeShaderDataDefinitions(code);
const myUniformValues = makeStructuredView(defs.uniforms.myUniforms);

// Set some values via set
myUniformValues.set({
  orientation: [1, 0, -1],
  size: 2,
  direction: [0, 1, 0],
  scale: 1.5,
  info: {
    velocity: [2, 3, 4],
  },
  friction: 0.1,
});

// now pass myUniformValues.arrayBuffer to WebGPU when needed.
</pre>
<p>このライブラリを使うか、別のライブラリを使うか、何も使わず自力でやるかは、あなたの判断です。
ただ、筆者の場合、実際の場面でどこが間違ったか調べて、オフセットとサイズを手計算するだけのために、
20分、30分……いや60分？頭を抱えるという経験を、何度もしています。
私にとっては、このライブラリはよく効く頭痛薬です。</p>
<p>ライブラリでなく、半手動で計算したい人のために、
「<a href="../resources/wgsl-offset-computer.html">オフセット計算機</a>」も用意しました。</p>
<!-- keep this at the bottom of the article -->
<script type="module" src="../webgpu-memory-layout.js"></script>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><code class="notranslate" translate="no">f16</code>のサポートは<a href="webgpu-limits-and-features.html">オプション機能</a>となっている。 <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgpu/lessons/webgpu-memory-layout.html">English
    </option><option value="/webgpu/lessons/es/webgpu-memory-layout.html">Spanish
    </option><option value="/webgpu/lessons/ja/webgpu-memory-layout.html" selected="">日本語
    </option><option value="/webgpu/lessons/ko/webgpu-memory-layout.html">한국어
    </option><option value="/webgpu/lessons/ru/webgpu-memory-layout.html">Русский
    </option><option value="/webgpu/lessons/uk/webgpu-memory-layout.html">Українська
    </option><option value="/webgpu/lessons/zh_cn/webgpu-memory-layout.html">简体中文
</option></select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-fundamentals.html">基本</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-inter-stage-variables.html">inter-stage変数</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-uniforms.html">Uniforms</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-storage-buffers.html">Storage Buffers</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-vertex-buffers.html">Vertex Buffers</a></li>
  <li>Textures</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-textures.html">Textures</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-importing-textures.html">Loading Images</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-textures-external-video.html">Using Video</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-cube-maps.html">Cube Maps</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-storage-textures.html">Storage Textures</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-multisampling.html">Multisampling / MSAA</a></li>
        </ul>
<li><a href="/webgpu/lessons/ja/webgpu-constants.html">Constants</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-memory-layout.html">構造体とメモリレイアウト</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-transparency.html">Transparency and Blending</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-copying-data.html">Copying Data</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-limits-and-features.html">Optional Features and Limits</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-timing.html">Timing Performance</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-wgsl.html">WGSL</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-how-it-works.html">How It Works</a></li>
        </ul>
  <li>3Dの数学</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-translation.html">Translation</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-rotation.html">Rotation</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-scale.html">Scale</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-matrix-math.html">Matrix Math</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-orthographic-projection.html">Orthographic Projection</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-perspective-projection.html">Perspective Projection</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-cameras.html">Cameras</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-matrix-stacks.html">Matrix Stacks</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-scene-graphs.html">Scene Graphs</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-lighting-directional.html">Directional Lighting</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-lighting-point.html">Point Lighting</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-large-triangle-to-cover-clip-space.html">Large Clip Space Triangle</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-environment-maps.html">Environment maps</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-skybox.html">Skyboxes</a></li>
        </ul>
        </ul>
  <li>コンピュートシェーダ</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-compute-shaders.html">Compute Shader Basics</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-compute-shaders-histogram.html">Image Histogram</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-compute-shaders-histogram-part-2.html">Image Histogram Part 2</a></li>
        </ul>
  <li>その他のトピック</li>
        <ul>
          <li><a href="/webgpu/lessons/ja/webgpu-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-multiple-canvases.html">Multiple Canvases</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-points.html">Points</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-from-webgl.html">WebGPU from WebGL</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-optimization.html">Speed and Optimization</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-debugging.html">Debugging and Errors</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-resources.html">Resources / References</a></li>
<li><a href="/webgpu/lessons/ja/webgpu-wgsl-function-reference.html">WGSL Function Reference</a></li>
<li><a href="/webgpu/lessons/resources/wgsl-offset-computer.html">WGSL Offset Computer</a></li>
        </ul></ul>
<ul>
  <li><a href="https://github.com/webgpu/webgpufundamentals">github</a></li>
  <li><a href="https://google.github.io/tour-of-wgsl/">Tour of WGSL</a></li>
  <li><a href="https://gpuweb.github.io/types/">WebGPU API Reference</a></li>
  <li><a href="https://www.w3.org/TR/webgpu/">WebGPU Spec</a></li>
  <li><a href="https://www.w3.org/TR/WGSL/">WGSL Spec</a></li>
  <li><a href="https://webgpureport.org">WebGPUReport.org</a></li>
  <li><a href="https://web3dsurvey.com/webgpu">Web3DSurvey.com</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>問題点/バグ? <a href="https://github.com/webgpu/webgpufundamentals/issues">githubでissueを作成</a>.</div>

        <div id="disqus_thread"></div>
        <script>
            var disqus_config = function () {
              this.page.url = `${window.location.origin}${window.location.pathname}`;
              this.page.identifier = `構造体とメモリレイアウト`;
            };
            (function() { // DON'T EDIT BELOW THIS LINE
                if (window.location.hostname.indexOf("webgpufundamentals.org") < 0) {
                    return;
                }
                var d = document, s = d.createElement('script');
                s.src = 'https://webgpufundamentals-org.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>

<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgpufundamentals",
};
</script>
<script src="/contributors.js"></script>
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
<script src="/3rdparty/jquery-3.3.1.slim.min.js"></script>
<script src="/webgpu/lessons/resources/prettify.js"></script>
<script src="/webgpu/lessons/resources/lesson.js" type="module"></script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-92BFT5PE4H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-92BFT5PE4H');
</script>






</body></html>